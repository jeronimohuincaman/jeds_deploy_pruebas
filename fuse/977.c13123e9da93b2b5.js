"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[977],{4977:(nt,F,n)=>{n.r(F),n.d(F,{MovimientosModule:()=>et});var h=n(1531),g=n(4755),U=n(9383),N=n(3627),d=n(1728),b=n(787),c=n(9114),a=n(9401),A=n(9609),I=n(5971),u=n(3686),f=n(430),T=n(6375),w=n(3649),t=n(2223),O=n(8372),Q=n(1884),Z=n(1217),Y=n(3611),x=n(5580),l=n(2340),q=n(7579),$=n(3144);let p=(()=>{class o{constructor(e){this.http=e}getMovimientos(e){let i="?";i+="asc"==e?.filter?.sort?"sort=idmovimiento":"sort=-idmovimiento",i+=e?.paginado?.pagination?"&pagination=1&":"",i+=e?.paginado?.perpage?"per-page="+e.paginado.perpage+"&":"",i+=e?.paginado?.currentPage?"page="+e.paginado.currentPage+"&":"",i+=e?.filter?.descripcion?`&filter[descripcion][like]=${e.filter.descripcion}`:"",i+=e?.filter?.bonificado?`&filter[bonificado]=${e.filter.bonificado}`:"",i+=e?.filter?.tipo_mov?`&filter[idtipo]=${e.filter.tipo_mov}`:"",i+=e?.filter?.origen?`&filter[origen]=${e.filter.origen}`:"",i+=e?.filter?.destino?`&filter[destino]=${e.filter.destino}`:"";var s=new q.x;return this.http.get(`${l.N.fondos.view_movimientos}${i}`,{observe:"response"}).subscribe(m=>{s.next({list:m.body,totalPages:m.headers.get("x-pagination-page-count"),totalCount:m.headers.get("x-pagination-total-count")})}),s.asObservable()}saveMovimiento(e){return this.http.post(`${l.N.fondos.movimientos}`,e)}updateMovimiento(e){return this.http.put(`${l.N.fondos.movimientos}/`+e.idmovimiento,e)}deleteMovimiento(e){return this.http.delete(l.N.fondos.movimientos+"/"+e)}getTiposMovimientos(e){let i="?";return i+=e?"filter[activo]=1":"",this.http.get(`${l.N.fondos.fondos_tipo}${i}`)}getFondos(e){let i="?";return i+=e?"":"filter[activo]=1",this.http.get(`${l.N.fondos.fondos}${i}`)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG($.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})();var S=n(1292),v=n(8280);function P(o,r){if(1&o&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.idtipo),t.xp6(1),t.Oqu(e.descripcion)}}function k(o,r){if(1&o&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.idfondo),t.xp6(1),t.Oqu(e.descripcion)}}function E(o,r){if(1&o&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.idfondo),t.xp6(1),t.Oqu(e.descripcion)}}let y=(()=>{class o{constructor(e,i,s,m,M,C){this.data=e,this.movimientosService=i,this.alert=s,this.menu=m,this.fb=M,this.dialogRef=C,this.columns=["fecha","tipo","origen","destino","importe","descripcion","bonificado"],this.fondos=[],this.tipos_movimientos=[],this.movimiento=this.data?this.data:null,this.title=this.movimiento?.idmovimiento?"Editar Movimiento":"Nuevo Movimiento"}ngOnInit(){this.newForm(),this.exist()}newForm(){this.form=this.fb.group({fecha:new a.NI(this.movimiento?this.movimiento.fecha:"",[a.kI.required]),bonificado:new a.NI(this.movimiento?this.movimiento.bonificado:""),tipo:new a.NI(this.movimiento?this.movimiento.idtipo:"",[a.kI.required]),origen:new a.NI(this.movimiento?this.movimiento.origen:""),destino:new a.NI(this.movimiento?this.movimiento.destino:""),importe:new a.NI(this.movimiento?this.movimiento.importe:"",[a.kI.required]),descripcion:new a.NI(this.movimiento?this.movimiento.descripcion:"",[a.kI.required])})}exist(){this.movimiento?.idmovimiento?(this.getFondos(!0),this.getTiposMovimientos()):(this.getFondos(),this.getTiposMovimientos(!0))}getFondos(e){return this.movimientosService.getFondos(e).subscribe(s=>{this.fondos=s})}getTiposMovimientos(e){return this.movimientosService.getTiposMovimientos(e).subscribe(s=>{this.tipos_movimientos=s})}onSubmit(){if(!this.form.valid)return this.alert.warning("Revise Los Datos Ingresados");this.movimiento={...this.movimiento,fecha:this.form.get("fecha").value,bonificado:this.form.get("bonificado").value?1:0,idtipo:this.form.get("tipo").value,origen:this.form.get("origen").value,destino:this.form.get("destino").value,importe:this.form.get("importe").value,descripcion:this.form.get("descripcion").value},this.movimiento.idmovimiento?this.movimientosService.updateMovimiento(this.movimiento).subscribe({next:e=>{e&&this.onCloseMenu()}}):this.movimientosService.saveMovimiento(this.movimiento).subscribe({next:e=>{e&&this.onCloseMenu()}})}onCloseMenu(){this.dialogRef.close(!1)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(x.WI),t.Y36(p),t.Y36(T.T),t.Y36(u.r),t.Y36(a.qu),t.Y36(x.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-save-movimiento"]],features:[t._Bn([{provide:Z.sG,useValue:Y.x}])],decls:45,vars:7,consts:[[1,"fixed","inset-0","bg-white","dark:bg-slate-900","shadow-lg","overflow-hidden","overflow-y-auto","sm:rounded-2xl","md:min-w-[50rem]","sm:w-90","sm:min-w-90","flex-col","flex","sm:inset-auto","max-h-screen","sm:static"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/3"],["matInput","","placeholder","Fecha","formControlName","fecha",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],["appearance","outline",1,"w-2/3"],["formControlName","tipo"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-1/2"],["formControlName","origen"],["formControlName","destino"],["matInput","","formControlName","importe"],["appearance","outline",1,"w-full"],["matInput","","formControlName","descripcion"],["formControlName","bonificado",1,"w-full","pb-5","justify-center"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div",6)(10,"mat-form-field",7),t._UZ(11,"input",8)(12,"mat-datepicker-toggle",9)(13,"mat-datepicker",null,10),t.qZA(),t.TgZ(15,"mat-form-field",11)(16,"mat-label"),t._uU(17,"Tipo"),t.qZA(),t.TgZ(18,"mat-select",12),t.YNc(19,P,2,2,"mat-option",13),t.qZA()()(),t.TgZ(20,"div",6)(21,"mat-form-field",14)(22,"mat-label"),t._uU(23,"Origen"),t.qZA(),t.TgZ(24,"mat-select",15),t.YNc(25,k,2,2,"mat-option",13),t.qZA()(),t.TgZ(26,"mat-form-field",14)(27,"mat-label"),t._uU(28,"Destino"),t.qZA(),t.TgZ(29,"mat-select",16),t.YNc(30,E,2,2,"mat-option",13),t.qZA()()(),t.TgZ(31,"div",6)(32,"mat-form-field",7)(33,"mat-label"),t._uU(34,"Importe"),t.qZA(),t._UZ(35,"input",17),t.qZA(),t.TgZ(36,"mat-form-field",18)(37,"mat-label"),t._uU(38,"Descripci\xf3n"),t.qZA(),t._UZ(39,"input",19),t.qZA()(),t.TgZ(40,"mat-checkbox",20),t._uU(41,"Bonificado"),t.qZA()(),t.TgZ(42,"div",21)(43,"button",22),t.NdJ("click",function(){return i.onSubmit()}),t._uU(44," Guardar "),t.qZA()()()),2&e){const s=t.MAs(14);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(3),t.Q6J("matDatepicker",s),t.xp6(1),t.Q6J("for",s),t.xp6(7),t.Q6J("ngForOf",i.tipos_movimientos),t.xp6(6),t.Q6J("ngForOf",i.fondos),t.xp6(5),t.Q6J("ngForOf",i.fondos)}},dependencies:[g.sg,d.lW,d.RK,c.KE,c.hX,c.R9,b.gD,Z.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,A.Nt,f.Hw,S.oG,v.Mq,v.hl,v.nW]}),o})();var J=n(2018),B=n(8288);function D(o,r){if(1&o&&(t.TgZ(0,"mat-option",10),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.idtipo),t.xp6(1),t.Oqu(e.descripcion)}}function j(o,r){if(1&o&&(t.TgZ(0,"mat-option",10),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.idfondo),t.xp6(1),t.Oqu(e.descripcion)}}function L(o,r){if(1&o&&(t.TgZ(0,"mat-option",10),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.idfondo),t.xp6(1),t.Oqu(e.descripcion)}}let R=(()=>{class o{constructor(e,i,s){this.data=e,this.menuService=i,this._movimientosService=s,this.tipos_movimientos=[]}ngOnInit(){this.getFondos(),this.getTiposMovimientos(),this.formFilters=new a.cw({fecha:new a.NI(""),bonificado:new a.NI(""),idtipo:new a.NI(""),origen:new a.NI(""),destino:new a.NI("")}),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({bonificado:-1,idtipo:-1,origen:-1,destino:-1})}onCloseMenu(e=null){this.menuService.close(e)}getFondos(){return this._movimientosService.getFondos(!0).subscribe(i=>{this.fondos=i})}getTiposMovimientos(){return this._movimientosService.getTiposMovimientos().subscribe(i=>{this.tipos_movimientos=i})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36("MENU_DATA"),t.Y36(u.r),t.Y36(p))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-filter-menu-movimientos"]],decls:50,vars:11,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],["formControlName","bonificado"],[3,"value"],["formControlName","idtipo"],[3,"value",4,"ngFor","ngForOf"],["formControlName","origen"],["formControlName","destino"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3,"Filtros"),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(6,"mat-icon",4),t._uU(7,"refresh"),t.qZA()(),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(9,"mat-icon",4),t._uU(10,"close"),t.qZA()()()(),t.TgZ(11,"form",6)(12,"span",7),t._uU(13,"Bonificado"),t.qZA(),t.TgZ(14,"mat-form-field",8)(15,"mat-select",9)(16,"mat-option",10),t._uU(17,"Todos"),t.qZA(),t.TgZ(18,"mat-option",10),t._uU(19,"Bonificado"),t.qZA(),t.TgZ(20,"mat-option",10),t._uU(21,"No bonificado"),t.qZA()()(),t.TgZ(22,"span",7),t._uU(23,"Tipo de movimiento"),t.qZA(),t.TgZ(24,"mat-form-field",8)(25,"mat-select",11)(26,"mat-option",10),t._uU(27,"Todos"),t.qZA(),t.YNc(28,D,2,2,"mat-option",12),t.qZA()(),t.TgZ(29,"span",7),t._uU(30,"Origen"),t.qZA(),t.TgZ(31,"mat-form-field",8)(32,"mat-select",13)(33,"mat-option",10),t._uU(34,"Todos"),t.qZA(),t.YNc(35,j,2,2,"mat-option",12),t.qZA()(),t.TgZ(36,"span",7),t._uU(37,"Destino"),t.qZA(),t.TgZ(38,"mat-form-field",8)(39,"mat-select",14)(40,"mat-option",10),t._uU(41,"Todos"),t.qZA(),t.YNc(42,L,2,2,"mat-option",12),t.qZA()()(),t.TgZ(43,"div",15)(44,"button",16),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(45,"span",17),t._uU(46,"Limpiar"),t.qZA()(),t.TgZ(47,"button",18),t.NdJ("click",function(){return i.onCloseMenu(i.formFilters.getRawValue())}),t.TgZ(48,"span",19),t._uU(49,"Filtrar"),t.qZA()()()()),2&e&&(t.Q6J("@expandCollapse","expanded"),t.xp6(11),t.Q6J("formGroup",i.formFilters),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0),t.xp6(6),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.tipos_movimientos),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.fondos),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.fondos))},dependencies:[g.sg,d.lW,d.RK,c.KE,b.gD,Z.ey,a._Y,a.JJ,a.JL,a.sg,a.u,f.Hw],data:{animation:B.L}}),o})();var G=n(1683),z=n(7374),X=n(8978);let K=(()=>{class o{constructor(e,i,s,m,M,C,it,ot){this._movimientosService=e,this._menuService=i,this.confirm=s,this.alert=m,this.dialogo=M,this._searchService=C,this.router=it,this._headerTextService=ot,this.dataSource=new N.by,this.column_params=["fecha","tipo","origen_descripcion","destino_descripcion","importe","descripcion","acciones"],this.headers=["Fecha","Tipo de movimiento","Origen","Destino","Importe","Descripci\xf3n"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["descripcion"],this.filter={bonificado:-1,idtipo:-1,origen:-1,destino:-1},this.extraParams="",this.parametrosActualizados=new t.vpe,this.env=l.N.fondos.view_movimientos+"?sort=-idmovimiento",this.search=new a.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,O.b)(250),(0,Q.x)()).subscribe(e=>{this.filtroBusqueda=e,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(e=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(e){let i=this.tabla.getElementosExistentes();this._menuService.open(R,e._elementRef,{filter:this.filter,elementos_existentes:i}).afterClosed().subscribe({next:s=>{s&&(this.filter=s,this.extraParams=-1!=this.filter?.bonificado?"filter[bonificado]="+this.filter.bonificado+"&":"",this.extraParams+=-1!=this.filter?.idtipo?"filter[idtipo]="+this.filter.idtipo+"&":"",this.extraParams+=-1!=this.filter?.origen?"filter[origen]="+this.filter.origen+"&":"",this.extraParams+=-1!=this.filter?.destino?"filter[destino]="+this.filter.destino+"&":"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(e){switch(e.name){case"editar":this.updateMovimiento(e);break;case"eliminar":this.deleteMovimiento(e)}}saveMovimiento(){this.dialogo.open(y,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updateMovimiento(e){this.dialogo.open(y,{data:e.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteMovimiento(e){this.confirm.open({title:"Eliminar Movimiento "+e.params.data.descripcion,message:"\xbfDesea eliminar la Movimiento: "+e.params.data.descripcion+"?",dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._movimientosService.deleteMovimiento(e.params.data.idmovimiento).subscribe({next:s=>{this.alert.success("Movimiento eliminado con \xe9xito."),i&&this.tabla.renderTabla()},error:s=>{console.error(s),alert("Este Movimiento no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(p),t.Y36(u.r),t.Y36(G.R),t.Y36(T.T),t.Y36(x.uw),t.Y36(z.o),t.Y36(h.F0),t.Y36(X.k))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-movimientos"]],viewQuery:function(e,i){if(1&e&&t.Gf(J.C,5),2&e){let s;t.iGM(s=t.CRH())&&(i.tabla=s.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-8","mt-2"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Movimiento",1,"mr-2","ml-2","bg-blue-500","p-2","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),t.NdJ("click",function(){return i.saveMovimiento()}),t.TgZ(5,"mat-icon",5),t._uU(6,"add"),t.qZA()()()(),t.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),t.NdJ("functionEmitter",function(m){return i.generarAcciones(m)}),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("cache",!1)("columnsNames",i.headers)("renderType","ssp")("columnsParams",i.column_params)("endpoint",i.env)("functions",i.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",i.filtersLike)("extraParams",i.extraParams))},dependencies:[d.RK,f.Hw,w.gM,J.C]}),o})();var W=n(8995),H=n(3276),V=n(2611),_=n(3873);const tt=[{path:"",component:K}];let et=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[p,u.r,T.T],imports:[g.ez,h.Bz.forChild(tt),N.p0,d.ot,b.LD,c.lN,a.UX,A.c,f.Ps,I.W,w.AV,W.Bb,U.g0,S.p9,v.FA,H.TU,V.JX,_.f,h.Bz]}),o})()}}]);