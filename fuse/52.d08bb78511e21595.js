"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[52],{5052:(Ft,U,d)=>{d.r(U),d.d(U,{MovimientosInternosModule:()=>yt});var F=d(1531),f=d(4755),O=d(9383),c=d(3627),h=d(1728),M=d(787),g=d(9114),r=d(9401),I=d(9609),$=d(5971),N=d(3686),A=d(430),w=d(6375),S=d(3649),t=d(2223),Q=d(8372),P=d(1884),p=d(5861),x=d(3905),D=d(8675),J=d(4004),b=d(5580),Z=d(1217),k=d(3611),v=d(2340),C=d(7579),E=d(3144),L=d(8951);let T=(()=>{class o{constructor(e,i){this.http=e,this._authService=i}saveMovimientoInterno(e){return this.http.post(`${v.N.stock.movimiento_internos}`,e)}updateMovimientoInterno(e,i){return this.http.put(`${v.N.stock.movimiento_internos}/`+i,e)}deleteMovimientoInterno(e){return this.http.delete(`${v.N.stock.movimiento_internos}/`+e)}getDepositos(e){let i="?";i+=e?"":"filter[activo]=1";let n=new C.x;return this.http.get(`${v.N.stock.depositos}${i}`).subscribe(a=>{n.next({list:a.result})}),n.asObservable()}getArticulosDepositos(e){let i=`?filter[deposito]=${e}`,n=new C.x;return this.http.get(`${v.N.stock.view_stock_articulo_depositos}${i}`).subscribe(a=>{n.next({list:a.result})}),n.asObservable()}getUnidadesDeMedidaArticulos(e){let i=`?filter[idarticulo]=${e}`;i+="&expand=um";let n=new C.x;return this.http.get(`${v.N.stock.articulo_unidad_medidas}${i}`).subscribe(a=>{n.next({list:a.result})}),n.asObservable()}getItems(e){let i=`?filter[idmovimientointerno]=${e}`,n=new C.x;return this.http.get(`${v.N.stock.view_stock_movimientos}${i}`).subscribe(a=>{n.next({list:a.result})}),n.asObservable()}getUsuarios(){let i=new C.x;return this.http.get(`${v.N.login.view_usuarios}?sort=asc`).subscribe(n=>{i.next({list:n.result})}),i.asObservable()}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(E.eN),t.LFG(L.e))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})();var y=d(8995);function R(o,s){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.codigo_interno," - ",e.descripcion," ")}}function j(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarCasillero("articulo"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function B(o,s){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.idunidadmedida),t.xp6(1),t.Oqu(e.descripcion_um)}}function G(o,s){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.iddeposito),t.xp6(1),t.Oqu(e.descripcion)}}let H=(()=>{class o{constructor(e,i,n,a,l,m){this.data=e,this._movimientosInternosService=i,this.datePipe=n,this.alert=a,this.dialogRef=l,this.dialogo=m,this.columns=["articulo","cantidad","unidadmedida","deposito destino","acciones"],this.articulos=[],this.unidades_de_medida=[],this.depositos=[],this.articulos_list=[],this.dataSource=new c.by,this.title="A\xf1adir movimiento de articulo"}ngOnInit(){this.newForm(),this.getArticulosDepositos(),this.getDepositos()}getArticulosDepositos(){var e=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(e._movimientosInternosService.getArticulosDepositos(e.data.deposito_egreso));new Promise(function(){var n=(0,p.Z)(function*(a){e.articulos=i.list,e.filteredArticulos=e.form.get("articulo").valueChanges.pipe((0,D.O)(""),(0,J.U)(l=>e._filterArticulos(l))),a(!0)});return function(a){return n.apply(this,arguments)}}()),i.list.forEach(n=>{e.articulos_list.find(l=>l.idarticulo===n.idarticulo)||e.articulos_list.push({idarticulo:n.idarticulo,codigo_interno:n.codigo_interno,descripcion:n.descripcion})})})()}_filterArticulos(e){const i=e.toString().toLowerCase();return this.articulos_list.filter(n=>{const a=n.codigo_interno.toString().toLowerCase().includes(i),l=n.descripcion.toString().toLowerCase().includes(i);return a||l})}getTextArticulo(e){return e?`${e.codigo_interno} - ${e.descripcion}`:""}getUnidadesDeMedidaArticulos(e){var i=this;new Promise(function(){var n=(0,p.Z)(function*(a){i.unidades_de_medida=i.articulos.filter(l=>l.idarticulo===e).map(l=>({idarticulo:l.idarticulo,idunidadmedida:l.idunidadmedida,descripcion_um:l.um,stock:l.stock})),a(!0)});return function(a){return n.apply(this,arguments)}}())}getDepositos(e){var i=this;return(0,p.Z)(function*(){const n=yield(0,x.z)(i._movimientosInternosService.getDepositos(e));new Promise(function(){var a=(0,p.Z)(function*(l){i.depositos=n.list.filter(m=>m.iddeposito!=i.data.deposito_egreso),l(!0)});return function(l){return a.apply(this,arguments)}}())})()}seleccionArticulo(e){if(e.idarticulo&&(this.form.get("unidadmedida").enable(),this.getUnidadesDeMedidaArticulos(e.idarticulo)),e.um){let n,i=this.unidades_de_medida.find(m=>m.idarticulo===this.form.get("articulo").value.idarticulo&&m.idunidadmedida===this.form.get("unidadmedida").value),a=0;this.data.movimientos.length>0?(this.data.movimientos.filter(u=>u.idarticulo===i.idarticulo&&u.idunidadmedida===i.idunidadmedida).forEach(u=>{a+=Number(u.cantidad)}),n=""+(Number(i.stock)-a)):n=i.stock,this.form.get("stock_existente").setValue(n)}}limpiarCasillero(e){"articulo"==e&&(this.form.get("articulo").setValue(""),this.form.get("unidadmedida").disable(),this.form.get("unidadmedida").setValue(""),this.form.get("stock_existente").setValue(""))}newForm(){this.form=new r.cw({articulo:new r.NI("",r.kI.required),unidadmedida:new r.NI("",r.kI.required),cantidad:new r.NI("",r.kI.required),deposito_ingreso:new r.NI("",r.kI.required),stock_existente:new r.NI("")})}onSubmit(){if(!this.form.valid)return alert("Revise Los Datos Ingresados");this.articulos.forEach(e=>{if(e.idarticulo===this.form.get("articulo").value.idarticulo&&e.idunidadmedida===this.form.get("unidadmedida").value){if(this.form.get("cantidad").value>e.stock)return this.form.get("cantidad").setValue(""),alert("No hay stock suficiente!");if(this.data.movimientos.find(n=>n.idarticulo===this.form.get("articulo").value.idarticulo&&n.idunidadmedida===this.form.get("unidadmedida").value&&n.deposito_ingreso===this.form.get("deposito_ingreso").value))return this.form.get("deposito_ingreso").setValue(""),alert("En ese deposito ya existe un movimiento de ese articulo con esa unidad de medida!");if(this.form.get("cantidad").value<=e.stock&&this.form.get("cantidad").value>0){let n=this.unidades_de_medida.find(m=>m.idunidadmedida===this.form.get("unidadmedida").value),a=this.depositos.find(m=>m.iddeposito===this.form.get("deposito_ingreso").value),l={articulo:this.form.get("articulo").value,unidad_medida:this.form.get("unidadmedida").value,cantidad:this.form.get("cantidad").value,deposito_ingreso:this.form.get("deposito_ingreso").value,unidadmedida_descripcion:n.descripcion_um,decripcion_deposito_ingreso:a.descripcion,stock:""+(Number(e.stock)-this.form.get("cantidad").value)};this.onCloseMenu(l)}}})}onCloseMenu(e){this.dialogRef.close(e||!1)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(b.WI),t.Y36(T),t.Y36(f.uU),t.Y36(w.T),t.Y36(b.so),t.Y36(b.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-articulo-movimientos-internos"]],features:[t._Bn([{provide:Z.sG,useValue:k.x}])],decls:41,vars:10,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","articulo",3,"matAutocomplete","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","unidadmedida",3,"ngModelChange"],["appearance","outline",1,"w-1/3"],["matInput","","type","text","formControlName","stock_existente","readonly","true"],["matInput","","type","number","formControlName","cantidad"],["formControlName","deposito_ingreso"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div")(10,"div",6)(11,"mat-form-field",7)(12,"mat-label"),t._uU(13,"Art\xedculo"),t.qZA(),t.TgZ(14,"input",8),t.NdJ("ngModelChange",function(a){return i.seleccionArticulo(a)}),t.qZA(),t.TgZ(15,"mat-autocomplete",9,10),t.YNc(17,R,2,3,"mat-option",11),t.ALo(18,"async"),t.qZA(),t.YNc(19,j,3,0,"button",12),t.qZA(),t.TgZ(20,"mat-form-field",7)(21,"mat-label"),t._uU(22,"UM"),t.qZA(),t.TgZ(23,"mat-select",13),t.NdJ("ngModelChange",function(a){return i.seleccionArticulo({um:a})}),t.YNc(24,B,2,2,"mat-option",11),t.qZA()(),t.TgZ(25,"mat-form-field",14)(26,"mat-label"),t._uU(27,"En stock"),t.qZA(),t._UZ(28,"input",15),t.qZA(),t.TgZ(29,"mat-form-field",14)(30,"mat-label"),t._uU(31,"Cantidad"),t.qZA(),t._UZ(32,"input",16),t.qZA(),t.TgZ(33,"mat-form-field",7)(34,"mat-label"),t._uU(35,"Dep\xf3sitos Destino"),t.qZA(),t.TgZ(36,"mat-select",17),t.YNc(37,G,2,2,"mat-option",11),t.qZA()()()()(),t.TgZ(38,"div",18)(39,"button",19),t.NdJ("click",function(){return i.onSubmit()}),t._uU(40," A\xf1adir "),t.qZA()()()),2&e){const n=t.MAs(16);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(6),t.Q6J("matAutocomplete",n),t.xp6(1),t.Q6J("displayWith",i.getTextArticulo),t.xp6(2),t.Q6J("ngForOf",t.lcZ(18,8,i.filteredArticulos)),t.xp6(2),t.Q6J("ngIf",i.form.get("articulo").value),t.xp6(5),t.Q6J("ngForOf",i.unidades_de_medida),t.xp6(13),t.Q6J("ngForOf",i.depositos)}},dependencies:[f.sg,f.O5,h.lW,h.RK,g.KE,g.hX,g.R9,M.gD,Z.ey,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.sg,r.u,I.Nt,A.Hw,y.XC,y.ZL,f.Ov]}),o})();var _=d(8280);function V(o,s){if(1&o&&(t.TgZ(0,"mat-option",36),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.descripcion," ")}}function z(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",37),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarCasillero("deposito_egreso"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function K(o,s){1&o&&(t.TgZ(0,"th",38),t._uU(1," Articulo"),t.qZA())}function W(o,s){if(1&o&&(t.TgZ(0,"td",39),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.descripcion_articulo," ")}}function X(o,s){1&o&&(t.TgZ(0,"th",38),t._uU(1," Codigo Interno"),t.qZA())}function tt(o,s){if(1&o&&(t.TgZ(0,"td",39),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.codigo_interno," ")}}function et(o,s){1&o&&(t.TgZ(0,"th",38),t._uU(1,"Cantidad"),t.qZA())}function it(o,s){if(1&o&&(t.TgZ(0,"td",39),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.cantidad," ")}}function ot(o,s){1&o&&(t.TgZ(0,"th",38),t._uU(1,"Unidad de medida"),t.qZA())}function nt(o,s){if(1&o&&(t.TgZ(0,"td",39),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.descripcion_um," ")}}function st(o,s){1&o&&(t.TgZ(0,"th",38),t._uU(1,"Dep\xf3sito Destino"),t.qZA())}function at(o,s){if(1&o&&(t.TgZ(0,"td",39),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.descripcion_deposito_ingreso," ")}}function rt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"th",38)(1,"button",40),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.addMovimiento())}),t.TgZ(2,"mat-icon"),t._uU(3,"add"),t.qZA()()()}}function lt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"td",39)(1,"button",3,41),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.deleteMovimiento(a))}),t.TgZ(3,"mat-icon",42),t._uU(4,"delete"),t.qZA()()()}}function dt(o,s){1&o&&t._UZ(0,"tr",43)}function mt(o,s){1&o&&t._UZ(0,"tr",44)}const ct=function(o){return{"reached-max":o}};let Y=(()=>{class o{constructor(e,i,n,a,l,m){this.data=e,this._movimientosInternosService=i,this.datePipe=n,this.alert=a,this.dialogRef=l,this.dialogo=m,this.columns=["articulo","codigointerno","cantidad","unidadmedida","deposito_ingreso","acciones"],this.depositos=[],this.unidades_de_medida=[],this.mov_art_list=[],this.maxPalabras=50,this.dataSource=new c.by,this.movimiento_interno=this.data?this.data:null,this.title=this.movimiento_interno?.idmovimientointerno?`Editar Movimiento interno ${this.movimiento_interno.fecha} - ${this.movimiento_interno.hora}`:"Nuevo Movimiento interno",this.user=JSON.parse(localStorage.getItem("user")),this.minDate=null,this.maxDate=new Date}ngOnInit(){this.newForm(),this.exist()}newForm(){const[e,i,n]=this.movimiento_interno?this.movimiento_interno.fecha.split("/"):"";this.movimiento_interno&&this.getItems(this.movimiento_interno.idmovimientointerno).then(a=>{this.mov_art_list=a.map(l=>({idarticulo:l.idarticulo,cantidad:l.cantidad,idunidadmedida:l.idunidadmedida,descripcion_articulo:l.descripcion_articulo,descripcion_um:l.descripcion_um,codigo_interno:l.codigo_interno_articulo,deposito_ingreso:l.deposito_ingreso,descripcion_deposito_ingreso:l.descripcion_deposito_ingreso,stock:l.stock_minimo_articulo})),this.dataSource=new c.by(this.mov_art_list),0!=this.mov_art_list.length?this.form.get("deposito_egreso").disable():this.form.get("deposito_egreso").enable()}),this.form=new r.cw({fecha:new r.NI(this.datePipe.transform(this.movimiento_interno?.fecha?new Date(`${i}/${e}/${n}`):new Date,"yyyy-MM-dd"),[r.kI.required]),hora:new r.NI(this.movimiento_interno?.hora?this.movimiento_interno.hora:this.datePipe.transform(new Date,"HH:mm"),[r.kI.required]),deposito_egreso:new r.NI(this.movimiento_interno?this.movimiento_interno.deposito:"",r.kI.required),observaciones:new r.NI(this.movimiento_interno?this.movimiento_interno.observaciones:"",[r.kI.maxLength(this.maxPalabras)])})}getPalabrasLength(){const e=this.form.get("observaciones").value;return e?e.length:0}isPalabraMaxLengthReached(){return this.getPalabrasLength()<=this.maxPalabras}exist(){this.movimiento_interno?.idmovimientointerno?this.getDepositos(!0):this.getDepositos()}getDepositos(e){var i=this;return(0,p.Z)(function*(){const n=yield(0,x.z)(i._movimientosInternosService.getDepositos(e));new Promise(function(){var a=(0,p.Z)(function*(l){i.depositos=n.list,i.filteredDepositos=i.form.get("deposito_egreso").valueChanges.pipe((0,D.O)(""),(0,J.U)(m=>i._filterDepositos(m))),l(!0)});return function(l){return a.apply(this,arguments)}}())})()}_filterDepositos(e){const i=e.toString().toLowerCase();return this.depositos.filter(n=>n.descripcion.toLowerCase().includes(i))}getTextDeposito(e){return e.descripcion?e.descripcion:e.deposito?e.deposito:e}getItems(e){var i=this;return(0,p.Z)(function*(){return new Promise(function(){var n=(0,p.Z)(function*(a){const l=yield(0,x.z)(i._movimientosInternosService.getItems(e));i.mov_art_list=l.list,a(i.mov_art_list)});return function(a){return n.apply(this,arguments)}}())})()}addMovimiento(){if(""!=this.form.get("deposito_egreso").value){let e=this.form.get("deposito_egreso").value.iddeposito;"string"==typeof this.form.get("deposito_egreso").value&&(e=this.depositos.find(n=>n.descripcion===this.form.get("deposito_egreso").value).iddeposito),this.dialogo.open(H,{panelClass:"ayuda-dialog",data:{deposito_egreso:e,movimientos:this.mov_art_list}}).afterClosed().subscribe({next:i=>{i&&(this.mov_art_list=[...this.mov_art_list,{idarticulo:i.articulo.idarticulo,cantidad:i.cantidad,idunidadmedida:i.unidad_medida,descripcion_articulo:i.articulo.descripcion,descripcion_um:i.unidadmedida_descripcion,codigo_interno:i.articulo.codigo_interno,deposito_ingreso:i.deposito_ingreso,descripcion_deposito_ingreso:i.decripcion_deposito_ingreso,stock:i.stock}],this.dataSource=new c.by(this.mov_art_list),0!=this.mov_art_list.length&&this.form.get("deposito_egreso").disable())}})}else alert("Seleccione un Dep\xf3sito de origen")}deleteMovimiento(e){this.mov_art_list.forEach(i=>{i.idarticulo==e.idarticulo&&i.idunidadmedida==e.idunidadmedida&&(i.stock=`${Number(i.stock)+i.cantidad}`)}),this.mov_art_list=this.mov_art_list.filter(i=>i!==e),this.dataSource=new c.by(this.mov_art_list),0===this.mov_art_list.length&&this.form.get("deposito_egreso").enable()}limpiarCasillero(e){this.form.get(e).setValue("")}onSubmit(){if(!this.isPalabraMaxLengthReached())return alert(`La longitud m\xe1xima de observaciones es de ${this.maxPalabras} caracteres.`);if(!this.form.valid)return alert("Revise Los Datos Ingresados");{let e=this.mov_art_list.map(u=>({deposito_ingreso:u.deposito_ingreso,idarticulo:u.idarticulo,cantidad:u.cantidad,idunidadmedida:u.idunidadmedida}));if(0===e.length)return alert("Debe ingresar un articulo al orden de compra");const i=this.form.get("fecha").value,n=this.form.get("hora").value,l=`${this.datePipe.transform(i,"yyyy-MM-dd")} ${n}`,m={movimiento_interno:{idusuario:this.user.id,fecha_hora:l,iddeposito:this.form.get("deposito_egreso").value.iddeposito,observaciones:this.form.get("observaciones").value},movimientos:e};this.movimiento_interno?.idmovimientointerno?this._movimientosInternosService.updateMovimientoInterno(m,this.movimiento_interno.idmovimientointerno).subscribe({next:u=>{u&&this.dialogRef.close(u)}}):this._movimientosInternosService.saveMovimientoInterno(m).subscribe({next:u=>{u&&this.dialogRef.close(u)}})}}onCloseMenu(){this.dialogRef.close(!1)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(b.WI),t.Y36(T),t.Y36(f.uU),t.Y36(w.T),t.Y36(b.so),t.Y36(b.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-save-movimiento-interno"]],features:[t._Bn([{provide:Z.sG,useValue:k.x}])],decls:61,vars:21,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"shadow-md","mb-3"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/4"],["matInput","","placeholder","Fecha","formControlName","fecha","readonly","true",3,"matDatepicker","min","max"],["matSuffix","",3,"for"],["picker",""],["matInput","","formControlName","hora","type","time"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","deposito_egreso",3,"matAutocomplete"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["appearance","outline",1,"w-full"],["matInput","","formControlName","observaciones",1,"resize-none"],[1,"counter",3,"ngClass"],[1,"overflow-y-auto","max-h-[150px]","h-[150px]","shadow-xl","pb-10","border-t-2","border-slate-200"],["mat-table","",1,"w-full","mt-1",3,"dataSource"],["matColumnDef","articulo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","codigointerno"],["matColumnDef","cantidad"],["matColumnDef","unidadmedida"],["matColumnDef","deposito_ingreso"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-mini-fab","","color","primary","matTooltip","A\xf1adir Articulo","aria-label","icon",1,"rounded-full",3,"click"],["delete",""],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div",6)(10,"div",7)(11,"mat-form-field",8),t._UZ(12,"input",9)(13,"mat-datepicker-toggle",10)(14,"mat-datepicker",null,11),t.qZA(),t.TgZ(16,"mat-form-field",8)(17,"mat-label"),t._uU(18,"Hora"),t.qZA(),t._UZ(19,"input",12),t.qZA(),t.TgZ(20,"mat-form-field",13)(21,"mat-label"),t._uU(22,"Dep\xf3sito Origen"),t.qZA(),t._UZ(23,"input",14),t.TgZ(24,"mat-autocomplete",15,16),t.YNc(26,V,2,2,"mat-option",17),t.ALo(27,"async"),t.qZA(),t.YNc(28,z,3,0,"button",18),t.qZA()(),t.TgZ(29,"div")(30,"mat-form-field",19)(31,"mat-label"),t._uU(32,"Observaciones"),t.qZA(),t._UZ(33,"textarea",20),t.TgZ(34,"div",21),t._uU(35),t.qZA()()()(),t.TgZ(36,"div",22)(37,"table",23),t.ynx(38,24),t.YNc(39,K,2,0,"th",25),t.YNc(40,W,2,1,"td",26),t.BQk(),t.ynx(41,27),t.YNc(42,X,2,0,"th",25),t.YNc(43,tt,2,1,"td",26),t.BQk(),t.ynx(44,28),t.YNc(45,et,2,0,"th",25),t.YNc(46,it,2,1,"td",26),t.BQk(),t.ynx(47,29),t.YNc(48,ot,2,0,"th",25),t.YNc(49,nt,2,1,"td",26),t.BQk(),t.ynx(50,30),t.YNc(51,st,2,0,"th",25),t.YNc(52,at,2,1,"td",26),t.BQk(),t.ynx(53,31),t.YNc(54,rt,4,0,"th",25),t.YNc(55,lt,5,0,"td",26),t.BQk(),t.YNc(56,dt,1,0,"tr",32),t.YNc(57,mt,1,0,"tr",33),t.qZA()()(),t.TgZ(58,"div",34)(59,"button",35),t.NdJ("click",function(){return i.onSubmit()}),t._uU(60," Guardar "),t.qZA()()()),2&e){const n=t.MAs(15),a=t.MAs(25);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(4),t.Q6J("matDatepicker",n)("min",i.minDate)("max",i.maxDate),t.xp6(1),t.Q6J("for",n),t.xp6(10),t.Q6J("matAutocomplete",a),t.xp6(1),t.Q6J("displayWith",i.getTextDeposito),t.xp6(2),t.Q6J("ngForOf",t.lcZ(27,17,i.filteredDepositos)),t.xp6(2),t.Q6J("ngIf",i.form.get("deposito_egreso").value&&0==i.mov_art_list.length),t.xp6(6),t.Q6J("ngClass",t.VKq(19,ct,!i.isPalabraMaxLengthReached())),t.xp6(1),t.AsE(" ",i.getPalabrasLength(),"/",i.maxPalabras," "),t.xp6(2),t.Q6J("dataSource",i.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",i.columns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",i.columns)}},dependencies:[f.mk,f.sg,f.O5,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,h.lW,h.RK,h.nh,g.KE,g.hX,g.R9,Z.ey,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,I.Nt,A.Hw,S.gM,y.XC,y.ZL,_.Mq,_.hl,_.nW,f.Ov],styles:['@charset "UTF-8";.counter[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;right:.5rem;font-size:.75rem;color:#c9c9c9}.counter.reached-max[_ngcontent-%COMP%]{color:#e53e3e}']}),o})();var q=d(2018),ut=d(8288);function ft(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarFechas())}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function pt(o,s){if(1&o&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.iddeposito),t.xp6(1),t.Oqu(e.descripcion)}}function ht(o,s){if(1&o&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.codigo),t.xp6(1),t.hij("",e.nick," ")}}let gt=(()=>{class o{constructor(e,i,n,a){this.data=e,this._menuService=i,this.datePipe=n,this._movimientosInternosService=a,this.usuarios=[],this.filterDeposito=[],this.filterUsuarios=[],this.filterFechas=[],this.movimientos_internos_list=[]}ngOnInit(){this.formFilters=new r.cw({filtroFechaInicio:new r.NI(""),filtroFechaFin:new r.NI(""),usuario:new r.NI(-1),deposito:new r.NI(-1)}),this.getDepositos(),this.getUsuarios(),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({filtroFechaInicio:"",filtroFechaFin:"",usuario:-1,deposito:-1})}onCloseMenu(e=null){e&&(e.filtroFechaInicio=this.datePipe.transform(this.formFilters.get("filtroFechaInicio").value,"yyyy-MM-dd"),e.filtroFechaFin=this.datePipe.transform(this.formFilters.get("filtroFechaFin").value,"yyyy-MM-dd")),this._menuService.close(e)}limpiarFechas(){this.formFilters.get("filtroFechaInicio").setValue(""),this.formFilters.get("filtroFechaFin").setValue("")}getUsuarios(){var e=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(e._movimientosInternosService.getUsuarios());e.filterUsuarios=i.list})()}getDepositos(){var e=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(e._movimientosInternosService.getDepositos(!0));e.filterDeposito=i.list})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36("MENU_DATA"),t.Y36(N.r),t.Y36(f.uU),t.Y36(T))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-filter-menu-movimientos-internos"]],features:[t._Bn([{provide:Z.sG,useValue:k.x}])],decls:43,vars:9,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base","mt-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],[3,"rangePicker"],["matStartDate","","placeholder","Desde","formControlName","filtroFechaInicio"],["matEndDate","","placeholder","Hasta","formControlName","filtroFechaFin"],["matIconSuffix","",3,"for"],["picker",""],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","deposito"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuario"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3,"Filtros"),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(6,"mat-icon",4),t._uU(7,"refresh"),t.qZA()(),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(9,"mat-icon",4),t._uU(10,"close"),t.qZA()()()(),t.TgZ(11,"form",6)(12,"span",7),t._uU(13,"Rango de fechas"),t.qZA(),t.TgZ(14,"mat-form-field",8)(15,"mat-date-range-input",9),t._UZ(16,"input",10)(17,"input",11),t.qZA(),t._UZ(18,"mat-datepicker-toggle",12)(19,"mat-date-range-picker",null,13),t.YNc(21,ft,3,0,"button",14),t.qZA(),t.TgZ(22,"span",7),t._uU(23,"Dep\xf3sito Origen"),t.qZA(),t.TgZ(24,"mat-form-field",8)(25,"mat-select",15)(26,"mat-option",16),t._uU(27,"Todos"),t.qZA(),t.YNc(28,pt,2,2,"mat-option",17),t.qZA()(),t.TgZ(29,"span",7),t._uU(30,"Usuario"),t.qZA(),t.TgZ(31,"mat-form-field",8)(32,"mat-select",18)(33,"mat-option",16),t._uU(34,"Todos"),t.qZA(),t.YNc(35,ht,2,2,"mat-option",17),t.qZA()()(),t.TgZ(36,"div",19)(37,"button",20),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(38,"span",21),t._uU(39,"Limpiar"),t.qZA()(),t.TgZ(40,"button",22),t.NdJ("click",function(){return i.onCloseMenu(i.formFilters.getRawValue())}),t.TgZ(41,"span",23),t._uU(42,"Filtrar"),t.qZA()()()()),2&e){const n=t.MAs(20);t.Q6J("@expandCollapse","expanded"),t.xp6(11),t.Q6J("formGroup",i.formFilters),t.xp6(4),t.Q6J("rangePicker",n),t.xp6(3),t.Q6J("for",n),t.xp6(3),t.Q6J("ngIf",i.formFilters.get("filtroFechaInicio").value||i.formFilters.get("filtroFechaFin").value),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterDeposito),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterUsuarios)}},dependencies:[f.sg,f.O5,h.lW,h.RK,g.KE,g.R9,M.gD,Z.ey,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,A.Hw,_.nW,_.wx,_.zY,_.By,_._g],data:{animation:ut.L}}),o})();var vt=d(1683),_t=d(7374),bt=d(8978);let xt=(()=>{class o{constructor(e,i,n,a,l,m,u,wt){this._movimientosInternosService=e,this.confirm=i,this.alert=n,this.dialogo=a,this._searchService=l,this._menuService=m,this.router=u,this._headerTextService=wt,this.dataSource=new c.by,this.headers=["Fecha","Hora","Responsable","Observaciones","Deposito","Acciones"],this.column_params=["fecha","hora","nick","observaciones","deposito","acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["observaciones","nick","deposito"],this.filter={deposito:-1,filtroFechaInicio:"",filtroFechaFin:""},this.extraParams="",this.parametrosActualizados=new t.vpe,this.env=v.N.stock.movimiento_internos+"?sort=-idmovimientointerno",this.search=new r.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,Q.b)(750),(0,P.x)()).subscribe(e=>{this.filtroBusqueda=e,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(e=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(e){this._menuService.open(gt,e._elementRef,{filter:this.filter,data:this.tabla.getElementosExistentes()}).afterClosed().subscribe({next:i=>{i&&(this.filter=i,this.extraParams=-1!=this.filter.deposito?"filter[iddeposito]="+this.filter.deposito+"&":"",this.extraParams+=-1!=this.filter.usuario?"filter[idusuario]="+this.filter.usuario+"&":"",this.extraParams+=null!=this.filter.filtroFechaInicio?"filter[fecha][gte]="+this.filter.filtroFechaInicio+"&":"",this.extraParams+=null!=this.filter.filtroFechaFin?"filter[fecha][lte]="+this.filter.filtroFechaFin+"&":"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(e){switch(e.name){case"editar":this.updateMovimientoInterno(e);break;case"eliminar":this.deleteMovimientoInterno(e)}}saveMovimientoInterno(){this.dialogo.open(Y,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updateMovimientoInterno(e){this.dialogo.open(Y,{data:e.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteMovimientoInterno(e){this.confirm.open({title:"Eliminar Movimiento interno: "+e.params.data.fecha,message:`\xbfDesea eliminar el movimiento interno realizado el: ${e.params.data.fecha} ${e.params.data.hora}; del dep\xf3sito: ${e.params.data.deposito} ?`,dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._movimientosInternosService.deleteMovimientoInterno(e.params.data.idmovimientointerno).subscribe({next:n=>{alert("Movimiento interno eliminado con \xe9xito."),n&&this.tabla.renderTabla()},error:n=>{console.error("Error en el servicio:",n),alert("Este movimiento interno no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(T),t.Y36(vt.R),t.Y36(w.T),t.Y36(b.uw),t.Y36(_t.o),t.Y36(N.r),t.Y36(F.F0),t.Y36(bt.k))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-movimientos-internos"]],viewQuery:function(e,i){if(1&e&&t.Gf(q.C,5),2&e){let n;t.iGM(n=t.CRH())&&(i.tabla=n.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-4","mt-2","pb-4"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Movimiento interno",1,"mr-2","ml-2","bg-blue-500","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2","mt-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),t.NdJ("click",function(){return i.saveMovimientoInterno()}),t.TgZ(5,"mat-icon",5),t._uU(6,"add"),t.qZA()()()(),t.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),t.NdJ("functionEmitter",function(a){return i.generarAcciones(a)}),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("cache",!1)("columnsNames",i.headers)("renderType","ssp")("columnsParams",i.column_params)("endpoint",i.env)("functions",i.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",i.filtersLike)("extraParams",i.extraParams))},dependencies:[h.RK,A.Hw,S.gM,q.C]}),o})();var Zt=d(1292),At=d(2611),Ct=d(3873);const Tt=[{path:"",component:xt}];let yt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[T,N.r,w.T,f.uU],imports:[f.ez,F.Bz.forChild(Tt),c.p0,h.ot,M.LD,g.lN,r.UX,I.c,A.Ps,$.W,S.AV,y.Bb,O.g0,Zt.p9,At.JX,Ct.f,b.Is,_.FA,F.Bz]}),o})()}}]);