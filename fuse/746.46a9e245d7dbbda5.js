"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[746],{1746:(V,g,s)=>{s.r(g),s.d(g,{PedidosDePresupuestoModule:()=>$});var f=s(1531),x=s(4755),y=s(9383),C=s(3627),u=s(1728),h=s(787),l=s(9114),n=s(9401),T=s(9609),w=s(5971),v=s(3686),c=s(430),b=s(6375),D=s(3649),e=s(2223),N=s(8372),A=s(1884),p=s(5580),P=s(2340),J=s(7579),M=s(3144),U=s(8951);let m=(()=>{class i{constructor(t,o){this.http=t,this._authService=o}getPedidosDePresupuesto(t){let o="?";o+="desc"==t?"sort=-descripcion":"sort=descripcion";let r=new J.x;return this.http.get(`${P.N.administracion.view_clientes}${o}`).subscribe(d=>{this._authService.accessToken=d.token,r.next({list:d.result})}),r.asObservable()}savePedidosDePresupuesto(t){return this.http.post("",t)}updatePedidosDePresupuesto(t){return this.http.put("/"+t.idpedido,t)}deletePedidosDePresupuesto(t){return this.http.delete("/"+t)}getProveedores(){return this.http.get(`${P.N.administracion.proveedores}?filter[activo]=1&sort=RazonSocial`)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(M.eN),e.LFG(U.e))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var S=s(1217);let Z=(()=>{class i{constructor(t,o,r,d){this.data=t,this._pedidosDePresupuestoService=o,this.alert=r,this.dialogRef=d,this.columns=["nombre","activo","acciones"],this.pedido_de_presupuesto=this.data?this.data:null,this.title=this.pedido_de_presupuesto?.idpedido?"Editar pedido de presupuesto":"Nuevo pedido de presupuesto"}ngOnInit(){this.newForm()}newForm(){this.form=new n.cw({fecha:new n.NI(this.pedido_de_presupuesto?this.pedido_de_presupuesto.fecha:"",n.kI.required),observaciones:new n.NI(this.pedido_de_presupuesto?this.pedido_de_presupuesto.observaciones:"",n.kI.required)})}onSubmit(){if(!this.form.valid)return this.alert.warning("Revise Los Datos Ingresados");this.pedido_de_presupuesto={...this.pedido_de_presupuesto,fecha:this.form.get("fecha").value,observaciones:this.form.get("observaciones").value},this.pedido_de_presupuesto.idpedido?this._pedidosDePresupuestoService.updatePedidosDePresupuesto(this.pedido_de_presupuesto).subscribe({next:t=>{t&&this.onCloseMenu()}}):this._pedidosDePresupuestoService.savePedidosDePresupuesto(this.pedido_de_presupuesto).subscribe({next:t=>{t&&this.onCloseMenu()}})}onCloseMenu(){this.dialogRef.close()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(p.WI),e.Y36(m),e.Y36(b.T),e.Y36(p.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-save-pedidos-de-presupuesto"]],decls:24,vars:4,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","md:min-w-140","sm:min-w-90","sm:w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","bg-white","shadow-sm","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","nombre"],["formControlName","activo"],[3,"value"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"rounded-sm",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return o.onCloseMenu()}),e.TgZ(6,"mat-icon",4),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"form",5)(9,"mat-form-field",6)(10,"mat-label"),e._uU(11,"Nombre"),e.qZA(),e._UZ(12,"input",7),e.qZA(),e.TgZ(13,"mat-form-field",6)(14,"mat-label"),e._uU(15,"Activo"),e.qZA(),e.TgZ(16,"mat-select",8)(17,"mat-option",9),e._uU(18,"No"),e.qZA(),e.TgZ(19,"mat-option",9),e._uU(20,"Si"),e.qZA()()()(),e.TgZ(21,"div",10)(22,"button",11),e.NdJ("click",function(){return o.onSubmit()}),e._uU(23," Guardar "),e.qZA()()()),2&t&&(e.xp6(3),e.Oqu(o.title),e.xp6(5),e.Q6J("formGroup",o.form),e.xp6(9),e.Q6J("value",0),e.xp6(2),e.Q6J("value",1))},dependencies:[u.lW,u.RK,l.KE,l.hX,h.gD,S.ey,n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u,T.Nt,c.Hw]}),i})();var F=s(2018),Y=s(8288);function z(i,a){if(1&i&&(e.TgZ(0,"mat-option",10),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.Codigo),e.xp6(1),e.Oqu(t.RazonSocial)}}let E=(()=>{class i{constructor(t,o,r){this.data=t,this.menuService=o,this._pedidoDePresupuestoService=r,this.proveedores=[]}ngOnInit(){this.formFilters=new n.cw({proveedor:new n.NI("")}),this.formFilters.patchValue(this.data.filter),this.getProveedores()}resetFilters(){this.formFilters.reset({proveedor:-1})}onCloseMenu(t=null){this.menuService.close(t)}getProveedores(){return this._pedidoDePresupuestoService.getProveedores().subscribe(o=>{this.proveedores=o})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36("MENU_DATA"),e.Y36(v.r),e.Y36(m))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-filter-menu-pedidos-de-presupuesto"]],decls:26,vars:4,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],["formControlName","proveedor"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"Filtros"),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return o.resetFilters()}),e.TgZ(6,"mat-icon",4),e._uU(7,"refresh"),e.qZA()(),e.TgZ(8,"button",5),e.NdJ("click",function(){return o.onCloseMenu()}),e.TgZ(9,"mat-icon",4),e._uU(10,"close"),e.qZA()()()(),e.TgZ(11,"form",6)(12,"span",7),e._uU(13,"Origen"),e.qZA(),e.TgZ(14,"mat-form-field",8)(15,"mat-select",9)(16,"mat-option",10),e._uU(17,"Todos"),e.qZA(),e.YNc(18,z,2,2,"mat-option",11),e.qZA()()(),e.TgZ(19,"div",12)(20,"button",13),e.NdJ("click",function(){return o.resetFilters()}),e.TgZ(21,"span",14),e._uU(22,"Limpiar"),e.qZA()(),e.TgZ(23,"button",15),e.NdJ("click",function(){return o.onCloseMenu(o.formFilters.getRawValue())}),e.TgZ(24,"span",16),e._uU(25,"Filtrar"),e.qZA()()()()),2&t&&(e.Q6J("@expandCollapse","expanded"),e.xp6(11),e.Q6J("formGroup",o.formFilters),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",o.proveedores))},dependencies:[x.sg,u.lW,u.RK,l.KE,h.gD,S.ey,n._Y,n.JJ,n.JL,n.sg,n.u,c.Hw],data:{animation:Y.L}}),i})();var O=s(1683),R=s(7374),I=s(8978);let j=(()=>{class i{constructor(t,o,r,d,X,K,H,W){this._pedidoDePresupuestosService=t,this.confirm=o,this.alert=r,this.dialogo=d,this._searchService=X,this._menuService=K,this.router=H,this._headerTextService=W,this.dataSource=new C.by,this.headers=["Numero","Fecha","Proveedores","Acciones"],this.column_params=["idpedido","fecha","proveedores.0.proveedor.RazonSocial","acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["proveedor.RazonSocial"],this.filter={activo:-1},this.extraParams="",this.parametrosActualizados=new e.vpe,this.env=P.N.compras.pedido_presupuestos+"?expand=proveedores.proveedor",this.search=new n.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"},{icono:"comment",nombre_boton:"Cotizaciones",functionName:"cotizaciones"},{icono:"compare_arrows",nombre_boton:"Comparativa",functionName:"comparativa"},{icono:"send",nombre_boton:"Enviar pedido",functionName:"enviar_pedido"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,N.b)(750),(0,A.x)()).subscribe(t=>{this.filtroBusqueda=t,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(t=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(t){this._menuService.open(E,t._elementRef,{filter:this.filter}).afterClosed().subscribe({next:o=>{o&&(this.filter=o,this.extraParams=-1!=this.filter.activo?"filter[activo]="+this.filter.activo:"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(t){switch(t.name){case"editar":this.updatePedidosDePresupuesto(t);break;case"eliminar":case"cotizaciones":case"comparativa":case"enviar_pedido":this.deletePedidosDePresupuesto(t)}}savePedidosDePresupuesto(){this.dialogo.open(Z,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updatePedidosDePresupuesto(t){this.dialogo.open(Z,{data:t.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deletePedidosDePresupuesto(t){this.confirm.open({title:"Eliminar pedido de presupuesto "+t.params.data.observaciones,message:"\xbfDesea eliminar el pedido de presupuesto: "+t.params.data.observaciones+"?",dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(o=>{"confirmed"===o&&this._pedidoDePresupuestosService.deletePedidosDePresupuesto(t.params.data.idrubro).subscribe({next:r=>{this.alert.success("Pedido de presupuesto eliminado con \xe9xito."),o&&this.tabla.renderTabla()},error:r=>{console.error("Error en el servicio:",r),this.alert.error("Este pedido de presupuesto no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(m),e.Y36(O.R),e.Y36(b.T),e.Y36(p.uw),e.Y36(R.o),e.Y36(v.r),e.Y36(f.F0),e.Y36(I.k))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-pedidos-de-presupuesto"]],viewQuery:function(t,o){if(1&t&&e.Gf(F.C,5),2&t){let r;e.iGM(r=e.CRH())&&(o.tabla=r.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-8","mt-2"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Pedido de presupuesto",1,"mr-2","ml-2","bg-blue-500","p-2","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),e.NdJ("click",function(){return o.savePedidosDePresupuesto()}),e.TgZ(5,"mat-icon",5),e._uU(6,"add"),e.qZA()()()(),e.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),e.NdJ("functionEmitter",function(d){return o.generarAcciones(d)}),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("cache",!1)("columnsNames",o.headers)("renderType","client")("columnsParams",o.column_params)("endpoint",o.env)("functions",o.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",o.filtersLike)("extraParams",o.extraParams))},dependencies:[u.RK,c.Hw,D.gM,F.C]}),i})();var k=s(8995),L=s(1292),Q=s(2611),B=s(3873);const G=[{path:"",component:j}];let $=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[m,v.r,b.T],imports:[x.ez,f.Bz.forChild(G),C.p0,u.ot,h.LD,l.lN,n.UX,T.c,c.Ps,w.W,D.AV,k.Bb,y.g0,L.p9,Q.JX,B.f,p.Is,f.Bz]}),i})()}}]);