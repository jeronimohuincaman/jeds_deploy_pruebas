"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[651],{3651:(Ue,R,d)=>{d.r(R),d.d(R,{RemitosModule:()=>Se});var S=d(1531),f=d(4755),q=d(9383),u=d(3627),_=d(1728),y=d(787),g=d(9114),l=d(9401),N=d(9609),Y=d(5971),U=d(3686),T=d(430),F=d(6375),M=d(3649),e=d(2223),Q=d(8372),$=d(1884),p=d(5861),x=d(3905),I=d(8675),J=d(4004),b=d(5580),C=d(1217),k=d(3611),h=d(2340),Z=d(7579),E=d(3144),L=d(8951);let A=(()=>{class n{constructor(t,i){this.http=t,this._authService=i}saveRemito(t){return this.http.post(`${h.N.stock.remitos}`,t)}updateRemito(t,i){return this.http.put(`${h.N.stock.remitos}/`+i,t)}deleteRemito(t){return this.http.delete(`${h.N.stock.remitos}/`+t)}getDepositos(t){let i="?";i+=t?"":"filter[activo]=1";let o=new Z.x;return this.http.get(`${h.N.stock.depositos}${i}`).subscribe(r=>{o.next({list:r.result})}),o.asObservable()}getProveedores(t){let i="?sort=RazonSocial";i+=t?"":"filter[activo]=1";let o=new Z.x;return this.http.get(`${h.N.administracion.proveedores}${i}`).subscribe(r=>{o.next({list:r})}),o.asObservable()}getArticulosDepositos(t){let i=`?filter[deposito]=${t}`,o=new Z.x;return this.http.get(`${h.N.stock.view_stock_articulo_depositos}${i}`).subscribe(r=>{o.next({list:r.result})}),o.asObservable()}getUnidadesDeMedidaArticulos(t){let i=`?filter[idarticulo]=${t}`;i+="&expand=um";let o=new Z.x;return this.http.get(`${h.N.stock.articulo_unidad_medidas}${i}`).subscribe(r=>{o.next({list:r.result})}),o.asObservable()}getItems(t){let i=`?filter[idremito]=${t}`,o=new Z.x;return this.http.get(`${h.N.stock.view_stock_movimientos}${i}`).subscribe(r=>{o.next({list:r.result})}),o.asObservable()}getUsuarios(){let i=new Z.x;return this.http.get(`${h.N.login.view_usuarios}?sort=asc`).subscribe(o=>{i.next({list:o.result})}),i.asObservable()}getItemsOcPendiente(t){let i="?";i+=t?`filter[idordencompra]=${t}&`:"";let o=new Z.x;return this.http.get(`${h.N.stock.view_items_oc_pendientes}${i}`).subscribe(r=>{o.next({list:r.result})}),o.asObservable()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(E.eN),e.LFG(L.e))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var w=d(8995);function j(n,a){if(1&n&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.codigo_interno," - ",t.descripcion," ")}}function z(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("articulo"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function V(n,a){if(1&n&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t.idunidadmedida),e.xp6(1),e.Oqu(t.descripcion_um)}}let G=(()=>{class n{constructor(t,i,o,r,s,c){this.data=t,this._remitosService=i,this.datePipe=o,this.alert=r,this.dialogRef=s,this.dialogo=c,this.columns=["articulo","unidadmedida","cantidad","acciones"],this.articulos=[],this.unidades_de_medida=[],this.depositos=[],this.articulos_list=[],this.dataSource=new u.by,this.title="A\xf1adir movimiento de articulo"}ngOnInit(){this.newForm(),this.getArticulosOrdenCompra()}getArticulosOrdenCompra(){var t=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(t._remitosService.getItemsOcPendiente(t.data.orden_compra));t.articulos=i.list,new Promise(function(){var o=(0,p.Z)(function*(r){t.filteredArticulos=t.form.get("articulo").valueChanges.pipe((0,I.O)(""),(0,J.U)(s=>t._filterArticulos(s))),r(!0)});return function(r){return o.apply(this,arguments)}}()),t.articulos.forEach(o=>{t.articulos_list.find(s=>s.idarticulo===o.idarticulo)||t.articulos_list.push({idarticulo:o.idarticulo,codigo_interno:o.codigo_interno_articulo,descripcion:o.descripcion_articulo,idordencompraitem:o.iditemordencompra})})})()}_filterArticulos(t){const i=t.toString().toLowerCase();return this.articulos_list.filter(o=>{const r=o.codigo_interno.toString().toLowerCase().includes(i),s=o.descripcion.toString().toLowerCase().includes(i);return r||s})}getTextInput(t){return t?`${t.codigo_interno} - ${t.descripcion}`:""}getUnidadesDeMedidaArticulos(t){var i=this;new Promise(function(){var o=(0,p.Z)(function*(r){i.unidades_de_medida=i.articulos.filter(s=>s.idarticulo===t).map(s=>({idarticulo:s.idarticulo,idunidadmedida:s.idunidadmedida,descripcion_um:s.descripcion_um,cantidad_pendiente:s.cantidad_pendiente})),i.unidades_de_medida.forEach(s=>{let c=[];c.some(m=>m.idunidadmedida===s.idunidadmedida)||c.push(s),i.unidades_de_medida=c}),r(!0)});return function(r){return o.apply(this,arguments)}}())}seleccionArticulo(t){if(t.idarticulo&&(this.form.get("unidadmedida").enable(),this.getUnidadesDeMedidaArticulos(t.idarticulo)),t.um){let o,i=this.unidades_de_medida.find(c=>c.idarticulo===this.form.get("articulo").value.idarticulo&&c.idunidadmedida===this.form.get("unidadmedida").value),r=0;this.data.movimientos.length>0?(this.data.movimientos.filter(m=>m.idarticulo===i.idarticulo&&m.idunidadmedida===i.idunidadmedida).forEach(m=>{r+=Number(m.cantidad)}),o=""+(Number(i.cantidad_pendiente)-r)):o=i.cantidad_pendiente,this.form.get("cantidad_pendiente").setValue(o)}}limpiarCasillero(t){"articulo"==t&&(this.form.get("articulo").setValue(""),this.form.get("unidadmedida").disable(),this.form.get("unidadmedida").setValue(""),this.form.get("cantidad_pendiente").setValue(""))}newForm(){this.form=new l.cw({articulo:new l.NI("",l.kI.required),unidadmedida:new l.NI("",l.kI.required),cantidad:new l.NI("",l.kI.required),cantidad_pendiente:new l.NI("")})}onSubmit(){if(!this.form.valid)return alert("Revise Los Datos Ingresados");this.articulos.forEach(t=>{if(t.idarticulo===this.form.get("articulo").value.idarticulo&&t.idunidadmedida===this.form.get("unidadmedida").value){if(this.form.get("cantidad").value>t.cantidad_pendiente)return this.form.get("cantidad").setValue(""),alert("La cantidad ingresada excede la cantidad pendiente en la orden de compra.");if(this.data.movimientos.find(o=>o.idarticulo===this.form.get("articulo").value.idarticulo&&o.idunidadmedida===this.form.get("unidadmedida").value))return this.form.get("unidadmedida").setValue(""),alert("Ya existe un movimiento de ese articulo con esa unidad de medida.");if(this.form.get("cantidad").value<=t.cantidad_pendiente&&this.form.get("cantidad").value>0){let o=this.unidades_de_medida.find(s=>s.idunidadmedida===this.form.get("unidadmedida").value),r={articulo:this.form.get("articulo").value,unidad_medida:this.form.get("unidadmedida").value,cantidad:this.form.get("cantidad").value,unidadmedida_descripcion:o.descripcion_um,cantidad_pendiente:""+(Number(t.cantidad_pendiente)-this.form.get("cantidad").value)};this.onCloseMenu(r)}}})}onCloseMenu(t){this.dialogRef.close(t||!1)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.WI),e.Y36(A),e.Y36(f.uU),e.Y36(F.T),e.Y36(b.so),e.Y36(b.uw))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-add-articulo-remitos"]],features:[e._Bn([{provide:C.sG,useValue:k.x}])],decls:36,vars:9,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","articulo",3,"matAutocomplete","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","unidadmedida",3,"ngModelChange"],["matInput","","type","number","formControlName","cantidad_pendiente","readonly","true"],["matInput","","type","number","formControlName","cantidad"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return i.onCloseMenu()}),e.TgZ(6,"mat-icon",4),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"form",5)(9,"div")(10,"div",6)(11,"mat-form-field",7)(12,"mat-label"),e._uU(13,"Art\xedculo"),e.qZA(),e.TgZ(14,"input",8),e.NdJ("ngModelChange",function(r){return i.seleccionArticulo(r)}),e.qZA(),e.TgZ(15,"mat-autocomplete",9,10),e.YNc(17,j,2,3,"mat-option",11),e.ALo(18,"async"),e.qZA(),e.YNc(19,z,3,0,"button",12),e.qZA(),e.TgZ(20,"mat-form-field",7)(21,"mat-label"),e._uU(22,"UM"),e.qZA(),e.TgZ(23,"mat-select",13),e.NdJ("ngModelChange",function(r){return i.seleccionArticulo({um:r})}),e.YNc(24,V,2,2,"mat-option",11),e.qZA()(),e.TgZ(25,"mat-form-field",7)(26,"mat-label"),e._uU(27,"Cantidad Pendiente"),e.qZA(),e._UZ(28,"input",14),e.qZA(),e.TgZ(29,"mat-form-field",7)(30,"mat-label"),e._uU(31,"Cantidad"),e.qZA(),e._UZ(32,"input",15),e.qZA()()()(),e.TgZ(33,"div",16)(34,"button",17),e.NdJ("click",function(){return i.onSubmit()}),e._uU(35," A\xf1adir "),e.qZA()()()),2&t){const o=e.MAs(16);e.xp6(3),e.Oqu(i.title),e.xp6(5),e.Q6J("formGroup",i.form),e.xp6(6),e.Q6J("matAutocomplete",o),e.xp6(1),e.Q6J("displayWith",i.getTextInput),e.xp6(2),e.Q6J("ngForOf",e.lcZ(18,7,i.filteredArticulos)),e.xp6(2),e.Q6J("ngIf",i.form.get("articulo").value),e.xp6(5),e.Q6J("ngForOf",i.unidades_de_medida)}},dependencies:[f.sg,f.O5,_.lW,_.RK,g.KE,g.hX,g.R9,y.gD,C.ey,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.sg,l.u,N.Nt,T.Hw,w.XC,w.ZL,f.Ov]}),n})();var v=d(8280);function H(n,a){if(1&n&&(e.TgZ(0,"mat-option",38),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.RazonSocial," ")}}function B(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("proveedor"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function K(n,a){if(1&n&&(e.TgZ(0,"mat-option",38),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t.idordencompra),e.xp6(1),e.AsE(" N\xb0 ",t.numero_oc," / ",t.fecha_oc," ")}}function W(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("oc_pendiente"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function X(n,a){if(1&n&&(e.TgZ(0,"mat-option",38),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.descripcion," ")}}function ee(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("deposito"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function te(n,a){1&n&&(e.TgZ(0,"th",40),e._uU(1," Articulo"),e.qZA())}function ie(n,a){if(1&n&&(e.TgZ(0,"td",41),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.xp6(1),e.hij(" ",t.descripcion_articulo," ")}}function oe(n,a){1&n&&(e.TgZ(0,"th",40),e._uU(1," Codigo Interno"),e.qZA())}function ne(n,a){if(1&n&&(e.TgZ(0,"td",41),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.xp6(1),e.hij(" ",t.codigo_interno," ")}}function re(n,a){1&n&&(e.TgZ(0,"th",40),e._uU(1,"Unidad de medida"),e.qZA())}function ae(n,a){if(1&n&&(e.TgZ(0,"td",41),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.xp6(1),e.hij(" ",t.descripcion_um," ")}}function se(n,a){1&n&&(e.TgZ(0,"th",40),e._uU(1,"Cantidad"),e.qZA())}function le(n,a){if(1&n&&(e.TgZ(0,"td",41),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.xp6(1),e.hij(" ",t.cantidad," ")}}function de(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"th",40)(1,"button",42),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addMovimiento())}),e.TgZ(2,"mat-icon"),e._uU(3,"add"),e.qZA()()()}}function ce(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"td",41)(1,"button",3,43),e.NdJ("click",function(){const r=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.deleteMovimiento(r))}),e.TgZ(3,"mat-icon",44),e._uU(4,"delete"),e.qZA()()()}}function me(n,a){1&n&&e._UZ(0,"tr",45)}function ue(n,a){1&n&&e._UZ(0,"tr",46)}const pe=function(n){return{"reached-max":n}};let P=(()=>{class n{constructor(t,i,o,r,s,c){this.data=t,this._remitosService=i,this.datePipe=o,this.alert=r,this.dialogRef=s,this.dialogo=c,this.columns=["articulo","codigointerno","unidadmedida","cantidad","acciones"],this.proveedores=[],this.depositos=[],this.orden_compras=[],this.oc_pendientes=[],this.mov_art_list=[],this.mov_art_list_deleted=[],this.maxPalabras=50,this.dataSource=new u.by,this.remito=this.data?this.data:null,this.title=this.remito?.idremito?`Editar Remito ${this.remito.fecha} - ${this.remito.hora}`:"Nuevo Remito",this.user=JSON.parse(localStorage.getItem("user")),this.minDate=null,this.maxDate=new Date}ngOnInit(){this.getItemsOrdenDeCompraPendiente().then(()=>{this.getProveedores()}),this.newForm(),this.exist()}newForm(){const[t,i,o]=this.remito?this.remito.fecha.split("/"):"";this.remito&&this.getItems(this.remito.idremito).then(r=>{this.mov_art_list=r.map(s=>({idarticulo:s.idarticulo,cantidad:s.cantidad,idunidadmedida:s.idunidadmedida,descripcion_articulo:s.descripcion_articulo,descripcion_um:s.descripcion_um,codigo_interno:s.codigo_interno_articulo})),this.dataSource=new u.by(this.mov_art_list),0!=this.mov_art_list.length?(this.form.get("oc_pendiente").disable(),this.form.get("deposito").disable()):(this.form.get("oc_pendiente").enable(),this.form.get("deposito").enable())}),this.form=new l.cw({fecha:new l.NI(this.datePipe.transform(this.remito?.fecha?new Date(`${i}/${t}/${o}`):new Date,"yyyy-MM-dd"),[l.kI.required]),hora:new l.NI(this.remito?.hora?this.remito.hora:this.datePipe.transform(new Date,"HH:mm"),[l.kI.required]),proveedor:new l.NI(this.remito?this.remito.descripcion_proveedor:"",[l.kI.required]),oc_pendiente:new l.NI(this.remito?this.remito.idordencompra:"",[l.kI.required]),deposito:new l.NI(this.remito?this.remito.descripcion_deposito:"",l.kI.required),observaciones:new l.NI(this.remito?this.remito.observaciones:"",[l.kI.maxLength(this.maxPalabras)])})}getPalabrasLength(){const t=this.form.get("observaciones").value;return t?t.length:0}isPalabraMaxLengthReached(){return this.getPalabrasLength()<=this.maxPalabras}exist(){this.remito?.idremito?this.getDepositos(!0):this.getDepositos()}getDepositos(t){var i=this;return(0,p.Z)(function*(){const o=yield(0,x.z)(i._remitosService.getDepositos(t));new Promise(function(){var r=(0,p.Z)(function*(s){i.depositos=o.list,i.filteredDepositos=i.form.get("deposito").valueChanges.pipe((0,I.O)(""),(0,J.U)(c=>i._filterDepositos(c))),s(!0)});return function(s){return r.apply(this,arguments)}}())})()}_filterDepositos(t){const i=t.toString().toLowerCase();return this.depositos.filter(o=>o.descripcion.toLowerCase().includes(i))}_filterProveedores(t){const i=t.toString().toLowerCase();return this.proveedores.filter(o=>o.RazonSocial.toLowerCase().includes(i))}getItemsOrdenDeCompraPendiente(t){var i=this;return(0,p.Z)(function*(){const o=yield(0,x.z)(i._remitosService.getItemsOcPendiente(t));i.orden_compras=o.list,new Promise(function(){var r=(0,p.Z)(function*(s){i.proveedores=o.list.map(c=>({Codigo:c.idproveedor,RazonSocial:c.razon_social})),i.oc_pendientes=o.list.map(c=>({idordencompra:c.idordencompra,fecha_oc:c.fecha_oc,numero_oc:c.numero_oc,idproveedor:c.idproveedor})),i.filteredProveedores=i.form.get("proveedor").valueChanges.pipe((0,I.O)(""),(0,J.U)(c=>i._filterProveedores(c)))});return function(s){return r.apply(this,arguments)}}())})()}getProveedores(){var t=this;return(0,p.Z)(function*(){new Promise(function(){var i=(0,p.Z)(function*(o){let r=[];t.proveedores.forEach(s=>{r.some(c=>c.Codigo===s.Codigo)||r.push(s),t.proveedores=r}),o(!0)});return function(o){return i.apply(this,arguments)}}())})()}getOrdenCompras(t){var i=this;return(0,p.Z)(function*(){i.oc_pendientes=i.orden_compras.filter(r=>r.idproveedor===t);let o=[];i.oc_pendientes.forEach(r=>{o.some(s=>s.idordencompra===r.idordencompra)||o.push(r),i.oc_pendientes=o})})()}getTextInput(t){return t.descripcion?t.descripcion:t.deposito?t.deposito:t.RazonSocial?t.RazonSocial:t}seleccionItem(t){if(t.Codigo&&(this.getOrdenCompras(t.Codigo),this.form.get("proveedor").setValue(t),this.form.get("oc_pendiente").enable()),t.oc){let i=this.oc_pendientes.find(o=>o.idordencompra===t.oc);this.form.get("oc_pendiente").setValue(i.idordencompra)}}getItems(t){var i=this;return(0,p.Z)(function*(){return new Promise(function(){var o=(0,p.Z)(function*(r){const s=yield(0,x.z)(i._remitosService.getItems(t));i.mov_art_list=s.list,r(i.mov_art_list)});return function(r){return o.apply(this,arguments)}}())})()}addMovimiento(){if(""!=this.form.get("oc_pendiente").value){let t=this.form.get("oc_pendiente").value;this.dialogo.open(G,{panelClass:"ayuda-dialog",data:{orden_compra:t,movimientos:this.mov_art_list,movimientos_eliminados:this.mov_art_list_deleted,esEdicion:!!this.remito}}).afterClosed().subscribe({next:o=>{o&&(this.mov_art_list=[...this.mov_art_list,{idarticulo:o.articulo.idarticulo,cantidad:o.cantidad,cantidad_pendiente:o.cantidad_pendiente,idunidadmedida:o.unidad_medida,idordencompraitem:o.articulo.idordencompraitem,descripcion_articulo:o.articulo.descripcion,descripcion_um:o.unidadmedida_descripcion,codigo_interno:o.articulo.codigo_interno}],this.dataSource=new u.by(this.mov_art_list),0!=this.mov_art_list.length&&(this.form.get("oc_pendiente").disable(),this.form.get("deposito").disable()))}})}else alert("Seleccione una orden de compra")}deleteMovimiento(t){this.mov_art_list.forEach(i=>{i.idarticulo===t.idarticulo&&i.idunidadmedida===t.idunidadmedida&&(i.cantidad_pendiente=Number(i.cantidad_pendiente)+Number(i.cantidad))}),this.mov_art_list_deleted=this.mov_art_list,this.mov_art_list=this.mov_art_list.filter(i=>i!==t),this.dataSource=new u.by(this.mov_art_list),0===this.mov_art_list.length&&(this.form.get("oc_pendiente").enable(),this.form.get("deposito").enable())}limpiarCasillero(t){this.form.get(t).setValue(""),"proveedor"==t&&(this.form.get("oc_pendiente").setValue(""),this.oc_pendientes=this.orden_compras)}onSubmit(){if(!this.isPalabraMaxLengthReached())return alert(`La longitud m\xe1xima de observaciones es de ${this.maxPalabras} caracteres.`);if(!this.form.valid)return alert("Revise Los Datos Ingresados");{if(!this.remito||this.remito&&this.form.get("proveedor").value!==this.remito.descripcion_proveedor){const m=this.form.get("proveedor").value;if(!this.proveedores.find(Ne=>Ne.Codigo===m.Codigo))return alert("El proveedor seleccionado no existe. Por favor, seleccione un proveedor v\xe1lido.")}let t=this.mov_art_list.map(m=>({idordencompraitem:m.idordencompraitem,idarticulo:m.idarticulo,cantidad:m.cantidad,idunidadmedida:m.idunidadmedida}));if(0===t.length)return alert("Debe ingresar un articulo al remito");const i=this.form.get("fecha").value,o=this.form.get("hora").value,s=`${this.datePipe.transform(i,"yyyy-MM-dd")} ${o}`,c={remito:{idusuario:this.user.id,fecha_hora:s,iddeposito:this.form.get("deposito").value.iddeposito,idordencompra:this.form.get("oc_pendiente").value,observaciones:this.form.get("observaciones").value},movimientos:t};this.remito?.idremito?this._remitosService.updateRemito(c,this.remito.idremito).subscribe({next:m=>{m&&this.dialogRef.close(m)}}):this._remitosService.saveRemito(c).subscribe({next:m=>{m&&this.dialogRef.close(m)}})}}onCloseMenu(){this.dialogRef.close(!1)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.WI),e.Y36(A),e.Y36(f.uU),e.Y36(F.T),e.Y36(b.so),e.Y36(b.uw))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-save-remitos"]],features:[e._Bn([{provide:C.sG,useValue:k.x}])],decls:73,vars:29,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"shadow-md","mb-3"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/8"],["matInput","","placeholder","Fecha","formControlName","fecha",3,"matDatepicker","min","max"],["matSuffix","",3,"for"],["picker",""],["matInput","","formControlName","hora","type","time"],["appearance","outline",1,"w-1/3"],["type","text","matInput","","formControlName","proveedor",3,"matAutocomplete","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","oc_pendiente",3,"ngModelChange"],["type","text","matInput","","formControlName","deposito",3,"matAutocomplete"],["art","matAutocomplete"],["appearance","outline",1,"w-full"],["matInput","","formControlName","observaciones",1,"resize-none"],[1,"counter",3,"ngClass"],[1,"overflow-y-auto","max-h-[150px]","h-[150px]","shadow-xl","pb-10","border-t-2","border-slate-200"],["mat-table","",1,"w-full","mt-1",3,"dataSource"],["matColumnDef","articulo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","codigointerno"],["matColumnDef","unidadmedida"],["matColumnDef","cantidad"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-mini-fab","","color","primary","matTooltip","A\xf1adir Articulo","aria-label","icon",1,"rounded-full",3,"click"],["delete",""],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return i.onCloseMenu()}),e.TgZ(6,"mat-icon",4),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"form",5)(9,"div",6)(10,"div",7)(11,"mat-form-field",8),e._UZ(12,"input",9)(13,"mat-datepicker-toggle",10)(14,"mat-datepicker",null,11),e.qZA(),e.TgZ(16,"mat-form-field",8)(17,"mat-label"),e._uU(18,"Hora"),e.qZA(),e._UZ(19,"input",12),e.qZA(),e.TgZ(20,"mat-form-field",13)(21,"mat-label"),e._uU(22,"Proveedor"),e.qZA(),e.TgZ(23,"input",14),e.NdJ("ngModelChange",function(r){return i.seleccionItem(r)}),e.qZA(),e.TgZ(24,"mat-autocomplete",15,16),e.YNc(26,H,2,2,"mat-option",17),e.ALo(27,"async"),e.qZA(),e.YNc(28,B,3,0,"button",18),e.qZA(),e.TgZ(29,"mat-form-field",13)(30,"mat-label"),e._uU(31,"OC"),e.qZA(),e.TgZ(32,"mat-select",19),e.NdJ("ngModelChange",function(r){return i.seleccionItem({oc:r})}),e.YNc(33,K,2,3,"mat-option",17),e.qZA(),e.YNc(34,W,3,0,"button",18),e.qZA(),e.TgZ(35,"mat-form-field",13)(36,"mat-label"),e._uU(37,"Dep\xf3sito"),e.qZA(),e._UZ(38,"input",20),e.TgZ(39,"mat-autocomplete",15,21),e.YNc(41,X,2,2,"mat-option",17),e.ALo(42,"async"),e.qZA(),e.YNc(43,ee,3,0,"button",18),e.qZA()(),e.TgZ(44,"div")(45,"mat-form-field",22)(46,"mat-label"),e._uU(47,"Observaciones"),e.qZA(),e._UZ(48,"textarea",23),e.TgZ(49,"div",24),e._uU(50),e.qZA()()()(),e.TgZ(51,"div",25)(52,"table",26),e.ynx(53,27),e.YNc(54,te,2,0,"th",28),e.YNc(55,ie,2,1,"td",29),e.BQk(),e.ynx(56,30),e.YNc(57,oe,2,0,"th",28),e.YNc(58,ne,2,1,"td",29),e.BQk(),e.ynx(59,31),e.YNc(60,re,2,0,"th",28),e.YNc(61,ae,2,1,"td",29),e.BQk(),e.ynx(62,32),e.YNc(63,se,2,0,"th",28),e.YNc(64,le,2,1,"td",29),e.BQk(),e.ynx(65,33),e.YNc(66,de,4,0,"th",28),e.YNc(67,ce,5,0,"td",29),e.BQk(),e.YNc(68,me,1,0,"tr",34),e.YNc(69,ue,1,0,"tr",35),e.qZA()()(),e.TgZ(70,"div",36)(71,"button",37),e.NdJ("click",function(){return i.onSubmit()}),e._uU(72," Guardar "),e.qZA()()()),2&t){const o=e.MAs(15),r=e.MAs(25),s=e.MAs(40);e.xp6(3),e.Oqu(i.title),e.xp6(5),e.Q6J("formGroup",i.form),e.xp6(4),e.Q6J("matDatepicker",o)("min",i.minDate)("max",i.maxDate),e.xp6(1),e.Q6J("for",o),e.xp6(10),e.Q6J("matAutocomplete",r),e.xp6(1),e.Q6J("displayWith",i.getTextInput),e.xp6(2),e.Q6J("ngForOf",e.lcZ(27,23,i.filteredProveedores)),e.xp6(2),e.Q6J("ngIf",i.form.get("proveedor").value),e.xp6(5),e.Q6J("ngForOf",i.oc_pendientes),e.xp6(1),e.Q6J("ngIf",i.form.get("oc_pendiente").value&&0==i.mov_art_list.length),e.xp6(4),e.Q6J("matAutocomplete",s),e.xp6(1),e.Q6J("displayWith",i.getTextInput),e.xp6(2),e.Q6J("ngForOf",e.lcZ(42,25,i.filteredDepositos)),e.xp6(2),e.Q6J("ngIf",i.form.get("deposito").value&&0==i.mov_art_list.length),e.xp6(6),e.Q6J("ngClass",e.VKq(27,pe,!i.isPalabraMaxLengthReached())),e.xp6(1),e.AsE(" ",i.getPalabrasLength(),"/",i.maxPalabras," "),e.xp6(2),e.Q6J("dataSource",i.dataSource),e.xp6(16),e.Q6J("matHeaderRowDef",i.columns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",i.columns)}},dependencies:[f.mk,f.sg,f.O5,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,_.lW,_.RK,_.nh,g.KE,g.hX,g.R9,y.gD,C.ey,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,N.Nt,T.Hw,M.gM,w.XC,w.ZL,v.Mq,v.hl,v.nW,f.Ov],styles:['@charset "UTF-8";.counter[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;right:.5rem;font-size:.75rem;color:#c9c9c9}.counter.reached-max[_ngcontent-%COMP%]{color:#e53e3e}']}),n})();var D=d(2018),fe=d(8288);function he(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarFechas())}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function _e(n,a){if(1&n&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t.codigo),e.xp6(1),e.hij("",t.nick," ")}}function ge(n,a){if(1&n&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t.Codigo),e.xp6(1),e.hij(" ",t.RazonSocial," ")}}function ve(n,a){if(1&n&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.Q6J("value",t.iddeposito),e.xp6(1),e.Oqu(t.descripcion)}}let be=(()=>{class n{constructor(t,i,o,r){this.data=t,this._menuService=i,this.datePipe=o,this._remitosService=r,this.filterUsuarios=[],this.filterProveedor=[],this.filterDeposito=[],this.filterFechas=[],this.movimientos_internos_list=[]}ngOnInit(){this.formFilters=new l.cw({filtroFechaInicio:new l.NI(""),filtroFechaFin:new l.NI(""),usuario_responsable:new l.NI(-1),proveedor:new l.NI(-1),deposito:new l.NI(-1)}),this.getDepositos(),this.getUsuarios(),this.getProveedores(),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({filtroFechaInicio:"",filtroFechaFin:"",usuario_responsable:-1,proveedor:-1,deposito:-1})}onCloseMenu(t=null){t&&(t.filtroFechaInicio=this.datePipe.transform(this.formFilters.get("filtroFechaInicio").value,"yyyy-MM-dd"),t.filtroFechaFin=this.datePipe.transform(this.formFilters.get("filtroFechaFin").value,"yyyy-MM-dd")),this._menuService.close(t)}limpiarFechas(){this.formFilters.get("filtroFechaInicio").setValue(""),this.formFilters.get("filtroFechaFin").setValue("")}getUsuarios(){var t=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(t._remitosService.getUsuarios());t.filterUsuarios=i.list})()}getProveedores(){var t=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(t._remitosService.getProveedores());t.filterProveedor=i.list})()}getDepositos(){var t=this;return(0,p.Z)(function*(){const i=yield(0,x.z)(t._remitosService.getDepositos(!0));t.filterDeposito=i.list})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36("MENU_DATA"),e.Y36(U.r),e.Y36(f.uU),e.Y36(A))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-filter-menu-remitos"]],features:[e._Bn([{provide:C.sG,useValue:k.x}])],decls:50,vars:11,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base","mt-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],[3,"rangePicker"],["matStartDate","","placeholder","Desde","formControlName","filtroFechaInicio"],["matEndDate","","placeholder","Hasta","formControlName","filtroFechaFin"],["matIconSuffix","",3,"for"],["picker",""],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","usuario_responsable"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","proveedor"],["formControlName","deposito"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"Filtros"),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return i.resetFilters()}),e.TgZ(6,"mat-icon",4),e._uU(7,"refresh"),e.qZA()(),e.TgZ(8,"button",5),e.NdJ("click",function(){return i.onCloseMenu()}),e.TgZ(9,"mat-icon",4),e._uU(10,"close"),e.qZA()()()(),e.TgZ(11,"form",6)(12,"span",7),e._uU(13,"Rango de fechas"),e.qZA(),e.TgZ(14,"mat-form-field",8)(15,"mat-date-range-input",9),e._UZ(16,"input",10)(17,"input",11),e.qZA(),e._UZ(18,"mat-datepicker-toggle",12)(19,"mat-date-range-picker",null,13),e.YNc(21,he,3,0,"button",14),e.qZA(),e.TgZ(22,"span",7),e._uU(23,"Usuario Responsable"),e.qZA(),e.TgZ(24,"mat-form-field",8)(25,"mat-select",15)(26,"mat-option",16),e._uU(27,"Todos"),e.qZA(),e.YNc(28,_e,2,2,"mat-option",17),e.qZA()(),e.TgZ(29,"span",7),e._uU(30,"Proveedor"),e.qZA(),e.TgZ(31,"mat-form-field",8)(32,"mat-select",18)(33,"mat-option",16),e._uU(34,"Todos"),e.qZA(),e.YNc(35,ge,2,2,"mat-option",17),e.qZA()(),e.TgZ(36,"span",7),e._uU(37,"Deposito"),e.qZA(),e.TgZ(38,"mat-form-field",8)(39,"mat-select",19)(40,"mat-option",16),e._uU(41,"Todos"),e.qZA(),e.YNc(42,ve,2,2,"mat-option",17),e.qZA()()(),e.TgZ(43,"div",20)(44,"button",21),e.NdJ("click",function(){return i.resetFilters()}),e.TgZ(45,"span",22),e._uU(46,"Limpiar"),e.qZA()(),e.TgZ(47,"button",23),e.NdJ("click",function(){return i.onCloseMenu(i.formFilters.getRawValue())}),e.TgZ(48,"span",24),e._uU(49,"Filtrar"),e.qZA()()()()),2&t){const o=e.MAs(20);e.Q6J("@expandCollapse","expanded"),e.xp6(11),e.Q6J("formGroup",i.formFilters),e.xp6(4),e.Q6J("rangePicker",o),e.xp6(3),e.Q6J("for",o),e.xp6(3),e.Q6J("ngIf",i.formFilters.get("filtroFechaInicio").value||i.formFilters.get("filtroFechaFin").value),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",i.filterUsuarios),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",i.filterProveedor),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",i.filterDeposito)}},dependencies:[f.sg,f.O5,_.lW,_.RK,g.KE,g.R9,y.gD,C.ey,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,T.Hw,v.nW,v.wx,v.zY,v.By,v._g],data:{animation:fe.L}}),n})();var xe=d(1683),Ze=d(7374),Ce=d(8978);let Te=(()=>{class n{constructor(t,i,o,r,s,c,m,O){this._remitoService=t,this.confirm=i,this.alert=o,this.dialogo=r,this._searchService=s,this._menuService=c,this.router=m,this._headerTextService=O,this.dataSource=new u.by,this.headers=["Fecha","Hora","Responsable","Deposito","Proveedor","Orden compra","Acciones"],this.column_params=["fecha","hora","nick_usuario","descripcion_deposito","descripcion_proveedor","nro_orden_compra","acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["nick_usuario","descripcion_deposito","descripcion_proveedor"],this.filter={proveedor:-1,deposito:-1,filtroFechaInicio:"",filtroFechaFin:""},this.extraParams="",this.parametrosActualizados=new e.vpe,this.env=h.N.stock.remitos+"?sort=-idremito",this.search=new l.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,Q.b)(750),(0,$.x)()).subscribe(t=>{this.filtroBusqueda=t,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(t=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(t){this._menuService.open(be,t._elementRef,{filter:this.filter,data:this.tabla.getElementosExistentes()}).afterClosed().subscribe({next:i=>{i&&(this.filter=i,this.extraParams=-1!=this.filter.deposito?"filter[iddeposito]="+this.filter.deposito+"&":"",this.extraParams+=-1!=this.filter.usuario_responsable?"filter[idusuario]="+this.filter.usuario_responsable+"&":"",this.extraParams+=-1!=this.filter.proveedor?"filter[idproveedor]="+this.filter.proveedor+"&":"",this.extraParams+=null!=this.filter.filtroFechaInicio?"filter[fecha][gte]="+this.filter.filtroFechaInicio+"&":"",this.extraParams+=null!=this.filter.filtroFechaFin?"filter[fecha][lte]="+this.filter.filtroFechaFin+"&":"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(t){switch(t.name){case"editar":this.updateRemito(t);break;case"eliminar":this.deleteRemito(t)}}saveRemito(){this.dialogo.open(P,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updateRemito(t){this.dialogo.open(P,{data:t.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteRemito(t){this.confirm.open({title:"Eliminar Remito: "+t.params.data.fecha,message:`\xbfDesea eliminar el remito realizado el: ${t.params.data.fecha} ${t.params.data.hora}; del dep\xf3sito: ${t.params.data.descripcion_deposito} ?`,dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._remitoService.deleteRemito(t.params.data.idremito).subscribe({next:o=>{alert("Remito eliminado con \xe9xito."),o&&this.tabla.renderTabla()},error:o=>{console.error("Error en el servicio:",o),alert("Este remito no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(A),e.Y36(xe.R),e.Y36(F.T),e.Y36(b.uw),e.Y36(Ze.o),e.Y36(U.r),e.Y36(S.F0),e.Y36(Ce.k))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-remitos"]],viewQuery:function(t,i){if(1&t&&e.Gf(D.C,5),2&t){let o;e.iGM(o=e.CRH())&&(i.tabla=o.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-4","mt-2","pb-4"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Remito",1,"mr-2","ml-2","bg-blue-500","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2","mt-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),e.NdJ("click",function(){return i.saveRemito()}),e.TgZ(5,"mat-icon",5),e._uU(6,"add"),e.qZA()()()(),e.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),e.NdJ("functionEmitter",function(r){return i.generarAcciones(r)}),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("cache",!1)("columnsNames",i.headers)("renderType","ssp")("columnsParams",i.column_params)("endpoint",i.env)("functions",i.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",i.filtersLike)("extraParams",i.extraParams))},dependencies:[_.RK,T.Hw,M.gM,D.C]}),n})();var Ae=d(1292),we=d(2611),ye=d(3873);const Fe=[{path:"",component:Te}];let Se=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[A,U.r,F.T,f.uU],imports:[f.ez,S.Bz.forChild(Fe),u.p0,_.ot,y.LD,g.lN,l.UX,N.c,T.Ps,Y.W,M.AV,w.Bb,q.g0,Ae.p9,we.JX,ye.f,b.Is,v.FA,S.Bz]}),n})()}}]);