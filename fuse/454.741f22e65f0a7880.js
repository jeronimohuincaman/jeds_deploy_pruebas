"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[454],{3454:(Ue,I,s)=>{s.r(I),s.d(I,{OrdenesDeCompraModule:()=>Se});var y=s(1531),u=s(4755),Q=s(9383),d=s(3627),f=s(1728),N=s(787),h=s(9114),a=s(9401),S=s(9609),R=s(5971),D=s(3686),x=s(430),w=s(6375),U=s(3649),e=s(2223),M=s(8372),k=s(1884),g=s(5861),Z=s(3905),O=s(8675),P=s(4004),b=s(5580),C=s(1217),J=s(3611),$=s(3900),_=s(2340),F=s(7579),E=s(3144),G=s(8951);let A=(()=>{class i{constructor(t,o){this.http=t,this._authService=o}getOrdenesDeCompra(t){let o="?";o+="desc"==t?"sort=-descripcion":"sort=descripcion";let r=new F.x;return this.http.get(`${_.N.administracion.view_clientes}${o}`).subscribe(l=>{this._authService.accessToken=l.token,r.next({list:l.result})}),r.asObservable()}saveOrdenDeCompra(t){return this.http.post(`${_.N.compras.orden_compra}`,t)}updateOrdenDeCompra(t,o){return this.http.put(`${_.N.compras.orden_compra}/`+o,t)}deleteOrdenDeCompra(t){return this.http.delete(`${_.N.compras.orden_compra}/`+t)}getProveedores(t){let o="?sort=RazonSocial";o+=t?"":"filter[activo]=1";let r=new F.x;return this.http.get(`${_.N.administracion.proveedores}${o}`).subscribe(l=>{r.next({list:l})}),r.asObservable()}getArticulos(t){let o="?filter[activo]=1&pagination=1&per-page=10&page=1";return o+=t?`&filter[or][0][codigo_interno][like]=${t}&filter[or][1][descripcion][like]=${t}`:"",this.http.get(`${_.N.stock.articulos}${o}`).pipe((0,P.U)(r=>r))}getUnidadesDeMedidaArticulos(t){let o=`?filter[idarticulo]=${t}`;o+="&expand=um";let r=new F.x;return this.http.get(`${_.N.stock.articulo_unidad_medidas}${o}`).subscribe(l=>{r.next({list:l.result})}),r.asObservable()}getItems(t){let o=`?filter[ordenCompra]=${t}`,r=new F.x;return this.http.get(`${_.N.compras.orden_compra_items}${o}`).subscribe(l=>{r.next({list:l.result})}),r.asObservable()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(E.eN),e.LFG(G.e))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var T=s(8995);function L(i,n){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.codigo_interno," - ",t.descripcion," ")}}function j(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("articulo"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function z(i,n){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t.idunidadmedida),e.xp6(1),e.Oqu(t.um.descripcion)}}function B(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("cantidad"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function H(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("importe"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}let K=(()=>{class i{constructor(t,o,r,l,c,p){this.data=t,this._ordenesDeComnpraService=o,this.datePipe=r,this.alert=l,this.dialogRef=c,this.dialogo=p,this.columns=["articulo","codigointerno","unidadmedida","cantidad","acciones"],this.unidades_de_medida=[],this.dataSource=new d.by,this.title="A\xf1adir articulo"}ngOnInit(){this.newForm(),this.getArticulos()}newForm(){this.form=new a.cw({articulo:new a.NI("",a.kI.required),unidadmedida:new a.NI("",a.kI.required),cantidad:new a.NI("",a.kI.required),importe:new a.NI("",a.kI.required)}),this.form.get("articulo").valueChanges.pipe((0,O.O)(""),(0,M.b)(750),(0,k.x)(),(0,$.w)(t=>this._ordenesDeComnpraService.getArticulos(t))).subscribe(t=>{this.filteredArticulos=t?.result})}getArticulos(){var t=this;return(0,g.Z)(function*(){const o=yield(0,Z.z)(t._ordenesDeComnpraService.getArticulos());new Promise(function(){var r=(0,g.Z)(function*(l){t.articulos=o.list,l(!0)});return function(l){return r.apply(this,arguments)}}())})()}getTextArticulo(t){return t?t.descripcion:""}getUnidadesDeMedidaArticulos(t){var o=this;return(0,g.Z)(function*(){const r=yield(0,Z.z)(o._ordenesDeComnpraService.getUnidadesDeMedidaArticulos(t));new Promise(function(){var l=(0,g.Z)(function*(c){o.unidades_de_medida=r.list,c(!0)});return function(c){return l.apply(this,arguments)}}())})()}seleccionArticulo(t){t.idarticulo&&this.getUnidadesDeMedidaArticulos(t.idarticulo)}limpiarCasillero(t){this.form.get(t).setValue("")}onSubmit(){if(!this.form.valid)return alert("Revise Los Datos Ingresados");{let t=this.unidades_de_medida.find(r=>r.idunidadmedida===this.form.get("unidadmedida").value),o={articulo:this.form.get("articulo").value,unidad_medida:this.form.get("unidadmedida").value,cantidad:this.form.get("cantidad").value,importe:this.form.get("importe").value,unidadmedida_descripcion:t.um.descripcion};this.onCloseMenu(o)}}onCloseMenu(t){this.dialogRef.close(t||!1)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b.WI),e.Y36(A),e.Y36(u.uU),e.Y36(w.T),e.Y36(b.so),e.Y36(b.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-add-articulo-movimientos-internos"]],features:[e._Bn([{provide:C.sG,useValue:J.x}])],decls:37,vars:9,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","articulo",3,"matAutocomplete","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","unidadmedida"],["appearance","outline",1,"w-1/3"],["matInput","","type","number","formControlName","cantidad"],["matInput","","type","number","formControlName","importe"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return o.onCloseMenu()}),e.TgZ(6,"mat-icon",4),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"form",5)(9,"div")(10,"div",6)(11,"mat-form-field",7)(12,"mat-label"),e._uU(13,"Art\xedculo"),e.qZA(),e.TgZ(14,"input",8),e.NdJ("ngModelChange",function(l){return o.seleccionArticulo(l)}),e.qZA(),e.TgZ(15,"mat-autocomplete",9,10),e.YNc(17,L,2,3,"mat-option",11),e.qZA(),e.YNc(18,j,3,0,"button",12),e.qZA(),e.TgZ(19,"mat-form-field",7)(20,"mat-label"),e._uU(21,"UM"),e.qZA(),e.TgZ(22,"mat-select",13),e.YNc(23,z,2,2,"mat-option",11),e.qZA()(),e.TgZ(24,"mat-form-field",14)(25,"mat-label"),e._uU(26,"Cantidad"),e.qZA(),e._UZ(27,"input",15),e.YNc(28,B,3,0,"button",12),e.qZA(),e.TgZ(29,"mat-form-field",14)(30,"mat-label"),e._uU(31,"Importe"),e.qZA(),e._UZ(32,"input",16),e.YNc(33,H,3,0,"button",12),e.qZA()()()(),e.TgZ(34,"div",17)(35,"button",18),e.NdJ("click",function(){return o.onSubmit()}),e._uU(36," A\xf1adir "),e.qZA()()()),2&t){const r=e.MAs(16);e.xp6(3),e.Oqu(o.title),e.xp6(5),e.Q6J("formGroup",o.form),e.xp6(6),e.Q6J("matAutocomplete",r),e.xp6(1),e.Q6J("displayWith",o.getTextArticulo),e.xp6(2),e.Q6J("ngForOf",o.filteredArticulos),e.xp6(1),e.Q6J("ngIf",o.form.get("articulo").value),e.xp6(5),e.Q6J("ngForOf",o.unidades_de_medida),e.xp6(5),e.Q6J("ngIf",o.form.get("cantidad").value),e.xp6(5),e.Q6J("ngIf",o.form.get("importe").value)}},dependencies:[u.sg,u.O5,f.lW,f.RK,h.KE,h.hX,h.R9,N.gD,C.ey,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,S.Nt,x.Hw,T.XC,T.ZL]}),i})();var v=s(8280);function V(i,n){if(1&i&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.RazonSocial," ")}}function W(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("proveedor"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function X(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("iva"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function ee(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("presupuesto"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function te(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarCasillero("numero"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function oe(i,n){1&i&&(e.TgZ(0,"th",42),e._uU(1," Articulo"),e.qZA())}function ie(i,n){if(1&i&&(e.TgZ(0,"td",43),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.hij(" ",t.descripcion_articulo," ")}}function re(i,n){1&i&&(e.TgZ(0,"th",42),e._uU(1,"C\xf3digo interno"),e.qZA())}function ne(i,n){if(1&i&&(e.TgZ(0,"td",43),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.hij(" ",t.codigo_interno_articulo," ")}}function ae(i,n){1&i&&(e.TgZ(0,"th",42),e._uU(1,"Unidad de medida"),e.qZA())}function se(i,n){if(1&i&&(e.TgZ(0,"td",43),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.hij(" ",t.descripcion_um," ")}}function le(i,n){1&i&&(e.TgZ(0,"th",42),e._uU(1,"Cantidad"),e.qZA())}function ce(i,n){if(1&i&&(e.TgZ(0,"td",43),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.hij(" ",t.cantidad," ")}}function de(i,n){1&i&&(e.TgZ(0,"th",42),e._uU(1,"Importe"),e.qZA())}function me(i,n){if(1&i&&(e.TgZ(0,"td",43),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.hij(" ",t.importe," ")}}function ue(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"th",42)(1,"button",44),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.addArticulo())}),e.TgZ(2,"mat-icon"),e._uU(3,"add"),e.qZA()()()}}function pe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",43)(1,"button",3,45),e.NdJ("click",function(){const l=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.deleteArticulo(l))}),e.TgZ(3,"mat-icon",46),e._uU(4,"delete"),e.qZA()()()}}function fe(i,n){1&i&&e._UZ(0,"tr",47)}function he(i,n){1&i&&e._UZ(0,"tr",48)}const ge=function(i){return{"reached-max":i}};let Y=(()=>{class i{constructor(t,o,r,l,c,p){this._ordenesDeCompraService=t,this.data=o,this.datePipe=r,this.alert=l,this.dialogRef=c,this.dialogo=p,this.columns=["articulo","codigointerno","unidadmedida","cantidad","importe","acciones"],this.unidades_de_medida=[],this.items_list=[],this.maxPalabras=50,this.dataSource=new d.by,this.orden_de_compra=this.data?this.data:null,this.title=this.orden_de_compra?.codigo?"Editar orden de compra":"Nuevo orden de compra",this.user=JSON.parse(localStorage.getItem("user")),this.minDate=null,this.maxDate=new Date}ngOnInit(){this.newForm(),this.exist()}newForm(){const[t,o,r]=this.orden_de_compra?this.orden_de_compra.fecha.split("/"):"";this.orden_de_compra&&this.getItems(this.orden_de_compra.codigo).then(l=>{this.items_list=l.map(c=>({articulo:c.articulo,cantidad:c.cantidad,idunidadmedida:c.idunidadmedida,descripcion_articulo:c.descripcion_articulo,descripcion_um:c.descripcion_um,codigo_interno_articulo:c.codigo_interno_articulo,importe:c.importe})),this.dataSource=new d.by(this.items_list),0!=this.items_list.length?(this.form.get("iva").disable(),this.form.get("presupuesto").disable(),this.form.get("numero").disable()):(this.form.get("iva").enable(),this.form.get("presupuesto").enable(),this.form.get("numero").enable())}),this.form=new a.cw({proveedor:new a.NI(this.orden_de_compra?this.orden_de_compra.proveedor:"",a.kI.required),fecha:new a.NI(this.datePipe.transform(this.orden_de_compra?.fecha?new Date(`${o}/${t}/${r}`):new Date,"yyyy-MM-dd"),[a.kI.required]),observaciones:new a.NI(this.orden_de_compra?this.orden_de_compra.observaciones:"",[a.kI.maxLength(this.maxPalabras)]),numero:new a.NI(this.orden_de_compra?this.orden_de_compra.numero:"",a.kI.required),presupuesto:new a.NI(this.orden_de_compra?this.orden_de_compra.presupuesto:""),iva:new a.NI(this.orden_de_compra?this.orden_de_compra.iva:"",a.kI.required)})}getPalabrasLength(){const t=this.form.get("observaciones").value;return t?t.length:0}isPalabraMaxLengthReached(){return this.getPalabrasLength()<=this.maxPalabras}limpiarCasillero(t){this.form.get(t).setValue("")}exist(){this.orden_de_compra?.codigo?this.getProveedores(!0):this.getProveedores()}getProveedores(t){var o=this;return(0,g.Z)(function*(){const r=yield(0,Z.z)(o._ordenesDeCompraService.getProveedores(t));new Promise(function(){var l=(0,g.Z)(function*(c){if(o.proveedores=r.list,o.filteredProveedores=o.form.get("proveedor").valueChanges.pipe((0,O.O)(""),(0,P.U)(p=>o._filterProveedores(p))),o.orden_de_compra&&o.proveedores){const p=o.proveedores.filter(m=>m.Codigo==o.orden_de_compra.proveedor);o.form.get("proveedor").setValue(p[0])}c(!0)});return function(c){return l.apply(this,arguments)}}())})()}_filterProveedores(t){const o=t.toString().toLowerCase();return this.proveedores.filter(r=>r.RazonSocial.toLowerCase().includes(o))}getTextProveedor(t){return t?t.RazonSocial:""}getItems(t){var o=this;return(0,g.Z)(function*(){return new Promise(function(){var r=(0,g.Z)(function*(l){const c=yield(0,Z.z)(o._ordenesDeCompraService.getItems(t));o.items_list=c.list,l(o.items_list)});return function(l){return r.apply(this,arguments)}}())})()}addArticulo(){this.dialogo.open(K,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:t=>{t&&(this.items_list=[...this.items_list,{articulo:t.articulo.idarticulo,cantidad:t.cantidad,idunidadmedida:t.unidad_medida,descripcion_articulo:t.articulo.descripcion,descripcion_um:t.unidadmedida_descripcion,codigo_interno_articulo:t.articulo.codigo_interno,importe:t.importe}],this.dataSource=new d.by(this.items_list),0!=this.items_list.length&&(this.form.get("iva").disable(),this.form.get("presupuesto").disable(),this.form.get("numero").disable()))}})}deleteArticulo(t){this.items_list=this.items_list.filter(o=>o!==t),this.dataSource=new d.by(this.items_list),0===this.items_list.length&&(this.form.get("iva").enable(),this.form.get("presupuesto").enable(),this.form.get("numero").enable())}cambiarFecha(t){const o=t.split("/");if(3===o.length){const l=o[1],c=o[2];return new Date(Number(o[0]),Number(l),Number(c))}return"Fecha inv\xe1lida"}onSubmit(){if(!this.isPalabraMaxLengthReached())return alert(`La longitud m\xe1xima de observaciones es de ${this.maxPalabras} caracteres.`);if(!this.form.valid)return alert("Revise Los Datos Ingresados");{const t=this.form.get("proveedor").value;if(!this.proveedores.some(m=>m.Codigo===t.Codigo))return alert("El proveedor seleccionado no existe. Por favor, seleccione un proveedor v\xe1lido.");let r=this.items_list.map(m=>({articulo:m.articulo,cantidad:m.cantidad,um:m.idunidadmedida,importe:m.importe}));if(0===r.length)return alert("Debe ingresar un articulo al orden de compra");const l=this.form.get("presupuesto").value,c=l?l.toString():"",p={orden_compra:{fecha:this.form.get("fecha").value,numero:this.form.get("numero").value.toString(),usuario:this.user.id,proveedor:this.form.get("proveedor").value.Codigo,iva:this.form.get("iva").value,observaciones:this.form.get("observaciones").value,presupuesto:c},items:r};this.orden_de_compra?.codigo?this._ordenesDeCompraService.updateOrdenDeCompra(p,this.orden_de_compra.codigo).subscribe({next:m=>{m&&this.dialogRef.close(m)}}):this._ordenesDeCompraService.saveOrdenDeCompra(p).subscribe({next:m=>{m&&this.dialogRef.close(m)}})}}onCloseMenu(){this.dialogRef.close(!1)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A),e.Y36(b.WI),e.Y36(u.uU),e.Y36(w.T),e.Y36(b.so),e.Y36(b.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-save-ordenes-de-compra"]],features:[e._Bn([{provide:C.sG,useValue:J.x}])],decls:80,vars:28,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-140","sm:w-min-w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"shadow-md","mb-3"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/4"],["matInput","","formControlName","fecha","readonly","true",3,"matDatepicker","min","max"],["matSuffix","",3,"for"],["picker",""],["type","text","matInput","","formControlName","proveedor",3,"matAutocomplete"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["appearance","outline",1,"w-1/6"],["type","text","matInput","","formControlName","iva",3,"matAutocomplete"],["autoActiveFirstOption",""],["iva","matAutocomplete"],[3,"value"],["matInput","","type","number","formControlName","presupuesto"],["matInput","","type","number","formControlName","numero"],["appearance","outline",1,"w-full"],["matInput","","formControlName","observaciones",1,"resize-none"],[1,"counter",3,"ngClass"],[1,"overflow-y-auto","max-h-[150px]","h-[150px]","shadow-xl","pb-10","border-t-2","border-slate-200"],["mat-table","",1,"w-full","mt-1",3,"dataSource"],["matColumnDef","articulo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","codigointerno"],["matColumnDef","unidadmedida"],["matColumnDef","cantidad"],["matColumnDef","importe"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-mini-fab","","color","primary","matTooltip","A\xf1adir Articulo","aria-label","icon",1,"rounded-full",3,"click"],["delete",""],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return o.onCloseMenu()}),e.TgZ(6,"mat-icon",4),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"form",5)(9,"div",6)(10,"div",7)(11,"mat-form-field",8),e._UZ(12,"input",9)(13,"mat-datepicker-toggle",10)(14,"mat-datepicker",null,11),e.qZA(),e.TgZ(16,"mat-form-field",8)(17,"mat-label"),e._uU(18,"Proveedor"),e.qZA(),e._UZ(19,"input",12),e.TgZ(20,"mat-autocomplete",13,14),e.YNc(22,V,2,2,"mat-option",15),e.ALo(23,"async"),e.qZA(),e.YNc(24,W,3,0,"button",16),e.qZA(),e.TgZ(25,"mat-form-field",17)(26,"mat-label"),e._uU(27,"IVA %"),e.qZA(),e._UZ(28,"input",18),e.TgZ(29,"mat-autocomplete",19,20)(31,"mat-option",21),e._uU(32,"10.5%"),e.qZA(),e.TgZ(33,"mat-option",21),e._uU(34,"21%"),e.qZA(),e.TgZ(35,"mat-option",21),e._uU(36,"27%"),e.qZA()(),e.YNc(37,X,3,0,"button",16),e.qZA(),e.TgZ(38,"mat-form-field",17)(39,"mat-label"),e._uU(40,"Presupuesto"),e.qZA(),e._UZ(41,"input",22),e.YNc(42,ee,3,0,"button",16),e.qZA(),e.TgZ(43,"mat-form-field",17)(44,"mat-label"),e._uU(45,"N\xfamero"),e.qZA(),e._UZ(46,"input",23),e.YNc(47,te,3,0,"button",16),e.qZA()(),e.TgZ(48,"div")(49,"mat-form-field",24)(50,"mat-label"),e._uU(51,"Observaciones"),e.qZA(),e._UZ(52,"textarea",25),e.TgZ(53,"div",26),e._uU(54),e.qZA()()()(),e.TgZ(55,"div",27)(56,"table",28),e.ynx(57,29),e.YNc(58,oe,2,0,"th",30),e.YNc(59,ie,2,1,"td",31),e.BQk(),e.ynx(60,32),e.YNc(61,re,2,0,"th",30),e.YNc(62,ne,2,1,"td",31),e.BQk(),e.ynx(63,33),e.YNc(64,ae,2,0,"th",30),e.YNc(65,se,2,1,"td",31),e.BQk(),e.ynx(66,34),e.YNc(67,le,2,0,"th",30),e.YNc(68,ce,2,1,"td",31),e.BQk(),e.ynx(69,35),e.YNc(70,de,2,0,"th",30),e.YNc(71,me,2,1,"td",31),e.BQk(),e.ynx(72,36),e.YNc(73,ue,4,0,"th",30),e.YNc(74,pe,5,0,"td",31),e.BQk(),e.YNc(75,fe,1,0,"tr",37),e.YNc(76,he,1,0,"tr",38),e.qZA()()(),e.TgZ(77,"div",39)(78,"button",40),e.NdJ("click",function(){return o.onSubmit()}),e._uU(79," Guardar "),e.qZA()()()),2&t){const r=e.MAs(15),l=e.MAs(21),c=e.MAs(30);e.xp6(3),e.Oqu(o.title),e.xp6(5),e.Q6J("formGroup",o.form),e.xp6(4),e.Q6J("matDatepicker",r)("min",o.minDate)("max",o.maxDate),e.xp6(1),e.Q6J("for",r),e.xp6(6),e.Q6J("matAutocomplete",l),e.xp6(1),e.Q6J("displayWith",o.getTextProveedor),e.xp6(2),e.Q6J("ngForOf",e.lcZ(23,24,o.filteredProveedores)),e.xp6(2),e.Q6J("ngIf",o.form.get("proveedor").value),e.xp6(4),e.Q6J("matAutocomplete",c),e.xp6(3),e.Q6J("value","10.5"),e.xp6(2),e.Q6J("value","21.0"),e.xp6(2),e.Q6J("value","27.0"),e.xp6(2),e.Q6J("ngIf",o.form.get("iva").value&&0==o.items_list.length),e.xp6(5),e.Q6J("ngIf",o.form.get("presupuesto").value&&0==o.items_list.length),e.xp6(5),e.Q6J("ngIf",o.form.get("numero").value&&0==o.items_list.length),e.xp6(6),e.Q6J("ngClass",e.VKq(26,ge,!o.isPalabraMaxLengthReached())),e.xp6(1),e.AsE(" ",o.getPalabrasLength(),"/",o.maxPalabras," "),e.xp6(2),e.Q6J("dataSource",o.dataSource),e.xp6(19),e.Q6J("matHeaderRowDef",o.columns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",o.columns)}},dependencies:[u.mk,u.sg,u.O5,d.BZ,d.fO,d.as,d.w1,d.Dz,d.nj,d.ge,d.ev,d.XQ,d.Gk,f.lW,f.RK,f.nh,h.KE,h.hX,h.R9,C.ey,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,S.Nt,x.Hw,U.gM,T.XC,T.ZL,v.Mq,v.hl,v.nW,u.Ov],styles:['@charset "UTF-8";.counter[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;right:.5rem;font-size:.75rem;color:#c9c9c9}.counter.reached-max[_ngcontent-%COMP%]{color:#e53e3e}']}),i})();var q=s(2018),_e=s(8288);function ve(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.limpiarFechas())}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function be(i,n){if(1&i&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t.Codigo),e.xp6(1),e.hij(" ",t.RazonSocial," ")}}let Ce=(()=>{class i{constructor(t,o,r,l){this.data=t,this._menuService=o,this.datePipe=r,this._ordenesDeCompraService=l,this.filterProveedor=[]}ngOnInit(){this.formFilters=new a.cw({filtroFechaInicio:new a.NI(""),filtroFechaFin:new a.NI(""),proveedor:new a.NI(-1)}),this.getProveedores(),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({filtroFechaInicio:"",filtroFechaFin:"",proveedor:-1})}onCloseMenu(t=null){t&&(t.filtroFechaInicio=this.datePipe.transform(this.formFilters.get("filtroFechaInicio").value,"yyyy-MM-dd"),t.filtroFechaFin=this.datePipe.transform(this.formFilters.get("filtroFechaFin").value,"yyyy-MM-dd")),this._menuService.close(t)}limpiarFechas(){this.formFilters.get("filtroFechaInicio").setValue(""),this.formFilters.get("filtroFechaFin").setValue("")}getProveedores(){var t=this;return(0,g.Z)(function*(){const o=yield(0,Z.z)(t._ordenesDeCompraService.getProveedores());t.filterProveedor=o.list})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36("MENU_DATA"),e.Y36(D.r),e.Y36(u.uU),e.Y36(A))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-filter-menu-ordenes-de-compra"]],features:[e._Bn([{provide:C.sG,useValue:J.x}])],decls:36,vars:7,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base","mt-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],[3,"rangePicker"],["matStartDate","","placeholder","Desde","formControlName","filtroFechaInicio"],["matEndDate","","placeholder","Hasta","formControlName","filtroFechaFin"],["matIconSuffix","",3,"for"],["picker",""],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","proveedor"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"Filtros"),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return o.resetFilters()}),e.TgZ(6,"mat-icon",4),e._uU(7,"refresh"),e.qZA()(),e.TgZ(8,"button",5),e.NdJ("click",function(){return o.onCloseMenu()}),e.TgZ(9,"mat-icon",4),e._uU(10,"close"),e.qZA()()()(),e.TgZ(11,"form",6)(12,"span",7),e._uU(13,"Rango de fechas"),e.qZA(),e.TgZ(14,"mat-form-field",8)(15,"mat-date-range-input",9),e._UZ(16,"input",10)(17,"input",11),e.qZA(),e._UZ(18,"mat-datepicker-toggle",12)(19,"mat-date-range-picker",null,13),e.YNc(21,ve,3,0,"button",14),e.qZA(),e.TgZ(22,"span",7),e._uU(23,"Proveedor"),e.qZA(),e.TgZ(24,"mat-form-field",8)(25,"mat-select",15)(26,"mat-option",16),e._uU(27,"Todos"),e.qZA(),e.YNc(28,be,2,2,"mat-option",17),e.qZA()()(),e.TgZ(29,"div",18)(30,"button",19),e.NdJ("click",function(){return o.resetFilters()}),e.TgZ(31,"span",20),e._uU(32,"Limpiar"),e.qZA()(),e.TgZ(33,"button",21),e.NdJ("click",function(){return o.onCloseMenu(o.formFilters.getRawValue())}),e.TgZ(34,"span",22),e._uU(35,"Filtrar"),e.qZA()()()()),2&t){const r=e.MAs(20);e.Q6J("@expandCollapse","expanded"),e.xp6(11),e.Q6J("formGroup",o.formFilters),e.xp6(4),e.Q6J("rangePicker",r),e.xp6(3),e.Q6J("for",r),e.xp6(3),e.Q6J("ngIf",o.formFilters.get("filtroFechaInicio").value||o.formFilters.get("filtroFechaFin").value),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",o.filterProveedor)}},dependencies:[u.sg,u.O5,f.lW,f.RK,h.KE,h.R9,N.gD,C.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,x.Hw,v.nW,v.wx,v.zY,v.By,v._g],data:{animation:_e.L}}),i})();var xe=s(1683),Ze=s(7374),Ae=s(8978);let Te=(()=>{class i{constructor(t,o,r,l,c,p,m,De){this._ordenesDeCompraService=t,this.confirm=o,this.alert=r,this.dialogo=l,this._searchService=c,this._menuService=p,this.router=m,this._headerTextService=De,this.dataSource=new d.by,this.headers=["N\xb0","Fecha","Observaciones","Proveedor","Presupuesto","Acciones"],this.column_params=["numero","fecha","observaciones","proveedor_descripcion","presupuesto","acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["observaciones","proveedor_descripcion","numero"],this.filter={proveedor:-1},this.extraParams="",this.parametrosActualizados=new e.vpe,this.env=_.N.compras.orden_compra+"?sort=-codigo",this.search=new a.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,M.b)(750),(0,k.x)()).subscribe(t=>{this.filtroBusqueda=t,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(t=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(t){this._menuService.open(Ce,t._elementRef,{filter:this.filter}).afterClosed().subscribe({next:o=>{o&&(this.filter=o,-1===this.filter.proveedor?this.extraParams=this.extraParams.replace(/filter\[proveedor\]=\d+&?/g,""):this.extraParams+="filter[proveedor]="+this.filter.proveedor+"&",this.extraParams+=null!=this.filter.filtroFechaInicio?"filter[fecha][gte]="+this.filter.filtroFechaInicio+"&":"",this.extraParams+=null!=this.filter.filtroFechaFin?"filter[fecha][lte]="+this.filter.filtroFechaFin+"&":"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(t){switch(t.name){case"editar":this.updateOrdenDeCompra(t);break;case"eliminar":this.deleteOrdenDeCompra(t)}}saveOrdenDeCompra(){this.dialogo.open(Y,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updateOrdenDeCompra(t){this.dialogo.open(Y,{data:t.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteOrdenDeCompra(t){this.confirm.open({title:"Eliminar orden de compra N\xb0"+t.params.data.codigo,message:`\xbfDesea eliminar la orden de compra: N\xb0 ${t.params.data.codigo} del proveedor ${t.params.data.proveedor_descripcion} ?`,dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(o=>{"confirmed"===o&&this._ordenesDeCompraService.deleteOrdenDeCompra(t.params.data.codigo).subscribe({next:r=>{alert("Orden de compra eliminado con \xe9xito."),r&&this.tabla.renderTabla()},error:r=>{console.error("Error en el servicio:",r),alert("Esta orden de compra no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A),e.Y36(xe.R),e.Y36(w.T),e.Y36(b.uw),e.Y36(Ze.o),e.Y36(D.r),e.Y36(y.F0),e.Y36(Ae.k))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-ordenes-de-compra"]],viewQuery:function(t,o){if(1&t&&e.Gf(q.C,5),2&t){let r;e.iGM(r=e.CRH())&&(o.tabla=r.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-4","mt-2","pb-4"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Orden",1,"mr-2","ml-2","bg-blue-500","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2","mt-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),e.NdJ("click",function(){return o.saveOrdenDeCompra()}),e.TgZ(5,"mat-icon",5),e._uU(6,"add"),e.qZA()()()(),e.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),e.NdJ("functionEmitter",function(l){return o.generarAcciones(l)}),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("cache",!1)("columnsNames",o.headers)("renderType","ssp")("columnsParams",o.column_params)("endpoint",o.env)("functions",o.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",o.filtersLike)("extraParams",o.extraParams))},dependencies:[f.RK,x.Hw,U.gM,q.C]}),i})();var we=s(1292),Fe=s(2611),ye=s(3873);const Ne=[{path:"",component:Te}];let Se=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[A,D.r,w.T,u.uU],imports:[u.ez,y.Bz.forChild(Ne),d.p0,f.ot,N.LD,h.lN,a.UX,S.c,x.Ps,R.W,U.AV,T.Bb,Q.g0,we.p9,Fe.JX,ye.f,b.Is,v.FA,y.Bz]}),i})()}}]);