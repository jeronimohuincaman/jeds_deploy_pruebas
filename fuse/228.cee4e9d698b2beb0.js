"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[228],{2228:(Jt,I,u)=>{u.r(I),u.d(I,{EntregasModule:()=>St});var k=u(1531),f=u(4755),Q=u(9383),m=u(3627),g=u(1728),S=u(787),_=u(9114),s=u(9401),M=u(9609),$=u(5971),J=u(3686),C=u(430),y=u(6375),E=u(3649),t=u(2223),O=u(8372),P=u(1884),p=u(5861),b=u(3905),F=u(8675),U=u(4004),x=u(5580),Z=u(1217),D=u(3611),h=u(2340),A=u(7579),V=u(3144),L=u(8951);let T=(()=>{class a{constructor(e,i){this.http=e,this._authService=i}saveEntrega(e){return this.http.post(`${h.N.stock.entregas}`,e)}updateEntrega(e,i){return this.http.put(`${h.N.stock.entregas}/`+i,e)}deleteEntrega(e){return this.http.delete(`${h.N.stock.entregas}/`+e)}getDepositos(e){let i="?";i+=e?"":"filter[activo]=1";let o=new A.x;return this.http.get(`${h.N.stock.depositos}${i}`).subscribe(n=>{o.next({list:n.result})}),o.asObservable()}getArticulosDepositos(e){let i=`?filter[deposito]=${e}`,o=new A.x;return this.http.get(`${h.N.stock.view_stock_articulo_depositos}${i}`).subscribe(n=>{o.next({list:n.result})}),o.asObservable()}getUnidadesDeMedidaArticulos(e){let i=`?filter[idarticulo]=${e}`;i+="&expand=um";let o=new A.x;return this.http.get(`${h.N.stock.articulo_unidad_medidas}${i}`).subscribe(n=>{o.next({list:n.result})}),o.asObservable()}getItems(e){let i=`?filter[identrega]=${e}`,o=new A.x;return this.http.get(`${h.N.stock.view_stock_movimientos}${i}`).subscribe(n=>{o.next({list:n.result})}),o.asObservable()}getVentas(){let e=new A.x;return this.http.get(`${h.N.ventas.view_venta_selects}`).subscribe(i=>{e.next({list:i.result})}),e.asObservable()}getUsuarios(e){let i="?sort=asc";i+=e?"":"filter[activo]=1";let o=new A.x;return this.http.get(`${h.N.login.view_usuarios}${i}`).subscribe(n=>{o.next({list:n.result})}),o.asObservable()}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(V.eN),t.LFG(L.e))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();var w=u(8995);function R(a,r){if(1&a&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.codigo_interno," - ",e.descripcion," ")}}function j(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.limpiarCasillero("articulo"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function G(a,r){if(1&a&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e.idunidadmedida),t.xp6(1),t.Oqu(e.descripcion_um)}}function H(a,r){if(1&a&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.cliente," - ",e.fecha," ")}}function z(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.limpiarCasillero("venta"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}const B=function(){return{cliente:"",fecha:"",idventa:null}};let K=(()=>{class a{constructor(e,i,o,n,l,c){this.data=e,this._entregasService=i,this.datePipe=o,this.alert=n,this.dialogRef=l,this.dialogo=c,this.columns=["articulo","cantidad","unidadmedida","acciones"],this.articulos=[],this.unidades_de_medida=[],this.depositos=[],this.ventas=[],this.articulos_list=[],this.dataSource=new m.by,this.title="A\xf1adir entrega de articulo"}ngOnInit(){this.newForm(),this.getArticulosDepositos(),this.getVentas()}getArticulosDepositos(){var e=this;return(0,p.Z)(function*(){const i=yield(0,b.z)(e._entregasService.getArticulosDepositos(e.data.deposito_entrega));new Promise(function(){var o=(0,p.Z)(function*(n){e.articulos=i.list,e.filteredArticulos=e.form.get("articulo").valueChanges.pipe((0,F.O)(""),(0,U.U)(l=>e._filterArticulos(l))),n(!0)});return function(n){return o.apply(this,arguments)}}()),i.list.forEach(o=>{e.articulos_list.find(l=>l.idarticulo===o.idarticulo)||e.articulos_list.push({idarticulo:o.idarticulo,codigo_interno:o.codigo_interno,descripcion:o.descripcion})})})()}_filterArticulos(e){const i=e.toString().toLowerCase();return this.articulos_list.filter(o=>{const n=o.codigo_interno.toString().toLowerCase().includes(i),l=o.descripcion.toString().toLowerCase().includes(i);return n||l})}getTextArticulo(e){return e?`${e.codigo_interno} - ${e.descripcion}`:""}getVentas(){var e=this;return(0,p.Z)(function*(){const i=yield(0,b.z)(e._entregasService.getVentas());e.ventas=i.list,e.filteredVentas=e.form.get("venta").valueChanges.pipe((0,F.O)(""),(0,U.U)(o=>e._filterVentas(o)))})()}_filterVentas(e){const i=e.toString().toLowerCase();return this.ventas.filter(o=>{const n=o.cliente.toString().toLowerCase().includes(i),l=o.fecha.toString().toLowerCase().includes(i);return n||l})}getTextVenta(e){return e?`${e.cliente} - ${e.fecha}`:""}getUnidadesDeMedidaArticulos(e){var i=this;new Promise(function(){var o=(0,p.Z)(function*(n){i.unidades_de_medida=i.articulos.filter(l=>l.idarticulo===e).map(l=>({idarticulo:l.idarticulo,idunidadmedida:l.idunidadmedida,descripcion_um:l.um,stock:l.stock})),n(!0)});return function(n){return o.apply(this,arguments)}}())}seleccionArticulo(e){if(e.idarticulo&&(this.form.get("unidadmedida").enable(),this.getUnidadesDeMedidaArticulos(e.idarticulo)),e.um){let o,i=this.unidades_de_medida.find(c=>c.idarticulo===this.form.get("articulo").value.idarticulo&&c.idunidadmedida===this.form.get("unidadmedida").value),n=0;this.data.movimientos.length>0?(this.data.movimientos.filter(d=>d.idarticulo===i.idarticulo&&d.idunidadmedida===i.idunidadmedida).forEach(d=>{n+=Number(d.cantidad)}),o=""+(Number(i.stock)-n)):o=i.stock,this.form.get("stock_existente").setValue(o)}}limpiarCasillero(e){"articulo"==e&&(this.form.get("articulo").setValue(""),this.form.get("unidadmedida").disable(),this.form.get("unidadmedida").setValue(""),this.form.get("stock_existente").setValue("")),this.form.get("venta").setValue("")}newForm(){this.form=new s.cw({articulo:new s.NI("",s.kI.required),unidadmedida:new s.NI("",s.kI.required),cantidad:new s.NI("",s.kI.required),stock_existente:new s.NI(""),venta:new s.NI("",s.kI.required)})}onSubmit(){if(!this.form.valid)return alert("Revise Los Datos Ingresados");this.articulos.forEach(e=>{if(e.idarticulo===this.form.get("articulo").value.idarticulo&&e.idunidadmedida===this.form.get("unidadmedida").value){if(this.form.get("cantidad").value>e.stock)return this.form.get("cantidad").setValue(""),alert("No hay stock suficiente!");if(this.data.movimientos.find(o=>o.idarticulo===this.form.get("articulo").value.idarticulo&&o.idunidadmedida===this.form.get("unidadmedida").value&&o.idventa===this.form.get("venta").value.idventa))return this.form.get("unidadmedida").setValue(""),this.form.get("venta").setValue(""),alert("Ya existe un movimiento de ese articulo con esa unidad de medida asociado a esa venta.");if(this.form.get("cantidad").value<=e.stock&&this.form.get("cantidad").value>0){let o=this.unidades_de_medida.find(l=>l.idunidadmedida===this.form.get("unidadmedida").value),n={articulo:this.form.get("articulo").value,unidad_medida:this.form.get("unidadmedida").value,unidadmedida_descripcion:o.descripcion_um,stock:""+(Number(e.stock)-this.form.get("cantidad").value),cantidad:this.form.get("cantidad").value,venta:this.form.get("venta").value};this.onCloseMenu(n)}}})}onCloseMenu(e){this.dialogRef.close(e||!1)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(x.WI),t.Y36(T),t.Y36(f.uU),t.Y36(y.T),t.Y36(x.so),t.Y36(x.uw))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-add-articulo-entregas"]],features:[t._Bn([{provide:Z.sG,useValue:D.x}])],decls:47,vars:17,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","articulo",3,"matAutocomplete","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","unidadmedida",3,"ngModelChange"],["appearance","outline",1,"w-1/3"],["matInput","","type","number","formControlName","stock_existente","readonly","true"],["matInput","","type","number","formControlName","cantidad"],["type","text","matInput","","formControlName","venta",3,"matAutocomplete"],["vn","matAutocomplete"],[3,"value"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div")(10,"div",6)(11,"mat-form-field",7)(12,"mat-label"),t._uU(13,"Art\xedculo"),t.qZA(),t.TgZ(14,"input",8),t.NdJ("ngModelChange",function(n){return i.seleccionArticulo(n)}),t.qZA(),t.TgZ(15,"mat-autocomplete",9,10),t.YNc(17,R,2,3,"mat-option",11),t.ALo(18,"async"),t.qZA(),t.YNc(19,j,3,0,"button",12),t.qZA(),t.TgZ(20,"mat-form-field",7)(21,"mat-label"),t._uU(22,"UM"),t.qZA(),t.TgZ(23,"mat-select",13),t.NdJ("ngModelChange",function(n){return i.seleccionArticulo({um:n})}),t.YNc(24,G,2,2,"mat-option",11),t.qZA()(),t.TgZ(25,"mat-form-field",14)(26,"mat-label"),t._uU(27,"En stock"),t.qZA(),t._UZ(28,"input",15),t.qZA(),t.TgZ(29,"mat-form-field",14)(30,"mat-label"),t._uU(31,"Cantidad"),t.qZA(),t._UZ(32,"input",16),t.qZA(),t.TgZ(33,"mat-form-field",7)(34,"mat-label"),t._uU(35,"Venta"),t.qZA(),t._UZ(36,"input",17),t.TgZ(37,"mat-autocomplete",9,18)(39,"mat-option",19),t._uU(40," - "),t.qZA(),t.YNc(41,H,2,3,"mat-option",11),t.ALo(42,"async"),t.qZA(),t.YNc(43,z,3,0,"button",12),t.qZA()()()(),t.TgZ(44,"div",20)(45,"button",21),t.NdJ("click",function(){return i.onSubmit()}),t._uU(46," A\xf1adir "),t.qZA()()()),2&e){const o=t.MAs(16),n=t.MAs(38);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(6),t.Q6J("matAutocomplete",o),t.xp6(1),t.Q6J("displayWith",i.getTextArticulo),t.xp6(2),t.Q6J("ngForOf",t.lcZ(18,12,i.filteredArticulos)),t.xp6(2),t.Q6J("ngIf",i.form.get("articulo").value),t.xp6(5),t.Q6J("ngForOf",i.unidades_de_medida),t.xp6(12),t.Q6J("matAutocomplete",n),t.xp6(1),t.Q6J("displayWith",i.getTextVenta),t.xp6(2),t.Q6J("value",t.DdM(16,B)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(42,14,i.filteredVentas)),t.xp6(2),t.Q6J("ngIf",i.form.get("venta").value)}},dependencies:[f.sg,f.O5,g.lW,g.RK,_.KE,_.hX,_.R9,S.gD,Z.ey,s._Y,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,M.Nt,C.Hw,w.XC,w.ZL,f.Ov]}),a})();var v=u(8280);function W(a,r){if(1&a&&(t.TgZ(0,"mat-option",38),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.nick," ")}}function X(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"button",39),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.limpiarCasillero("usuario_entrega"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function tt(a,r){if(1&a&&(t.TgZ(0,"mat-option",38),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.descripcion," ")}}function et(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"button",39),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.limpiarCasillero("deposito_entrega"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function it(a,r){1&a&&(t.TgZ(0,"th",40),t._uU(1," Articulo"),t.qZA())}function ot(a,r){if(1&a&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.xp6(1),t.hij(" ",e.descripcion_articulo," ")}}function at(a,r){1&a&&(t.TgZ(0,"th",40),t._uU(1," Codigo Interno"),t.qZA())}function nt(a,r){if(1&a&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.xp6(1),t.hij(" ",e.codigo_interno," ")}}function rt(a,r){1&a&&(t.TgZ(0,"th",40),t._uU(1,"Unidad de medida"),t.qZA())}function st(a,r){if(1&a&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.xp6(1),t.hij(" ",e.descripcion_um," ")}}function lt(a,r){1&a&&(t.TgZ(0,"th",40),t._uU(1,"Cantidad"),t.qZA())}function ut(a,r){if(1&a&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.xp6(1),t.hij(" ",e.cantidad," ")}}function ct(a,r){1&a&&(t.TgZ(0,"th",40),t._uU(1,"Venta"),t.qZA())}function dt(a,r){if(1&a&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.xp6(1),t.AsE(" ",e.cliente_venta," - ",e.fecha_venta," ")}}function mt(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"th",40)(1,"button",42),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addMovimiento())}),t.TgZ(2,"mat-icon"),t._uU(3,"add"),t.qZA()()()}}function ft(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"td",41)(1,"button",3,43),t.NdJ("click",function(){const n=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.deleteMovimiento(n))}),t.TgZ(3,"mat-icon",44),t._uU(4,"delete"),t.qZA()()()}}function pt(a,r){1&a&&t._UZ(0,"tr",45)}function ht(a,r){1&a&&t._UZ(0,"tr",46)}const gt=function(a){return{"reached-max":a}};let q=(()=>{class a{constructor(e,i,o,n,l,c){this.data=e,this._entregasService=i,this.datePipe=o,this.alert=n,this.dialogRef=l,this.dialogo=c,this.columns=["articulo","codigointerno","unidadmedida","cantidad","venta","acciones"],this.usuarios=[],this.depositos=[],this.mov_art_list=[],this.ventas=[],this.maxPalabras=50,this.dataSource=new m.by,this.entrega=this.data?this.data:null,this.title=this.entrega?.identrega?`Editar Entrega ${this.entrega.fecha} - ${this.entrega.hora}`:"Nueva Entrega",this.user=JSON.parse(localStorage.getItem("user")),this.minDate=null,this.maxDate=new Date}ngOnInit(){this.newForm(),this.exist()}newForm(){const[e,i,o]=this.entrega?this.entrega.fecha.split("/"):"";this.entrega&&Promise.all([this.getVentas(),this.getItems(this.entrega.identrega)]).then(([n,l])=>{this.ventas=n,this.mov_art_list=l.map(c=>{let d=this.ventas.find(N=>N.idventa===c.idventa);return{idarticulo:c.idarticulo,cantidad:c.cantidad,idunidadmedida:c.idunidadmedida,descripcion_articulo:c.descripcion_articulo,descripcion_um:c.descripcion_um,codigo_interno:c.codigo_interno_articulo,stock:c.stock_minimo_articulo,idventa:c.idventa?d.idventa:null,fecha_venta:d?d.fecha:"",cliente_venta:d?d.cliente:""}}),this.dataSource=new m.by(this.mov_art_list),0!=this.mov_art_list.length?this.form.get("deposito_entrega").disable():this.form.get("deposito_entrega").enable()}),this.form=new s.cw({fecha:new s.NI(this.datePipe.transform(this.entrega?.fecha?new Date(`${i}/${e}/${o}`):new Date,"yyyy-MM-dd"),[s.kI.required]),hora:new s.NI(this.entrega?.hora?this.entrega.hora:this.datePipe.transform(new Date,"HH:mm"),s.kI.required),usuario_entrega:new s.NI(this.entrega?this.entrega.nick_usuario_entrega:"",s.kI.required),deposito_entrega:new s.NI(this.entrega?this.entrega.descripcion_deposito:"",s.kI.required),observaciones:new s.NI(this.entrega?this.entrega.observaciones:"",[s.kI.maxLength(this.maxPalabras)])})}getPalabrasLength(){const e=this.form.get("observaciones").value;return e?e.length:0}isPalabraMaxLengthReached(){return this.getPalabrasLength()<=this.maxPalabras}exist(){this.entrega?.idusuario?this.getUsuarios(!0):this.getUsuarios(),this.entrega?.identrega?this.getDepositos(!0):this.getDepositos()}getUsuarios(e){var i=this;return(0,p.Z)(function*(){const o=yield(0,b.z)(i._entregasService.getUsuarios(e));new Promise(function(){var n=(0,p.Z)(function*(l){i.usuarios=o.list,i.filteredUsuarios=i.form.get("usuario_entrega").valueChanges.pipe((0,F.O)(""),(0,U.U)(c=>i._filterUsuarios(c))),l(!0)});return function(l){return n.apply(this,arguments)}}())})()}_filterUsuarios(e){const i=e.toString().toLowerCase();return this.usuarios.filter(o=>o.nick.toLowerCase().includes(i)&&o.codigo!==this.user.id)}getTextUsuario(e){return e.nick?e.nick:e.usuario?e.usuario:e}getDepositos(e){var i=this;return(0,p.Z)(function*(){const o=yield(0,b.z)(i._entregasService.getDepositos(e));new Promise(function(){var n=(0,p.Z)(function*(l){i.depositos=o.list,i.filteredDepositos=i.form.get("deposito_entrega").valueChanges.pipe((0,F.O)(""),(0,U.U)(c=>i._filterDepositos(c))),l(!0)});return function(l){return n.apply(this,arguments)}}())})()}_filterDepositos(e){const i=e.toString().toLowerCase();return this.depositos.filter(o=>o.descripcion.toLowerCase().includes(i))}getTextDeposito(e){return e.descripcion?e.descripcion:e.deposito?e.deposito:e}getVentas(){var e=this;return(0,p.Z)(function*(){return new Promise(function(){var i=(0,p.Z)(function*(o){const n=yield(0,b.z)(e._entregasService.getVentas());e.ventas=n.list,o(e.ventas)});return function(o){return i.apply(this,arguments)}}())})()}getItems(e){var i=this;return(0,p.Z)(function*(){return new Promise(function(){var o=(0,p.Z)(function*(n){const l=yield(0,b.z)(i._entregasService.getItems(e));i.mov_art_list=l.list,n(i.mov_art_list)});return function(n){return o.apply(this,arguments)}}())})()}addMovimiento(){if(""!=this.form.get("deposito_entrega").value){let e=this.form.get("deposito_entrega").value.iddeposito;"string"==typeof this.form.get("deposito_entrega").value&&(e=this.depositos.find(o=>o.descripcion===this.form.get("deposito_entrega").value).iddeposito),this.dialogo.open(K,{panelClass:"ayuda-dialog",data:{deposito_entrega:e,movimientos:this.mov_art_list}}).afterClosed().subscribe({next:i=>{i&&(this.mov_art_list=[...this.mov_art_list,{idarticulo:i.articulo.idarticulo,cantidad:i.cantidad,idunidadmedida:i.unidad_medida,descripcion_articulo:i.articulo.descripcion,descripcion_um:i.unidadmedida_descripcion,codigo_interno:i.articulo.codigo_interno,stock:i.stock,idventa:i.venta.idventa?i.venta.idventa:null,fecha_venta:i.venta?i.venta.fecha:"",cliente_venta:i.venta?i.venta.cliente:""}],this.dataSource=new m.by(this.mov_art_list),0!=this.mov_art_list.length&&this.form.get("deposito_entrega").disable())}})}else alert("Seleccione un Dep\xf3sito de origen")}deleteMovimiento(e){this.mov_art_list.forEach(i=>{i.idarticulo==e.idarticulo&&i.idunidadmedida==e.idunidadmedida&&(i.stock=`${Number(i.stock)+i.cantidad}`)}),this.mov_art_list=this.mov_art_list.filter(i=>i!==e),this.dataSource=new m.by(this.mov_art_list),0===this.mov_art_list.length&&this.form.get("deposito_entrega").enable()}limpiarCasillero(e){this.form.get(e).setValue("")}onSubmit(){if(!this.isPalabraMaxLengthReached())return alert(`La longitud m\xe1xima de observaciones es de ${this.maxPalabras} caracteres.`);if(!this.form.valid)return alert("Revise Los Datos Ingresados");{if(!this.entrega||this.entrega&&this.form.get("usuario_entrega").value!==this.entrega.nick_usuario_entrega){const d=this.form.get("usuario_entrega").value;if(!this.usuarios.find(Mt=>Mt.codigo===d.codigo))return alert("El usuario de entrega seleccionado no existe. Por favor, seleccione un usuario v\xe1lido.")}let e=this.mov_art_list.map(d=>({idarticulo:d.idarticulo,cantidad:d.cantidad,idunidadmedida:d.idunidadmedida,idventa:d.idventa}));if(0===e.length)return alert("Debe ingresar un articulo a la orden de entrega");const i=this.form.get("fecha").value,o=this.form.get("hora").value,l=`${this.datePipe.transform(i,"yyyy-MM-dd")} ${o}`,c={entrega:{idusuario:this.user.id,fecha_hora:l,iddeposito:this.form.get("deposito_entrega").value.iddeposito,usuario_entrega:this.form.get("usuario_entrega").value.codigo,observaciones:this.form.get("observaciones").value},movimientos:e};this.entrega?.identrega?this._entregasService.updateEntrega(c,this.entrega.identrega).subscribe({next:d=>{d&&this.dialogRef.close(d)}}):this._entregasService.saveEntrega(c).subscribe({next:d=>{d&&this.dialogRef.close(d)}})}}onCloseMenu(){this.dialogRef.close(!1)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(x.WI),t.Y36(T),t.Y36(f.uU),t.Y36(y.T),t.Y36(x.so),t.Y36(x.uw))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-save-entregas"]],features:[t._Bn([{provide:Z.sG,useValue:D.x}])],decls:70,vars:27,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"shadow-md","mb-3"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/4"],["matInput","","placeholder","Fecha","formControlName","fecha",3,"matDatepicker","min","max"],["matSuffix","",3,"for"],["picker",""],["matInput","","formControlName","hora","type","time"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","usuario_entrega",3,"matAutocomplete"],["autoActiveFirstOption","",3,"displayWith"],["ue","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["type","text","matInput","","formControlName","deposito_entrega",3,"matAutocomplete"],["art","matAutocomplete"],["appearance","outline",1,"w-full"],["matInput","","formControlName","observaciones",1,"resize-none"],[1,"counter",3,"ngClass"],[1,"overflow-y-auto","max-h-[150px]","h-[150px]","shadow-xl","pb-10","border-t-2","border-slate-200"],["mat-table","",1,"w-full","mt-1",3,"dataSource"],["matColumnDef","articulo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","codigointerno"],["matColumnDef","unidadmedida"],["matColumnDef","cantidad"],["matColumnDef","venta"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-mini-fab","","color","primary","aria-label","icon","matTooltip","A\xf1adir Articulo",1,"rounded-full",3,"click"],["delete",""],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div",6)(10,"div",7)(11,"mat-form-field",8),t._UZ(12,"input",9)(13,"mat-datepicker-toggle",10)(14,"mat-datepicker",null,11),t.qZA(),t.TgZ(16,"mat-form-field",8)(17,"mat-label"),t._uU(18,"Hora"),t.qZA(),t._UZ(19,"input",12),t.qZA(),t.TgZ(20,"mat-form-field",13)(21,"mat-label"),t._uU(22,"Usuario Entrega"),t.qZA(),t._UZ(23,"input",14),t.TgZ(24,"mat-autocomplete",15,16),t.YNc(26,W,2,2,"mat-option",17),t.ALo(27,"async"),t.qZA(),t.YNc(28,X,3,0,"button",18),t.qZA(),t.TgZ(29,"mat-form-field",13)(30,"mat-label"),t._uU(31,"Dep\xf3sito"),t.qZA(),t._UZ(32,"input",19),t.TgZ(33,"mat-autocomplete",15,20),t.YNc(35,tt,2,2,"mat-option",17),t.ALo(36,"async"),t.qZA(),t.YNc(37,et,3,0,"button",18),t.qZA()(),t.TgZ(38,"div")(39,"mat-form-field",21)(40,"mat-label"),t._uU(41,"Observaciones"),t.qZA(),t._UZ(42,"textarea",22),t.TgZ(43,"div",23),t._uU(44),t.qZA()()()(),t.TgZ(45,"div",24)(46,"table",25),t.ynx(47,26),t.YNc(48,it,2,0,"th",27),t.YNc(49,ot,2,1,"td",28),t.BQk(),t.ynx(50,29),t.YNc(51,at,2,0,"th",27),t.YNc(52,nt,2,1,"td",28),t.BQk(),t.ynx(53,30),t.YNc(54,rt,2,0,"th",27),t.YNc(55,st,2,1,"td",28),t.BQk(),t.ynx(56,31),t.YNc(57,lt,2,0,"th",27),t.YNc(58,ut,2,1,"td",28),t.BQk(),t.ynx(59,32),t.YNc(60,ct,2,0,"th",27),t.YNc(61,dt,2,2,"td",28),t.BQk(),t.ynx(62,33),t.YNc(63,mt,4,0,"th",27),t.YNc(64,ft,5,0,"td",28),t.BQk(),t.YNc(65,pt,1,0,"tr",34),t.YNc(66,ht,1,0,"tr",35),t.qZA()()(),t.TgZ(67,"div",36)(68,"button",37),t.NdJ("click",function(){return i.onSubmit()}),t._uU(69," Guardar "),t.qZA()()()),2&e){const o=t.MAs(15),n=t.MAs(25),l=t.MAs(34);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(4),t.Q6J("matDatepicker",o)("min",i.minDate)("max",i.maxDate),t.xp6(1),t.Q6J("for",o),t.xp6(10),t.Q6J("matAutocomplete",n),t.xp6(1),t.Q6J("displayWith",i.getTextUsuario),t.xp6(2),t.Q6J("ngForOf",t.lcZ(27,21,i.filteredUsuarios)),t.xp6(2),t.Q6J("ngIf",i.form.get("usuario_entrega").value),t.xp6(4),t.Q6J("matAutocomplete",l),t.xp6(1),t.Q6J("displayWith",i.getTextDeposito),t.xp6(2),t.Q6J("ngForOf",t.lcZ(36,23,i.filteredDepositos)),t.xp6(2),t.Q6J("ngIf",i.form.get("deposito_entrega").value&&0==i.mov_art_list.length),t.xp6(6),t.Q6J("ngClass",t.VKq(25,gt,!i.isPalabraMaxLengthReached())),t.xp6(1),t.AsE(" ",i.getPalabrasLength(),"/",i.maxPalabras," "),t.xp6(2),t.Q6J("dataSource",i.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",i.columns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",i.columns)}},dependencies:[f.mk,f.sg,f.O5,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,g.lW,g.RK,g.nh,_.KE,_.hX,_.R9,Z.ey,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,M.Nt,C.Hw,E.gM,w.XC,w.ZL,v.Mq,v.hl,v.nW,f.Ov],styles:['@charset "UTF-8";.counter[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;right:.5rem;font-size:.75rem;color:#c9c9c9}.counter.reached-max[_ngcontent-%COMP%]{color:#e53e3e}']}),a})();var Y=u(2018),_t=u(8288);function vt(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.limpiarFechas())}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function bt(a,r){if(1&a&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e.iddeposito),t.xp6(1),t.Oqu(e.descripcion)}}function xt(a,r){if(1&a&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e.codigo),t.xp6(1),t.hij("",e.nick," ")}}function Zt(a,r){if(1&a&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("value",e.codigo),t.xp6(1),t.hij("",e.nick," ")}}let At=(()=>{class a{constructor(e,i,o,n){this.data=e,this._menuService=i,this.datePipe=o,this._entregasService=n,this.filterDeposito=[],this.filterUsuarios=[],this.filterFechas=[],this.movimientos_internos_list=[]}ngOnInit(){this.formFilters=new s.cw({filtroFechaInicio:new s.NI(""),filtroFechaFin:new s.NI(""),usuario_responsable:new s.NI(-1),usuario_encargado:new s.NI(-1),deposito:new s.NI(-1)}),this.getDepositos(),this.getUsuarios(),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({filtroFechaInicio:"",filtroFechaFin:"",usuario_responsable:-1,usuario_encargado:-1,deposito:-1})}onCloseMenu(e=null){e&&(e.filtroFechaInicio=this.datePipe.transform(this.formFilters.get("filtroFechaInicio").value,"yyyy-MM-dd"),e.filtroFechaFin=this.datePipe.transform(this.formFilters.get("filtroFechaFin").value,"yyyy-MM-dd")),this._menuService.close(e)}limpiarFechas(){this.formFilters.get("filtroFechaInicio").setValue(""),this.formFilters.get("filtroFechaFin").setValue("")}getUsuarios(){var e=this;return(0,p.Z)(function*(){const i=yield(0,b.z)(e._entregasService.getUsuarios());e.filterUsuarios=i.list})()}getDepositos(){var e=this;return(0,p.Z)(function*(){const i=yield(0,b.z)(e._entregasService.getDepositos(!0));e.filterDeposito=i.list})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36("MENU_DATA"),t.Y36(J.r),t.Y36(f.uU),t.Y36(T))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-filter-menu-entregas"]],features:[t._Bn([{provide:Z.sG,useValue:D.x}])],decls:50,vars:11,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base","mt-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],[3,"rangePicker"],["matStartDate","","placeholder","Desde","formControlName","filtroFechaInicio"],["matEndDate","","placeholder","Hasta","formControlName","filtroFechaFin"],["matIconSuffix","",3,"for"],["picker",""],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","deposito"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuario_responsable"],["formControlName","usuario_encargado"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3,"Filtros"),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(6,"mat-icon",4),t._uU(7,"refresh"),t.qZA()(),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(9,"mat-icon",4),t._uU(10,"close"),t.qZA()()()(),t.TgZ(11,"form",6)(12,"span",7),t._uU(13,"Rango de fechas"),t.qZA(),t.TgZ(14,"mat-form-field",8)(15,"mat-date-range-input",9),t._UZ(16,"input",10)(17,"input",11),t.qZA(),t._UZ(18,"mat-datepicker-toggle",12)(19,"mat-date-range-picker",null,13),t.YNc(21,vt,3,0,"button",14),t.qZA(),t.TgZ(22,"span",7),t._uU(23,"Deposito"),t.qZA(),t.TgZ(24,"mat-form-field",8)(25,"mat-select",15)(26,"mat-option",16),t._uU(27,"Todos"),t.qZA(),t.YNc(28,bt,2,2,"mat-option",17),t.qZA()(),t.TgZ(29,"span",7),t._uU(30,"Usuario Responsable"),t.qZA(),t.TgZ(31,"mat-form-field",8)(32,"mat-select",18)(33,"mat-option",16),t._uU(34,"Todos"),t.qZA(),t.YNc(35,xt,2,2,"mat-option",17),t.qZA()(),t.TgZ(36,"span",7),t._uU(37,"Usuario Encargado"),t.qZA(),t.TgZ(38,"mat-form-field",8)(39,"mat-select",19)(40,"mat-option",16),t._uU(41,"Todos"),t.qZA(),t.YNc(42,Zt,2,2,"mat-option",17),t.qZA()()(),t.TgZ(43,"div",20)(44,"button",21),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(45,"span",22),t._uU(46,"Limpiar"),t.qZA()(),t.TgZ(47,"button",23),t.NdJ("click",function(){return i.onCloseMenu(i.formFilters.getRawValue())}),t.TgZ(48,"span",24),t._uU(49,"Filtrar"),t.qZA()()()()),2&e){const o=t.MAs(20);t.Q6J("@expandCollapse","expanded"),t.xp6(11),t.Q6J("formGroup",i.formFilters),t.xp6(4),t.Q6J("rangePicker",o),t.xp6(3),t.Q6J("for",o),t.xp6(3),t.Q6J("ngIf",i.formFilters.get("filtroFechaInicio").value||i.formFilters.get("filtroFechaFin").value),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterDeposito),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterUsuarios),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterUsuarios)}},dependencies:[f.sg,f.O5,g.lW,g.RK,_.KE,_.R9,S.gD,Z.ey,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,C.Hw,v.nW,v.wx,v.zY,v.By,v._g],data:{animation:_t.L}}),a})();var Ct=u(1683),Tt=u(7374),wt=u(8978);let yt=(()=>{class a{constructor(e,i,o,n,l,c,d,N){this._entregasService=e,this.confirm=i,this.alert=o,this.dialogo=n,this._searchService=l,this._menuService=c,this.router=d,this._headerTextService=N,this.dataSource=new m.by,this.headers=["Fecha","Hora","Responsable","Deposito","Usuario Encargado","Acciones"],this.column_params=["fecha","hora","nick_usuario","descripcion_deposito","nick_usuario_entrega","acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["nick_usuario","descripcion_deposito","nick_usuario_entrega"],this.filter={deposito:-1,filtroFechaInicio:"",filtroFechaFin:""},this.extraParams="",this.parametrosActualizados=new t.vpe,this.env=h.N.stock.entregas+"?sort=-identrega",this.search=new s.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,O.b)(750),(0,P.x)()).subscribe(e=>{this.filtroBusqueda=e,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(e=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(e){this._menuService.open(At,e._elementRef,{filter:this.filter,data:this.tabla.getElementosExistentes()}).afterClosed().subscribe({next:i=>{i&&(this.filter=i,this.extraParams=-1!=this.filter.deposito?"filter[iddeposito]="+this.filter.deposito+"&":"",this.extraParams+=-1!=this.filter.usuario_responsable?"filter[idusuario]="+this.filter.usuario_responsable+"&":"",this.extraParams+=-1!=this.filter.usuario_encargado?"filter[usuario_entrega]="+this.filter.usuario_encargado+"&":"",this.extraParams+=null!=this.filter.filtroFechaInicio?"filter[fecha][gte]="+this.filter.filtroFechaInicio+"&":"",this.extraParams+=null!=this.filter.filtroFechaFin?"filter[fecha][lte]="+this.filter.filtroFechaFin+"&":"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(e){switch(e.name){case"editar":this.updateEntrega(e);break;case"eliminar":this.deleteEntrega(e)}}saveEntrega(){this.dialogo.open(q,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updateEntrega(e){this.dialogo.open(q,{data:e.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteEntrega(e){this.confirm.open({title:"Eliminar Entrega: "+e.params.data.fecha,message:`\xbfDesea eliminar la entrega realizada el: ${e.params.data.fecha} ${e.params.data.hora}; del dep\xf3sito: ${e.params.data.descripcion_deposito} ?`,dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._entregasService.deleteEntrega(e.params.data.identrega).subscribe({next:o=>{alert("Entrega eliminada con \xe9xito."),o&&this.tabla.renderTabla()},error:o=>{console.error("Error en el servicio:",o),alert("Esta entrega no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(T),t.Y36(Ct.R),t.Y36(y.T),t.Y36(x.uw),t.Y36(Tt.o),t.Y36(J.r),t.Y36(k.F0),t.Y36(wt.k))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-entregas"]],viewQuery:function(e,i){if(1&e&&t.Gf(Y.C,5),2&e){let o;t.iGM(o=t.CRH())&&(i.tabla=o.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-4","mt-2","pb-4"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Entrega",1,"mr-2","ml-2","bg-blue-500","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2","mt-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),t.NdJ("click",function(){return i.saveEntrega()}),t.TgZ(5,"mat-icon",5),t._uU(6,"add"),t.qZA()()()(),t.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),t.NdJ("functionEmitter",function(n){return i.generarAcciones(n)}),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("cache",!1)("columnsNames",i.headers)("renderType","ssp")("columnsParams",i.column_params)("endpoint",i.env)("functions",i.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",i.filtersLike)("extraParams",i.extraParams))},dependencies:[g.RK,C.Hw,E.gM,Y.C]}),a})();var Ft=u(1292),Ut=u(2611),Nt=u(3873);const kt=[{path:"",component:yt}];let St=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[T,J.r,y.T,f.uU],imports:[f.ez,k.Bz.forChild(kt),m.p0,g.ot,S.LD,_.lN,s.UX,M.c,C.Ps,$.W,E.AV,w.Bb,Q.g0,Ft.p9,Ut.JX,Nt.f,x.Is,v.FA,k.Bz]}),a})()}}]);