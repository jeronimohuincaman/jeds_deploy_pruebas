"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[907],{4907:(Ct,U,l)=>{l.r(U),l.d(U,{StockInicialModule:()=>kt});var w=l(1531),d=l(4755),t=l(2223),a=l(9401),u=l(3627),Q=l(8372),q=l(1884),f=l(5861),k=l(3905),M=l(8675),J=l(4004),v=l(5580),_=l(1217),T=l(3611),p=l(2340),x=l(7579),O=l(3144),$=l(8951);let Z=(()=>{class o{constructor(e,i){this.http=e,this._authService=i}getStockInicial(e){let i="?expand=usuario,deposito,stkMovimientos.idarticulo0,stkMovimientos.idunidadmedida0&";i+="desc"==e?.filter?.sort?"sort=fecha_hora&":"sort=-fecha_hora&",i+=e?.filter?.deposito?`filter[iddeposito]=${e.filter.deposito}&`:"",i+=e?.filter?.usuario?`filter[idusuario]=${e.filter.usuario}&`:"",i+=e?.paginado?.pagination?"&pagination=1&":"",i+=e?.paginado?.perpage?"per-page="+e.paginado.perpage+"&":"",i+=e?.paginado?.currentPage?"page="+e.paginado.currentPage+"&":"";let n=new x.x;return this.http.get(`${p.N.stock.stock_inicial}${i}`,{observe:"response"}).subscribe(r=>{this._authService.accessToken=r.body.token,n.next({list:r.body.result,totalPages:r.headers.get("x-pagination-page-count"),totalCount:r.headers.get("x-pagination-total-count")})}),n.asObservable()}getMovimientos(e){let i=`?filter[idstockinicial]=${e}`,n=new x.x;return this.http.get(`${p.N.stock.view_stock_movimientos}${i}`).subscribe(r=>{n.next({list:r.result})}),n.asObservable()}getArticulos(){let i=new x.x;return this.http.get(`${p.N.stock.articulos}?filter[activo]=1&pagination=1&per-page=10&page=1`).subscribe(n=>{i.next({list:n.result})}),i.asObservable()}getDepositos(e){let i="?";i+=e?"":"filter[activo]=1";let n=new x.x;return this.http.get(`${p.N.stock.depositos}${i}`).subscribe(r=>{n.next({list:r.result})}),n.asObservable()}getUnidadesDeMedidaArticulos(e){let i=`?filter[idarticulo]=${e}`;i+="&expand=um";let n=new x.x;return this.http.get(`${p.N.stock.articulo_unidad_medidas}${i}`).subscribe(r=>{n.next({list:r.result})}),n.asObservable()}saveStockInicial(e){return this.http.post(`${p.N.stock.stock_inicial}`,e)}updateStockInicial(e){return this.http.put(`${p.N.stock.stock_inicial}/`+e.idstockinicial,e)}deleteStockInicial(e){return this.http.delete(p.N.stock.stock_inicial+"/"+e)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(O.eN),t.LFG($.e))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})();var S=l(6375),m=l(1728),h=l(9114),y=l(787),F=l(9609),A=l(430),C=l(8995);function P(o,s){if(1&o&&(t.TgZ(0,"mat-option",18),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.codigo_interno," - ",e.descripcion," ")}}function R(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarCasillero("articulo"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function E(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarCasillero("cantidad"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function j(o,s){if(1&o&&(t.TgZ(0,"mat-option",18),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.idunidadmedida),t.xp6(1),t.Oqu(e.um.descripcion)}}let G=(()=>{class o{constructor(e,i,n,r,c,b){this.data=e,this._stockInicialService=i,this.datePipe=n,this.alert=r,this.dialogRef=c,this.dialogo=b,this.columns=["articulo","codigointerno","cantidad","unidadmedida","acciones"],this.unidades_de_medida=[],this.dataSource=new u.by,this.title="A\xf1adir articulo"}ngOnInit(){this.newForm(),this.getArticulos()}getArticulos(){var e=this;return(0,f.Z)(function*(){const i=yield(0,k.z)(e._stockInicialService.getArticulos());new Promise(function(){var n=(0,f.Z)(function*(r){e.articulos=i.list,e.filteredArticulos=e.form.get("articulo").valueChanges.pipe((0,M.O)(""),(0,J.U)(c=>e._filterArticulos(c))),r(!0)});return function(r){return n.apply(this,arguments)}}())})()}_filterArticulos(e){const i=e.toString().toLowerCase();return this.articulos.filter(n=>{const r=n.codigo_interno.toString().toLowerCase().includes(i),c=n.descripcion.toString().toLowerCase().includes(i);return r||c})}getTextArticulo(e){return e?`${e.codigo_interno} - ${e.descripcion}`:""}getUnidadesDeMedidaArticulos(e){var i=this;return(0,f.Z)(function*(){const n=yield(0,k.z)(i._stockInicialService.getUnidadesDeMedidaArticulos(e));new Promise(function(){var r=(0,f.Z)(function*(c){i.unidades_de_medida=n.list,c(!0)});return function(c){return r.apply(this,arguments)}}())})()}seleccionArticulo(e){e.idarticulo&&(this.form.get("unidadmedida").enable(),this.getUnidadesDeMedidaArticulos(e.idarticulo))}limpiarCasillero(e){this.form.get(e).setValue(""),"articulo"==e&&(this.form.get("unidadmedida").disable(),this.form.get("unidadmedida").setValue(""),this.form.get("cantidad").setValue(""))}newForm(){this.form=new a.cw({articulo:new a.NI("",a.kI.required),unidadmedida:new a.NI("",[a.kI.required]),cantidad:new a.NI("",a.kI.required)}),this.form.get("unidadmedida").disable()}onSubmit(){if(!this.form.valid)return this.alert.warning("Revise Los Datos Ingresados");{let e=this.unidades_de_medida.find(n=>n.idunidadmedida===this.form.get("unidadmedida").value),i={articulo:this.form.get("articulo").value,unidad_medida:this.form.get("unidadmedida").value,cantidad:this.form.get("cantidad").value,unidadmedida_descripcion:e.um.descripcion};this.onCloseMenu(i)}}onCloseMenu(e){this.dialogRef.close(e||!1)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(v.WI),t.Y36(Z),t.Y36(d.uU),t.Y36(S.T),t.Y36(v.so),t.Y36(v.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-articulo"]],features:[t._Bn([{provide:_.sG,useValue:T.x}])],decls:33,vars:10,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","articulo",3,"matAutocomplete","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["appearance","outline",1,"w-1/3"],["matInput","","type","number","formControlName","cantidad"],["formControlName","unidadmedida"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div")(10,"div",6)(11,"mat-form-field",7)(12,"mat-label"),t._uU(13,"Art\xedculo"),t.qZA(),t.TgZ(14,"input",8),t.NdJ("ngModelChange",function(r){return i.seleccionArticulo(r)}),t.qZA(),t.TgZ(15,"mat-autocomplete",9,10),t.YNc(17,P,2,3,"mat-option",11),t.ALo(18,"async"),t.qZA(),t.YNc(19,R,3,0,"button",12),t.qZA(),t.TgZ(20,"mat-form-field",13)(21,"mat-label"),t._uU(22,"Cantidad"),t.qZA(),t._UZ(23,"input",14),t.YNc(24,E,3,0,"button",12),t.qZA(),t.TgZ(25,"mat-form-field",7)(26,"mat-label"),t._uU(27,"UM"),t.qZA(),t.TgZ(28,"mat-select",15),t.YNc(29,j,2,2,"mat-option",11),t.qZA()()()()(),t.TgZ(30,"div",16)(31,"button",17),t.NdJ("click",function(){return i.onSubmit()}),t._uU(32," A\xf1adir "),t.qZA()()()),2&e){const n=t.MAs(16);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(6),t.Q6J("matAutocomplete",n),t.xp6(1),t.Q6J("displayWith",i.getTextArticulo),t.xp6(2),t.Q6J("ngForOf",t.lcZ(18,8,i.filteredArticulos)),t.xp6(2),t.Q6J("ngIf",i.form.get("articulo").value),t.xp6(5),t.Q6J("ngIf",i.form.get("cantidad").value),t.xp6(5),t.Q6J("ngForOf",i.unidades_de_medida)}},dependencies:[d.sg,d.O5,m.lW,m.RK,h.KE,h.hX,h.R9,y.gD,_.ey,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,F.Nt,A.Hw,C.XC,C.ZL,d.Ov]}),o})();var I=l(3649),g=l(8280);function L(o,s){if(1&o&&(t.TgZ(0,"mat-option",34),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.descripcion," ")}}function B(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",35),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarCasillero("deposito"))}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function H(o,s){1&o&&(t.TgZ(0,"th",36),t._uU(1," Articulo"),t.qZA())}function V(o,s){if(1&o&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.descripcion_articulo," ")}}function z(o,s){1&o&&(t.TgZ(0,"th",36),t._uU(1,"C\xf3digo interno"),t.qZA())}function K(o,s){if(1&o&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.codigo_interno_articulo," ")}}function W(o,s){1&o&&(t.TgZ(0,"th",36),t._uU(1,"Cantidad"),t.qZA())}function X(o,s){if(1&o&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.cantidad," ")}}function tt(o,s){1&o&&(t.TgZ(0,"th",36),t._uU(1,"Unidad de medida"),t.qZA())}function et(o,s){if(1&o&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e.descripcion_um," ")}}function it(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"th",36)(1,"button",38),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.addArticulo())}),t.TgZ(2,"mat-icon"),t._uU(3,"add"),t.qZA()()()}}function ot(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"td",37)(1,"button",3,39),t.NdJ("click",function(){const r=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.deleteArticulo(r))}),t.TgZ(3,"mat-icon",40),t._uU(4,"delete"),t.qZA()()()}}function nt(o,s){1&o&&t._UZ(0,"tr",41)}function at(o,s){1&o&&t._UZ(0,"tr",42)}let D=(()=>{class o{constructor(e,i,n,r,c,b){this.data=e,this._stockInicialService=i,this.datePipe=n,this.alert=r,this.dialogRef=c,this.dialogo=b,this.columns=["articulo","codigointerno","cantidad","unidadmedida","acciones"],this.unidades_de_medida=[],this.stk_movimientos=[],this.dataSource=new u.by,this.stock_inicial=this.data?this.data:null,this.title=this.stock_inicial?.idstockinicial?"Editar stock inicial":"Nuevo stock inicial",this.user=JSON.parse(localStorage.getItem("user"))}ngOnInit(){this.newForm(),this.exist()}exist(){this.stock_inicial?.idstockinicial?this.getDepositos(!0):this.getDepositos()}_filterDepositos(e){const i=e.toString().toLowerCase();return this.depositos.filter(n=>n.descripcion.toLowerCase().includes(i))}getTextDeposito(e){return e.descripcion?e.descripcion:e.deposito?e.deposito:e}getDepositos(e){var i=this;return(0,f.Z)(function*(){const n=yield(0,k.z)(i._stockInicialService.getDepositos(e));new Promise(function(){var r=(0,f.Z)(function*(c){i.depositos=n.list,i.filteredDepositos=i.form.get("deposito").valueChanges.pipe((0,M.O)(""),(0,J.U)(b=>i._filterDepositos(b))),c(!0)});return function(c){return r.apply(this,arguments)}}())})()}getMovimientos(e){var i=this;return(0,f.Z)(function*(){return new Promise(function(){var n=(0,f.Z)(function*(r){const c=yield(0,k.z)(i._stockInicialService.getMovimientos(e));i.stk_movimientos=c.list,r(i.stk_movimientos)});return function(r){return n.apply(this,arguments)}}())})()}addArticulo(){this.dialogo.open(G,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:e=>{this.stk_movimientos=[...this.stk_movimientos,{idarticulo:e.articulo.idarticulo,cantidad:e.cantidad,idunidadmedida:e.unidad_medida,descripcion_articulo:e.articulo.descripcion,descripcion_um:e.unidadmedida_descripcion,codigo_interno_articulo:e.articulo.codigo_interno}],this.dataSource=new u.by(this.stk_movimientos),0!=this.stk_movimientos.length&&this.form.get("deposito").disable()}})}deleteArticulo(e){this.stk_movimientos=this.stk_movimientos.filter(i=>i!==e),this.dataSource=new u.by(this.stk_movimientos),0===this.stk_movimientos.length&&this.form.get("deposito").enable()}limpiarCasillero(e){this.form.get(e).setValue("")}newForm(){const[e,i,n]=this.stock_inicial?this.stock_inicial.fecha.split("/"):"";this.stock_inicial&&this.getMovimientos(this.stock_inicial.idstockinicial).then(r=>{this.stk_movimientos=r,this.dataSource=new u.by(r),0!=this.stk_movimientos.length?this.form.get("deposito").disable():this.form.get("deposito").enable()}),this.form=new a.cw({user:new a.NI(this.user?this.user.name:""),fecha:new a.NI(this.datePipe.transform(this.stock_inicial?.fecha?new Date(`${i}/${e}/${n}`):new Date,"yyyy-MM-dd"),[a.kI.required]),hora:new a.NI(this.stock_inicial?.hora?this.stock_inicial.hora:this.datePipe.transform(new Date,"HH:mm"),[a.kI.required]),deposito:new a.NI(this.stock_inicial?this.stock_inicial.descripcion_deposito:"",a.kI.required),articulo:new a.NI(""),unidadmedida:new a.NI(""),cantidad:new a.NI(""),observaciones:new a.NI(this.stock_inicial?this.stock_inicial.observaciones:"",a.kI.required)})}onSubmit(){if(!this.form.valid)return this.alert.warning("Revise Los Datos Ingresados");{let e=this.datePipe.transform(this.form.get("fecha").value,"yyyy-MM-dd"),i=this.stk_movimientos.map(n=>({idarticulo:n.idarticulo,cantidad:n.cantidad,idunidadmedida:n.idunidadmedida}));if(0===i.length)return alert("Debe ingresar un articulo al stock inicial");this.stock_inicial={...this.stock_inicial,idusuario:this.user.id,fecha_hora:`${e} ${this.form.get("hora").value}`,hora:this.form.get("hora").value,iddeposito:this.form.get("deposito").value.iddeposito,observaciones:this.form.get("observaciones").value,articulos:i},this.stock_inicial.idstockinicial?this._stockInicialService.updateStockInicial(this.stock_inicial).subscribe({next:n=>{n&&this.dialogRef.close(n)}}):this._stockInicialService.saveStockInicial(this.stock_inicial).subscribe({next:n=>{n&&this.dialogRef.close(n)}})}}onCloseMenu(){this.dialogRef.close(!1)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(v.WI),t.Y36(Z),t.Y36(d.uU),t.Y36(S.T),t.Y36(v.so),t.Y36(v.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-save-stock-inicial"]],features:[t._Bn([{provide:_.sG,useValue:T.x}])],decls:60,vars:15,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"shadow-md","mb-3"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/4"],["matInput","","placeholder","Fecha","formControlName","fecha",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],["matInput","","formControlName","hora","type","time"],["matInput","","placeholder","Nombre del menu","formControlName","user",3,"readonly"],["type","text","matInput","","formControlName","deposito",3,"matAutocomplete"],["autoActiveFirstOption","",3,"displayWith"],["art","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["appearance","outline",1,"w-full"],["matInput","","formControlName","observaciones",1,"resize-none"],[1,"overflow-y-auto","max-h-[150px]","h-[150px]","shadow-xl","pb-10","border-t-2","border-slate-200"],["mat-table","",1,"w-full","mt-1",3,"dataSource"],["matColumnDef","articulo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","codigointerno"],["matColumnDef","cantidad"],["matColumnDef","unidadmedida"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-mini-fab","","color","primary","matTooltip","A\xf1adir Articulo","aria-label","icon",1,"rounded-full",3,"click"],["delete",""],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()()(),t.TgZ(8,"form",5)(9,"div",6)(10,"div",7)(11,"mat-form-field",8),t._UZ(12,"input",9)(13,"mat-datepicker-toggle",10)(14,"mat-datepicker",null,11),t.qZA(),t.TgZ(16,"mat-form-field",8)(17,"mat-label"),t._uU(18,"Hora"),t.qZA(),t._UZ(19,"input",12),t.qZA(),t.TgZ(20,"mat-form-field",8)(21,"mat-label"),t._uU(22,"Usuario"),t.qZA(),t._UZ(23,"input",13),t.qZA(),t.TgZ(24,"mat-form-field",8)(25,"mat-label"),t._uU(26,"Dep\xf3sitos"),t.qZA(),t._UZ(27,"input",14),t.TgZ(28,"mat-autocomplete",15,16),t.YNc(30,L,2,2,"mat-option",17),t.ALo(31,"async"),t.qZA(),t.YNc(32,B,3,0,"button",18),t.qZA()(),t.TgZ(33,"div")(34,"mat-form-field",19)(35,"mat-label"),t._uU(36,"Observaciones"),t.qZA(),t._UZ(37,"textarea",20),t.qZA()()(),t.TgZ(38,"div",21)(39,"table",22),t.ynx(40,23),t.YNc(41,H,2,0,"th",24),t.YNc(42,V,2,1,"td",25),t.BQk(),t.ynx(43,26),t.YNc(44,z,2,0,"th",24),t.YNc(45,K,2,1,"td",25),t.BQk(),t.ynx(46,27),t.YNc(47,W,2,0,"th",24),t.YNc(48,X,2,1,"td",25),t.BQk(),t.ynx(49,28),t.YNc(50,tt,2,0,"th",24),t.YNc(51,et,2,1,"td",25),t.BQk(),t.ynx(52,29),t.YNc(53,it,4,0,"th",24),t.YNc(54,ot,5,0,"td",25),t.BQk(),t.YNc(55,nt,1,0,"tr",30),t.YNc(56,at,1,0,"tr",31),t.qZA()()(),t.TgZ(57,"div",32)(58,"button",33),t.NdJ("click",function(){return i.onSubmit()}),t._uU(59," Guardar "),t.qZA()()()),2&e){const n=t.MAs(15),r=t.MAs(29);t.xp6(3),t.Oqu(i.title),t.xp6(5),t.Q6J("formGroup",i.form),t.xp6(4),t.Q6J("matDatepicker",n),t.xp6(1),t.Q6J("for",n),t.xp6(10),t.Q6J("readonly",!0),t.xp6(4),t.Q6J("matAutocomplete",r),t.xp6(1),t.Q6J("displayWith",i.getTextDeposito),t.xp6(2),t.Q6J("ngForOf",t.lcZ(31,13,i.filteredDepositos)),t.xp6(2),t.Q6J("ngIf",i.form.get("deposito").value&&0==i.stk_movimientos.length),t.xp6(7),t.Q6J("dataSource",i.dataSource),t.xp6(16),t.Q6J("matHeaderRowDef",i.columns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",i.columns)}},dependencies:[d.sg,d.O5,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,m.lW,m.RK,m.nh,h.KE,h.hX,h.R9,_.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,F.Nt,A.Hw,I.gM,g.Mq,g.hl,g.nW,C.XC,C.ZL,d.Ov]}),o})();var Y=l(2018),st=l(8288),N=l(3686);function rt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.limpiarFechas())}),t.TgZ(1,"mat-icon"),t._uU(2,"clear"),t.qZA()()}}function lt(o,s){if(1&o&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.iddeposito),t.xp6(1),t.Oqu(e.descripcion)}}function ct(o,s){if(1&o&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.codigo_usuario),t.xp6(1),t.hij("",e.nick_usuario," ")}}let ut=(()=>{class o{constructor(e,i,n,r){this.data=e,this._menuService=i,this.datePipe=n,this._stockInicialService=r,this.usuarios=[],this.filterDeposito=[],this.filterUsuarios=[],this.filterFechas=[],this.stockInicial=[]}ngOnInit(){this.formFilters=new a.cw({filtroFechaInicio:new a.NI(""),filtroFechaFin:new a.NI(""),usuario:new a.NI(-1),deposito:new a.NI(-1)}),this.getDepositos(),this.getUsuarios(),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({filtroFechaInicio:"",filtroFechaFin:"",usuario:-1,deposito:-1})}onCloseMenu(e=null){e&&(e.filtroFechaInicio=this.datePipe.transform(this.formFilters.get("filtroFechaInicio").value,"yyyy-MM-dd"),e.filtroFechaFin=this.datePipe.transform(this.formFilters.get("filtroFechaFin").value,"yyyy-MM-dd")),this._menuService.close(e)}limpiarFechas(){this.formFilters.get("filtroFechaInicio").setValue(""),this.formFilters.get("filtroFechaFin").setValue("")}getUsuarios(){this.data.data.forEach(i=>{this.filterUsuarios.find(r=>r.codigo_usuario===i.codigo_usuario)||this.filterUsuarios.push({codigo_usuario:i.codigo_usuario,nick_usuario:i.nick_usuario})})}getDepositos(){var e=this;return(0,f.Z)(function*(){const i=yield(0,k.z)(e._stockInicialService.getDepositos(!0));e.filterDeposito=i.list})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36("MENU_DATA"),t.Y36(N.r),t.Y36(d.uU),t.Y36(Z))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-filter-menu-stock-inicial"]],features:[t._Bn([{provide:_.sG,useValue:T.x}])],decls:43,vars:9,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base","mt-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],[3,"rangePicker"],["matStartDate","","placeholder","Desde","formControlName","filtroFechaInicio"],["matEndDate","","placeholder","Hasta","formControlName","filtroFechaFin"],["matIconSuffix","",3,"for"],["picker",""],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","deposito"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuario"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3,"Filtros"),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(6,"mat-icon",4),t._uU(7,"refresh"),t.qZA()(),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.onCloseMenu()}),t.TgZ(9,"mat-icon",4),t._uU(10,"close"),t.qZA()()()(),t.TgZ(11,"form",6)(12,"span",7),t._uU(13,"Rango de fechas"),t.qZA(),t.TgZ(14,"mat-form-field",8)(15,"mat-date-range-input",9),t._UZ(16,"input",10)(17,"input",11),t.qZA(),t._UZ(18,"mat-datepicker-toggle",12)(19,"mat-date-range-picker",null,13),t.YNc(21,rt,3,0,"button",14),t.qZA(),t.TgZ(22,"span",7),t._uU(23,"Deposito"),t.qZA(),t.TgZ(24,"mat-form-field",8)(25,"mat-select",15)(26,"mat-option",16),t._uU(27,"Todos"),t.qZA(),t.YNc(28,lt,2,2,"mat-option",17),t.qZA()(),t.TgZ(29,"span",7),t._uU(30,"Usuario"),t.qZA(),t.TgZ(31,"mat-form-field",8)(32,"mat-select",18)(33,"mat-option",16),t._uU(34,"Todos"),t.qZA(),t.YNc(35,ct,2,2,"mat-option",17),t.qZA()()(),t.TgZ(36,"div",19)(37,"button",20),t.NdJ("click",function(){return i.resetFilters()}),t.TgZ(38,"span",21),t._uU(39,"Limpiar"),t.qZA()(),t.TgZ(40,"button",22),t.NdJ("click",function(){return i.onCloseMenu(i.formFilters.getRawValue())}),t.TgZ(41,"span",23),t._uU(42,"Filtrar"),t.qZA()()()()),2&e){const n=t.MAs(20);t.Q6J("@expandCollapse","expanded"),t.xp6(11),t.Q6J("formGroup",i.formFilters),t.xp6(4),t.Q6J("rangePicker",n),t.xp6(3),t.Q6J("for",n),t.xp6(3),t.Q6J("ngIf",i.formFilters.get("filtroFechaInicio").value||i.formFilters.get("filtroFechaFin").value),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterDeposito),t.xp6(5),t.Q6J("value",-1),t.xp6(2),t.Q6J("ngForOf",i.filterUsuarios)}},dependencies:[d.sg,d.O5,m.lW,m.RK,h.KE,h.R9,y.gD,_.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,A.Hw,g.nW,g.wx,g.zY,g.By,g._g],data:{animation:st.L}}),o})();var dt=l(7374),mt=l(1683),ft=l(8978);let pt=(()=>{class o{constructor(e,i,n,r,c,b,xt,Zt,At){this._stockInicialService=e,this._menuService=i,this._searchService=n,this.dialogo=r,this.confirm=c,this.alert=b,this.datePipe=xt,this.router=Zt,this._headerTextService=At,this.dataSource=new u.by,this.stockInicial=[],this.column_params=["fecha","hora","nick_usuario","descripcion_deposito","acciones"],this.headers=["Fecha","Hora","Responsable","Deposito","Acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["descripcion_deposito"],this.filter={activo:-1,deposito:-1,usuario:-1},this.extraParams="",this.parametrosActualizados=new t.vpe,this.env=p.N.stock.view_stock_inicials+"?sort=-idstockinicial",this.search=new a.NI(""),this.stkMovimientos=[],this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"edit",nombre_boton:"Editar",functionName:"editar"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,Q.b)(250),(0,q.x)()).subscribe(e=>{this.filtroBusqueda=e,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(e=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(e){this._menuService.open(ut,e._elementRef,{filter:this.filter,data:this.tabla.getElementosExistentes()}).afterClosed().subscribe({next:i=>{i&&(this.filter=i,this.extraParams=-1!=this.filter.deposito?"&filter[iddeposito]="+this.filter.deposito:"",this.extraParams+=-1!=this.filter.usuario?"&filter[codigo_usuario]="+this.filter.usuario:"",this.extraParams+=null!=this.filter.filtroFechaInicio?"&filter[fecha][gte]="+this.filter.filtroFechaInicio:"",this.extraParams+=null!=this.filter.filtroFechaFin?"&filter[fecha][lte]="+this.filter.filtroFechaFin:"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(e){switch(e.name){case"editar":this.updateStockInicial(e);break;case"eliminar":this.deleteStockInicial(e)}}saveStockInicial(){this.dialogo.open(D,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}updateStockInicial(e){this.dialogo.open(D,{data:e.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteStockInicial(e){this.confirm.open({title:"Eliminar Stock inicial "+e.params.data.fecha,message:"\xbfDesea eliminar el Stock inicial: "+e.params.data.fecha+"?",dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._stockInicialService.deleteStockInicial(e.params.data.idstockinicial).subscribe({next:n=>{this.alert.success("Stock inicial eliminado con \xe9xito."),i&&this.tabla.renderTabla()},error:n=>{console.error(n),alert("Este Stock inicial no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Z),t.Y36(N.r),t.Y36(dt.o),t.Y36(v.uw),t.Y36(mt.R),t.Y36(S.T),t.Y36(d.uU),t.Y36(w.F0),t.Y36(ft.k))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-stock-inicial"]],viewQuery:function(e,i){if(1&e&&t.Gf(Y.C,5),2&e){let n;t.iGM(n=t.CRH())&&(i.tabla=n.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},features:[t._Bn([{provide:_.sG,useValue:T.x}])],decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-4","mt-2","pb-4"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Stock Inicial",1,"mr-2","ml-2","bg-blue-500","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2","mt-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),t.NdJ("click",function(){return i.saveStockInicial()}),t.TgZ(5,"mat-icon",5),t._uU(6,"add"),t.qZA()()()(),t.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),t.NdJ("functionEmitter",function(r){return i.generarAcciones(r)}),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("cache",!1)("columnsNames",i.headers)("renderType","ssp")("columnsParams",i.column_params)("endpoint",i.env)("functions",i.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",i.filtersLike)("extraParams",i.extraParams))},dependencies:[m.RK,A.Hw,I.gM,Y.C]}),o})();var ht=l(5971),gt=l(2611),vt=l(3276),_t=l(3873);const bt=[{path:"",component:pt}];let kt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[Z,N.r,S.T,d.uU],imports:[d.ez,w.Bz.forChild(bt),u.p0,m.ot,v.Is,y.LD,h.lN,a.UX,F.c,A.Ps,ht.W,I.AV,gt.JX,vt.TU,g.FA,m.ot,_t.f,C.Bb,w.Bz]}),o})()}}]);