"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[832],{8832:(ve,S,r)=>{r.r(S),r.d(S,{MovimientoConversionModule:()=>ue});var T=r(1531),u=r(4755),q=r(9383),N=r(3627),v=r(1728),A=r(787),h=r(9114),a=r(9401),w=r(9609),Y=r(5971),F=r(3686),g=r(430),y=r(6375),U=r(3649),e=r(2223),O=r(8372),E=r(1884),c=r(5861),_=r(3905),k=r(8675),J=r(4004),b=r(5580),C=r(1217),I=r(3611),p=r(2340),Z=r(7579),V=r(3144),P=r(8951);let x=(()=>{class n{constructor(t,i){this.http=t,this._authService=i}saveMovimientoConversion(t){return this.http.post(`${p.N.stock.movimiento_conversion}`,t)}deleteMovimientoConversion(t){return this.http.delete(`${p.N.stock.movimiento_conversion}/`+t)}getDepositos(t){let i="?";i+=t?"":"filter[activo]=1";let o=new Z.x;return this.http.get(`${p.N.stock.depositos}${i}`).subscribe(s=>{o.next({list:s.result})}),o.asObservable()}getArticulosDepositosStock(t,i,o){let s=`?filter[deposito]=${t}`;s+=i?`&filter[idarticulo]=${i}`:"",s+=o?`&filter[idunidadmedida]=${o}`:"";let d=new Z.x;return this.http.get(`${p.N.stock.view_stock_articulo_depositos}${s}`).subscribe(m=>{d.next({list:m.result})}),d.asObservable()}getUnidadesDeMedidaArticulos(t){let i=`?filter[idarticulo]=${t}`;i+="&expand=um";let o=new Z.x;return this.http.get(`${p.N.stock.articulo_unidad_medidas}${i}`).subscribe(s=>{o.next({list:s.result})}),o.asObservable()}getUsuarios(){let i=new Z.x;return this.http.get(`${p.N.login.view_usuarios}?sort=asc`).subscribe(o=>{i.next({list:o.result})}),i.asObservable()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(V.eN),e.LFG(P.e))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var M=r(8995),f=r(8280);function $(n,l){if(1&n&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.descripcion," ")}}function L(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("deposito"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function G(n,l){if(1&n&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.codigo_interno," - ",t.descripcion," ")}}function j(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("articulo"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function z(n,l){if(1&n&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t.idunidadmedida),e.xp6(1),e.Oqu(t.descripcion_um)}}function H(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("unidad_medida_origen"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function R(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("cantidad"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function B(n,l){if(1&n&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t.idunidadmedida),e.xp6(1),e.Oqu(t.descripcion_um)}}function K(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarCasillero("unidad_medida_destino"))}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function W(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onSubmit())}),e._uU(1," Guardar "),e.qZA()}}let D=(()=>{class n{constructor(t,i,o,s,d){this.data=t,this._movimientoConversionService=i,this.datePipe=o,this.alert=s,this.dialogRef=d,this.depositos=[],this.articulos=[],this.unidades_de_medida=[],this.articulos_list=[],this.unidades_de_medida_destino=[],this.movimiento_conversion=this.data?this.data:null,this.title=this.movimiento_conversion?.idmovimientoconversion?`Editar conversion ${this.movimiento_conversion.fecha} ${this.movimiento_conversion.hora}`:"Nueva conversion",this.user=JSON.parse(localStorage.getItem("user"))}ngOnInit(){this.exist(),this.newForm()}newForm(){const[t,i,o]=this.movimiento_conversion?this.movimiento_conversion.fecha.split("/"):"";this.form=new a.cw({fecha:new a.NI(this.datePipe.transform(this.movimiento_conversion?.fecha?new Date(`${i}/${t}/${o}`):new Date,"yyyy-MM-dd"),[a.kI.required]),hora:new a.NI(this.movimiento_conversion?.hora?this.movimiento_conversion.hora:this.datePipe.transform(new Date,"HH:mm"),[a.kI.required]),deposito:new a.NI(this.movimiento_conversion?{iddeposito:this.movimiento_conversion.iddeposito,descripcion:this.movimiento_conversion.deposito}:"",a.kI.required),articulo:new a.NI(this.movimiento_conversion?{codigo_interno:this.movimiento_conversion.codigo_interno_articulo,idarticulo:this.movimiento_conversion.idarticulo,descripcion:this.movimiento_conversion.articulo}:null,a.kI.required),unidad_medida_origen:new a.NI(this.movimiento_conversion?this.movimiento_conversion.unidad_medida_origen:"",a.kI.required),unidad_medida_destino:new a.NI(this.movimiento_conversion?this.movimiento_conversion.unidad_medida_destino:"",a.kI.required),cantidad:new a.NI(this.movimiento_conversion?this.movimiento_conversion.cantidad:"",a.kI.required),observaciones:new a.NI(this.movimiento_conversion?this.movimiento_conversion.observaciones:""),stock_existente:new a.NI("")}),this.movimiento_conversion&&(this.form.get("unidad_medida_origen").disable(),this.form.get("unidad_medida_destino").disable(),this.form.get("fecha").disable(),this._movimientoConversionService.getArticulosDepositosStock(this.movimiento_conversion.iddeposito,this.movimiento_conversion.idarticulo,this.movimiento_conversion.unidad_medida_origen).subscribe(s=>{this.form.get("stock_existente").setValue(Number(s.list[0].stock)-this.movimiento_conversion.cantidad)}))}exist(){this.movimiento_conversion?.idmovimientoconversion?(this.getDepositos(!0),this.getArticulosDepositosStock(this.movimiento_conversion.iddeposito).then(()=>{this.getUnidadesDeMedidaArticulosStock(this.movimiento_conversion.idarticulo)})):this.getDepositos()}getDepositos(t){var i=this;return(0,c.Z)(function*(){const o=yield(0,_.z)(i._movimientoConversionService.getDepositos(t));new Promise(function(){var s=(0,c.Z)(function*(d){i.depositos=o.list,i.filteredDepositos=i.form.get("deposito").valueChanges.pipe((0,k.O)(""),(0,J.U)(m=>i._filterDepositos(m))),d(!0)});return function(d){return s.apply(this,arguments)}}())})()}_filterDepositos(t){const i=t.toString().toLowerCase();return this.depositos.filter(o=>o.descripcion.toLowerCase().includes(i))}getTextDeposito(t){return t.descripcion?t.descripcion:t.deposito?t.deposito:t}getArticulosDepositosStock(t){var i=this;return(0,c.Z)(function*(){const o=yield(0,_.z)(i._movimientoConversionService.getArticulosDepositosStock(t));new Promise(function(){var s=(0,c.Z)(function*(d){i.articulos=o.list,i.filteredArticulos=i.form.get("articulo").valueChanges.pipe((0,k.O)(""),(0,J.U)(m=>i._filterArticulos(m))),d(!0)});return function(d){return s.apply(this,arguments)}}()),o.list.forEach(s=>{i.articulos_list.find(m=>m.idarticulo===s.idarticulo)||i.articulos_list.push({idarticulo:s.idarticulo,codigo_interno:s.codigo_interno,descripcion:s.descripcion})})})()}seleccionArticulo(t){if(t.idarticulo&&(this.getUnidadesDeMedidaArticulosStock(t.idarticulo),this.form.get("unidad_medida_origen").enable(),this.form.get("unidad_medida_destino").enable(),this.form.get("cantidad").enable()),t.um){this.unidades_de_medida_destino=this.unidades_de_medida.filter(s=>s.idunidadmedida!=t.um);let o=this.unidades_de_medida.find(s=>s.idarticulo===this.form.get("articulo").value.idarticulo&&s.idunidadmedida===this.form.get("unidad_medida_origen").value).stock;this.form.get("stock_existente").setValue(o),this.form.get("unidad_medida_destino").enable()}t.iddeposito&&this.getArticulosDepositosStock(t.iddeposito)}_filterArticulos(t){const i=t.toString().toLowerCase();return this.articulos_list.filter(o=>{const s=o.codigo_interno.toString().toLowerCase().includes(i),d=o.descripcion.toString().toLowerCase().includes(i);return s||d})}getTextArticulo(t){return t?`${t.codigo_interno} - ${t.descripcion}`:""}getUnidadesDeMedidaArticulosStock(t){var i=this;return(0,c.Z)(function*(){yield new Promise(function(){var o=(0,c.Z)(function*(s){i.unidades_de_medida=i.articulos.filter(d=>d.idarticulo===t).map(d=>({idarticulo:d.idarticulo,idunidadmedida:d.idunidadmedida,descripcion_um:d.um,stock:d.stock})),i.getUnidadesDeMedidaArticulo(t),s(!0)});return function(s){return o.apply(this,arguments)}}())})()}getUnidadesDeMedidaArticulo(t){var i=this;return(0,c.Z)(function*(){new Promise(function(){var o=(0,c.Z)(function*(s){const d=yield(0,_.z)(i._movimientoConversionService.getUnidadesDeMedidaArticulos(t));i.unidades_de_medida_destino=d.list.filter(m=>m.idarticulo===t).map(m=>({idarticulo:m.idarticulo,idunidadmedida:m.idunidadmedida,descripcion_um:m.um.descripcion})),i.movimiento_conversion?.idmovimientoconversion&&(i.unidades_de_medida_destino=i.unidades_de_medida_destino.filter(m=>m.idunidadmedida!=i.movimiento_conversion.unidad_medida_origen)),s(!0)});return function(s){return o.apply(this,arguments)}}())})()}limpiarCasillero(t){"articulo"==t&&(this.form.get("articulo").setValue(""),this.form.get("unidad_medida_origen").disable(),this.form.get("unidad_medida_origen").setValue(""),this.form.get("unidad_medida_destino").disable(),this.form.get("unidad_medida_destino").setValue(""),this.form.get("stock_existente").setValue(""),this.form.get("cantidad").setValue(""),this.form.get("cantidad").disable()),"unidad_medida_origen"==t&&(this.form.get("unidad_medida_origen").setValue(""),this.form.get("stock_existente").setValue(""),this.form.get("cantidad").setValue(""),this.form.get("unidad_medida_destino").setValue(""),this.form.get("unidad_medida_destino").disable()),"unidad_medida_destino"==t&&this.form.get("unidad_medida_destino").setValue(""),"cantidad"==t&&this.form.get(t).setValue(""),"deposito"==t&&(this.form.get("deposito").setValue(""),this.articulos_list=[])}onSubmit(){if(!this.form.valid)return alert("Revise Los Datos Ingresados");{if(this.form.get("cantidad").value>this.form.get("stock_existente").value)return this.form.get("cantidad").setValue(""),alert("La cantidad a convertir no puede ser mayor al Stock Existente!");if(this.form.get("cantidad").value<1)return this.form.get("cantidad").setValue(""),alert("La cantidad a convertir no puede ser un valor negativo!");const t={idusuario:this.user.id,fecha_hora:`${this.form.get("fecha").value} ${this.form.get("hora").value}`,iddeposito:this.form.get("deposito").value.iddeposito,idarticulo:this.form.get("articulo").value.idarticulo,unidad_medida_origen:this.form.get("unidad_medida_origen").value,unidad_medida_destino:this.form.get("unidad_medida_destino").value,cantidad:this.form.get("cantidad").value,observaciones:this.form.get("observaciones").value};this._movimientoConversionService.saveMovimientoConversion(t).subscribe({next:i=>{i&&this.dialogRef.close(i)}})}}onCloseMenu(){this.dialogRef.close(!1)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.WI),e.Y36(x),e.Y36(u.uU),e.Y36(y.T),e.Y36(b.so))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-save-movimiento-conversion"]],features:[e._Bn([{provide:C.sG,useValue:I.x}])],decls:66,vars:27,consts:[[1,"fixed","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-120","sm:w-min-w-90","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",3,"click"],[1,"text-white"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"flex","gap-1"],["appearance","outline",1,"w-1/4"],["matInput","","placeholder","Fecha","formControlName","fecha",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],["matInput","","formControlName","hora","type","time",3,"readonly"],["appearance","outline",1,"w-1/2"],["type","text","matInput","","formControlName","deposito",3,"matAutocomplete","readonly","ngModelChange"],["autoActiveFirstOption","",3,"displayWith"],["dep","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["type","text","matInput","","formControlName","articulo",3,"matAutocomplete","readonly","ngModelChange"],["art","matAutocomplete"],["formControlName","unidad_medida_origen",3,"ngModelChange"],["matInput","","type","number","formControlName","cantidad",3,"readonly"],["appearance","outline",1,"w-1/3"],["matInput","","type","number","formControlName","stock_existente","readonly","true"],["formControlName","unidad_medida_destino"],["appearance","outline",1,"w-full"],["matInput","","formControlName","observaciones",1,"resize-none",3,"readonly"],[1,"w-full","md:flex","justify-center","pb-4","md:px-4"],["mat-raised-button","","color","accent","class","w-full bg-primary rounded-none md:w-28 md:rounded-3xl py-8 md:py-0",3,"click",4,"ngIf"],[3,"value"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"],["mat-raised-button","","color","accent",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return i.onCloseMenu()}),e.TgZ(6,"mat-icon",4),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"form",5)(9,"div",6)(10,"mat-form-field",7),e._UZ(11,"input",8)(12,"mat-datepicker-toggle",9)(13,"mat-datepicker",null,10),e.qZA(),e.TgZ(15,"mat-form-field",7)(16,"mat-label"),e._uU(17,"Hora"),e.qZA(),e._UZ(18,"input",11),e.qZA(),e.TgZ(19,"mat-form-field",12)(20,"mat-label"),e._uU(21,"Dep\xf3sito"),e.qZA(),e.TgZ(22,"input",13),e.NdJ("ngModelChange",function(s){return i.seleccionArticulo(s)}),e.qZA(),e.TgZ(23,"mat-autocomplete",14,15),e.YNc(25,$,2,2,"mat-option",16),e.ALo(26,"async"),e.qZA(),e.YNc(27,L,3,0,"button",17),e.qZA()(),e.TgZ(28,"div",6)(29,"mat-form-field",7)(30,"mat-label"),e._uU(31,"Art\xedculo"),e.qZA(),e.TgZ(32,"input",18),e.NdJ("ngModelChange",function(s){return i.seleccionArticulo(s)}),e.qZA(),e.TgZ(33,"mat-autocomplete",14,19),e.YNc(35,G,2,3,"mat-option",16),e.ALo(36,"async"),e.qZA(),e.YNc(37,j,3,0,"button",17),e.qZA(),e.TgZ(38,"mat-form-field",7)(39,"mat-label"),e._uU(40,"UM Base"),e.qZA(),e.TgZ(41,"mat-select",20),e.NdJ("ngModelChange",function(s){return i.seleccionArticulo({um:s})}),e.YNc(42,z,2,2,"mat-option",16),e.qZA(),e.YNc(43,H,3,0,"button",17),e.qZA(),e.TgZ(44,"mat-form-field",7)(45,"mat-label"),e._uU(46,"Cantidad"),e.qZA(),e._UZ(47,"input",21),e.YNc(48,R,3,0,"button",17),e.qZA(),e.TgZ(49,"mat-form-field",22)(50,"mat-label"),e._uU(51,"En stock"),e.qZA(),e._UZ(52,"input",23),e.qZA(),e.TgZ(53,"mat-form-field",7)(54,"mat-label"),e._uU(55,"UM a convertir"),e.qZA(),e.TgZ(56,"mat-select",24),e.YNc(57,B,2,2,"mat-option",16),e.qZA(),e.YNc(58,K,3,0,"button",17),e.qZA()(),e.TgZ(59,"div")(60,"mat-form-field",25)(61,"mat-label"),e._uU(62,"Observaciones"),e.qZA(),e._UZ(63,"textarea",26),e.qZA()()(),e.TgZ(64,"div",27),e.YNc(65,W,2,0,"button",28),e.qZA()()),2&t){const o=e.MAs(14),s=e.MAs(24),d=e.MAs(34);e.xp6(3),e.Oqu(i.title),e.xp6(5),e.Q6J("formGroup",i.form),e.xp6(3),e.Q6J("matDatepicker",o),e.xp6(1),e.Q6J("for",o),e.xp6(6),e.Q6J("readonly",i.movimiento_conversion),e.xp6(4),e.Q6J("matAutocomplete",s)("readonly",i.movimiento_conversion),e.xp6(1),e.Q6J("displayWith",i.getTextDeposito),e.xp6(2),e.Q6J("ngForOf",e.lcZ(26,23,i.filteredDepositos)),e.xp6(2),e.Q6J("ngIf",i.form.get("deposito").value&&!i.movimiento_conversion),e.xp6(5),e.Q6J("matAutocomplete",d)("readonly",i.movimiento_conversion),e.xp6(1),e.Q6J("displayWith",i.getTextArticulo),e.xp6(2),e.Q6J("ngForOf",e.lcZ(36,25,i.filteredArticulos)),e.xp6(2),e.Q6J("ngIf",i.form.get("articulo").value&&!i.movimiento_conversion),e.xp6(5),e.Q6J("ngForOf",i.unidades_de_medida),e.xp6(1),e.Q6J("ngIf",i.form.get("unidad_medida_origen").value&&!i.movimiento_conversion),e.xp6(4),e.Q6J("readonly",i.movimiento_conversion),e.xp6(1),e.Q6J("ngIf",i.form.get("cantidad").value&&!i.movimiento_conversion),e.xp6(9),e.Q6J("ngForOf",i.unidades_de_medida_destino),e.xp6(1),e.Q6J("ngIf",i.form.get("unidad_medida_destino").value&&!i.movimiento_conversion),e.xp6(5),e.Q6J("readonly",i.movimiento_conversion),e.xp6(2),e.Q6J("ngIf",!i.movimiento_conversion)}},dependencies:[u.sg,u.O5,v.lW,v.RK,h.KE,h.hX,h.R9,A.gD,C.ey,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,w.Nt,g.Hw,M.XC,M.ZL,f.Mq,f.hl,f.nW,u.Ov]}),n})();var Q=r(2018),X=r(8288);function ee(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.limpiarFechas())}),e.TgZ(1,"mat-icon"),e._uU(2,"clear"),e.qZA()()}}function te(n,l){if(1&n&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t.iddeposito),e.xp6(1),e.Oqu(t.descripcion)}}function ie(n,l){if(1&n&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t.codigo),e.xp6(1),e.hij("",t.nick," ")}}let oe=(()=>{class n{constructor(t,i,o,s){this.data=t,this._menuService=i,this.datePipe=o,this._movimientosInternosService=s,this.usuarios=[],this.filterDeposito=[],this.filterUsuarios=[],this.filterFechas=[],this.movimientos_conversion_list=[]}ngOnInit(){this.formFilters=new a.cw({filtroFechaInicio:new a.NI(""),filtroFechaFin:new a.NI(""),usuario:new a.NI(-1),deposito:new a.NI(-1)}),this.getDepositos(),this.getUsuarios(),this.formFilters.patchValue(this.data.filter)}resetFilters(){this.formFilters.reset({filtroFechaInicio:"",filtroFechaFin:"",usuario:-1,deposito:-1})}onCloseMenu(t=null){t&&(t.filtroFechaInicio=this.datePipe.transform(this.formFilters.get("filtroFechaInicio").value,"yyyy-MM-dd"),t.filtroFechaFin=this.datePipe.transform(this.formFilters.get("filtroFechaFin").value,"yyyy-MM-dd")),this._menuService.close(t)}limpiarFechas(){this.formFilters.get("filtroFechaInicio").setValue(""),this.formFilters.get("filtroFechaFin").setValue("")}getUsuarios(){var t=this;return(0,c.Z)(function*(){const i=yield(0,_.z)(t._movimientosInternosService.getUsuarios());t.filterUsuarios=i.list})()}getDepositos(){var t=this;return(0,c.Z)(function*(){const i=yield(0,_.z)(t._movimientosInternosService.getDepositos(!0));t.filterDeposito=i.list})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36("MENU_DATA"),e.Y36(F.r),e.Y36(u.uU),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-filter-menu-movimiento-conversion"]],features:[e._Bn([{provide:C.sG,useValue:I.x}])],decls:43,vars:9,consts:[[1,"fixed","filtroJeds","inset-0","sm:static","max-h-screen","sm:inset-auto","flex","flex-col","sm:min-w-90","sm:w-120","sm:rounded-2xl","overflow-y-auto","overflow-hidden","shadow-lg","bg-white","dark:bg-slate-900"],[1,"w-full","px-4","py-4","bg-primary","flex","justify-between","items-center"],[1,"text-white","font-bold","text-lg"],["mat-icon-button","",1,"md:hidden",3,"click"],[1,"text-white"],["mat-icon-button","",3,"click"],[1,"flex","flex-col","w-full","h-full","p-4","form-menu",3,"formGroup"],[1,"font-bold","text-gray-500","text-base","mt-4"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64","mt-2"],[3,"rangePicker"],["matStartDate","","placeholder","Desde","formControlName","filtroFechaInicio"],["matEndDate","","placeholder","Hasta","formControlName","filtroFechaFin"],["matIconSuffix","",3,"for"],["picker",""],["matSuffix","","mat-icon-button","","class","mr-2",3,"click",4,"ngIf"],["formControlName","deposito"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","usuario"],[1,"w-full","md:flex","md:justify-between","md:pb-4","md:px-4"],["mat-stroked-button","","color","primary",1,"w-full","rounded-none","md:w-28","md:rounded-3xl","hidden","md:block",3,"click"],[1,"text-gray-700","font-bold"],["mat-raised-button","",1,"w-full","bg-primary","rounded-none","md:w-28","md:rounded-3xl","py-8","md:py-0",3,"click"],[1,"text-white","font-bold"],["matSuffix","","mat-icon-button","",1,"mr-2",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"Filtros"),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return i.resetFilters()}),e.TgZ(6,"mat-icon",4),e._uU(7,"refresh"),e.qZA()(),e.TgZ(8,"button",5),e.NdJ("click",function(){return i.onCloseMenu()}),e.TgZ(9,"mat-icon",4),e._uU(10,"close"),e.qZA()()()(),e.TgZ(11,"form",6)(12,"span",7),e._uU(13,"Rango de fechas"),e.qZA(),e.TgZ(14,"mat-form-field",8)(15,"mat-date-range-input",9),e._UZ(16,"input",10)(17,"input",11),e.qZA(),e._UZ(18,"mat-datepicker-toggle",12)(19,"mat-date-range-picker",null,13),e.YNc(21,ee,3,0,"button",14),e.qZA(),e.TgZ(22,"span",7),e._uU(23,"Deposito"),e.qZA(),e.TgZ(24,"mat-form-field",8)(25,"mat-select",15)(26,"mat-option",16),e._uU(27,"Todos"),e.qZA(),e.YNc(28,te,2,2,"mat-option",17),e.qZA()(),e.TgZ(29,"span",7),e._uU(30,"Usuario"),e.qZA(),e.TgZ(31,"mat-form-field",8)(32,"mat-select",18)(33,"mat-option",16),e._uU(34,"Todos"),e.qZA(),e.YNc(35,ie,2,2,"mat-option",17),e.qZA()()(),e.TgZ(36,"div",19)(37,"button",20),e.NdJ("click",function(){return i.resetFilters()}),e.TgZ(38,"span",21),e._uU(39,"Limpiar"),e.qZA()(),e.TgZ(40,"button",22),e.NdJ("click",function(){return i.onCloseMenu(i.formFilters.getRawValue())}),e.TgZ(41,"span",23),e._uU(42,"Filtrar"),e.qZA()()()()),2&t){const o=e.MAs(20);e.Q6J("@expandCollapse","expanded"),e.xp6(11),e.Q6J("formGroup",i.formFilters),e.xp6(4),e.Q6J("rangePicker",o),e.xp6(3),e.Q6J("for",o),e.xp6(3),e.Q6J("ngIf",i.formFilters.get("filtroFechaInicio").value||i.formFilters.get("filtroFechaFin").value),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",i.filterDeposito),e.xp6(5),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",i.filterUsuarios)}},dependencies:[u.sg,u.O5,v.lW,v.RK,h.KE,h.R9,A.gD,C.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,g.Hw,f.nW,f.wx,f.zY,f.By,f._g],data:{animation:X.L}}),n})();var ne=r(1683),se=r(7374),re=r(8978);let ae=(()=>{class n{constructor(t,i,o,s,d,m,fe,pe){this._movimientoConversionService=t,this.confirm=i,this.alert=o,this.dialogo=s,this._searchService=d,this._menuService=m,this.router=fe,this._headerTextService=pe,this.dataSource=new N.by,this.headers=["Fecha","Hora","Responsable","Dep\xf3sito","Art\xedculo","Cantidad","UM Origen","Cantidad","UM Destino","Acciones"],this.column_params=["fecha","hora","usuario","deposito","articulo","cantidad","descripcion_um_origen","cantidad_conversion","descripcion_um_destino","acciones"],this.funcionesObjeto=null,this.filtroBusqueda="",this.filtersLike=["observaciones","usuario","deposito"],this.filter={deposito:-1,filtroFechaInicio:"",filtroFechaFin:""},this.extraParams="",this.parametrosActualizados=new e.vpe,this.env=p.N.stock.movimiento_conversion+"?sort=-idmovimientoconversion",this.search=new a.NI(""),this._headerTextService.setTitulo(this.router),this.funcionesObjeto=[{icono:"remove_red_eye",nombre_boton:"Ver",functionName:"ver"},{icono:"delete",nombre_boton:"Eliminar",functionName:"eliminar"}]}ngOnInit(){this.SearchTextSub$=this._searchService.getSearchText().pipe((0,O.b)(750),(0,E.x)()).subscribe(t=>{this.filtroBusqueda=t,this.tabla.filters(this.filtroBusqueda)}),this.FilterEventSub$=this._searchService.getFilterEvent().subscribe(t=>{this.onFilterMenu(this._searchService.getFilterOrigin())})}onFilterMenu(t){this._menuService.open(oe,t._elementRef,{filter:this.filter,data:this.tabla.getElementosExistentes()}).afterClosed().subscribe({next:i=>{i&&(this.filter=i,this.extraParams=-1!=this.filter.deposito?"filter[iddeposito]="+this.filter.deposito+"&":"",this.extraParams+=-1!=this.filter.usuario?"filter[idusuario]="+this.filter.usuario+"&":"",this.extraParams+=null!=this.filter.filtroFechaInicio?"filter[fecha][gte]="+this.filter.filtroFechaInicio+"&":"",this.extraParams+=null!=this.filter.filtroFechaFin?"filter[fecha][lte]="+this.filter.filtroFechaFin+"&":"",this.tabla.filters(this.filtroBusqueda))}})}generarAcciones(t){switch(t.name){case"ver":this.verMovimientoConversion(t);break;case"eliminar":this.deleteMovimientoConversion(t)}}saveMovimientoConversion(){this.dialogo.open(D,{panelClass:"ayuda-dialog"}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}verMovimientoConversion(t){this.dialogo.open(D,{data:t.params.data,panelClass:"my-dialog",autoFocus:!1}).afterClosed().subscribe({next:()=>{this.tabla.filters(this.filtroBusqueda)}})}deleteMovimientoConversion(t){this.confirm.open({title:"Eliminar Movimiento conversion: "+t.params.data.fecha,message:`\xbfDesea eliminar el movimiento conversion realizado el: ${t.params.data.fecha} ${t.params.data.hora}; del dep\xf3sito: ${t.params.data.deposito} ?`,dismissible:!1,actions:{confirm:{show:!0,color:"warn",label:"Si"},cancel:{show:!0,label:"No"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._movimientoConversionService.deleteMovimientoConversion(t.params.data.idmovimientoconversion).subscribe({next:o=>{alert("Movimiento conversion eliminado con \xe9xito."),o&&this.tabla.renderTabla()},error:o=>{console.error("Error en el servicio:",o),alert("Este movimiento conversion no puede eliminarse. Tiene elementos asociados.")}})})}ngOnDestroy(){this._searchService.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x),e.Y36(ne.R),e.Y36(y.T),e.Y36(b.uw),e.Y36(se.o),e.Y36(F.r),e.Y36(T.F0),e.Y36(re.k))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-movimiento-conversion"]],viewQuery:function(t,i){if(1&t&&e.Gf(Q.C,5),2&t){let o;e.iGM(o=e.CRH())&&(i.tabla=o.first)}},inputs:{extraParams:"extraParams"},outputs:{parametrosActualizados:"parametrosActualizados"},decls:9,vars:9,consts:[[1,"w-full","flex","flex-col","relative"],[1,"mb-4","mt-2","pb-4"],[1,"fixed","right-10"],["mat-icon-button","","type","button","matTooltip","Crear Conversion",1,"mr-2","ml-2","bg-blue-500","rounded-full","z-99999",3,"click"],["save",""],[1,"text-white"],[1,"pr-2","pl-2","mt-2"],[1,"bottom-10","sm:bottom-0","table-fixed","sm:top-2","w-full","m-0",3,"cache","columnsNames","renderType","columnsParams","endpoint","functions","extraClasses","FiltersLikes","extraParams","functionEmitter"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3,4),e.NdJ("click",function(){return i.saveMovimientoConversion()}),e.TgZ(5,"mat-icon",5),e._uU(6,"add"),e.qZA()()()(),e.TgZ(7,"div",6)(8,"app-tabla-dinamica",7),e.NdJ("functionEmitter",function(s){return i.generarAcciones(s)}),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("cache",!1)("columnsNames",i.headers)("renderType","ssp")("columnsParams",i.column_params)("endpoint",i.env)("functions",i.funcionesObjeto)("extraClasses","td.mat-cell border,td.mat-cell border-slate-400")("FiltersLikes",i.filtersLike)("extraParams",i.extraParams))},dependencies:[v.RK,g.Hw,U.gM,Q.C]}),n})();var le=r(1292),de=r(2611),me=r(3873);const ce=[{path:"",component:ae}];let ue=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[x,F.r,y.T,u.uU],imports:[u.ez,T.Bz.forChild(ce),N.p0,v.ot,A.LD,h.lN,a.UX,w.c,g.Ps,Y.W,U.AV,M.Bb,q.g0,le.p9,de.JX,me.f,b.Is,f.FA,T.Bz]}),n})()}}]);